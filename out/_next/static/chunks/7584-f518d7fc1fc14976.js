"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7584],{4460:(e,l,t)=>{t.d(l,{j:()=>z});var a=t(95155),i=t(38543),r=t(62177),n=t(90221),s=t(12115),o=t(96801),u=t(68074),d=t(15843),c=t(9670),f=t(78822),p=t(53494),h=t(15930),m=t(80158),x=t(66292),b=t(2360),g=t(5551),v=t(7433),y=t(71984),S=t(13896),j=t(74234),A=t(38867),w=t(54961);let C=e=>e?({active:"Active",underconstruction:"Under Construction","under construction":"Under Construction",planned:"Planned",completed:"Completed"})[e.toLowerCase().replace(/\s+/g,"")]||e:"";function z(e){let{open:l,onOpen:t,onClose:z,actionItemsMutate:U,sitesTypeData:D,siteId:k}=e,{siteData:E,siteLoading:N}=(0,y.lr)(k),T=(0,s.useMemo)(()=>({siteName:(null==E?void 0:E.SiteName)||"",siteStatus:C(null==E?void 0:E.SiteStatus)||"",siteType:(null==E?void 0:E.SiteTypeId)||"",siteCity:(null==E?void 0:E.SiteCity)||"",isOperational:(null==E?void 0:E.IsOperational)||!1,nearByLandMark:(null==E?void 0:E.NearbyLandmarks)||"",address:(null==E?void 0:E.SiteAddress)||"",siteSize:(null==E?void 0:E.SiteSizeSqFt)||0,siteDescription:(null==E?void 0:E.SiteDescription)||"",operationalDate:(null==E?void 0:E.OperationalDate)||null}),[E]),I=(0,r.mN)({mode:"all",resolver:(0,n.u)(S.Fq),defaultValues:T}),{reset:R,handleSubmit:O,formState:{isSubmitting:F,isDirty:P}}=I;(0,s.useEffect)(()=>{R(T)},[T,R]);let M=(0,s.useCallback)(()=>{R(T)},[R,T]),V=(0,s.useCallback)(e=>{let l={SiteName:e.siteName,SiteTypeId:e.siteType,SiteStatus:e.siteStatus,SiteCity:e.siteCity};return e.address&&(l.SiteAddress=e.address),e.nearByLandMark&&(l.NearbyLandmarks=e.nearByLandMark),e.siteSize&&e.siteSize>0&&(l.SiteSizeSqFt=e.siteSize),e.siteDescription&&(l.SiteDescription=e.siteDescription),null!==e.isOperational&&void 0!==e.isOperational&&(l.IsOperational=e.isOperational),e.operationalDate&&(l.OperationalDate="string"==typeof e.operationalDate?e.operationalDate:e.operationalDate.format("YYYY-MM-DDTHH:mm:ss")),l},[]),B=O(async e=>{try{let l=V(e);await (0,j.eZ)(l),i.oR.success("Site created successfully!"),U(),M(),z()}catch(e){console.error("Error creating site:",e),i.oR.error(e.message||"Unable to create site. Please try again.")}}),q=O(async e=>{try{let l=V(e);await (0,j.hj)({newSiteData:l,id:k}),i.oR.success("Site updated successfully!"),U(),M(),z()}catch(e){console.error("Error updating site:",e),i.oR.error(e.message||"Unable to update site. Please try again.")}}),W=async e=>{k?await q(e):await B(e)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.default,{disableRipple:!0,variant:"contained",color:"inherit",onClick:()=>t(),startIcon:(0,a.jsx)(d.A,{}),sx:{mx:2,my:1},children:"New Site"}),(0,a.jsxs)(g.Ay,{anchor:"right",open:l,onClose:z,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:400,maxWidth:"90vw",display:"flex",flexDirection:"column",height:"100%"}},transitionDuration:300,children:[(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.A,{sx:{py:2,pr:1,pl:2.5,display:"flex",alignItems:"center"},children:[(0,a.jsxs)(c.default,{variant:"h6",sx:{flexGrow:1},children:[k?"Edit":"Add"," a site"]}),(0,a.jsx)(f.default,{title:"Reset Form",arrow:!0,children:(0,a.jsx)(p.default,{onClick:M,children:(0,a.jsx)(h.default,{color:"error",variant:"dot",invisible:!P,children:(0,a.jsx)(A.W,{icon:"solar:restart-bold",width:24,height:24})})})}),(0,a.jsx)(p.default,{onClick:z,children:(0,a.jsx)(A.W,{icon:"mingcute:close-line",width:24,height:24})})]}),(0,a.jsx)(m.default,{sx:{borderStyle:"dashed"}})]}),k&&N?(0,a.jsxs)(o.A,{sx:{p:3,display:"flex",flexDirection:"column",gap:2},children:[(0,a.jsx)(v.A,{}),(0,a.jsx)(c.default,{variant:"body2",sx:{textAlign:"center",color:"text.secondary"},children:"Loading site data..."})]}):(0,a.jsx)(w.lV,{methods:I,onSubmit:W,children:(0,a.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2,flexGrow:1,height:"100%",p:2},children:[(0,a.jsxs)(o.A,{sx:{display:"flex",gap:2},children:[(0,a.jsx)(o.A,{sx:{flex:1},children:(0,a.jsx)(w.D0.Text2,{name:"siteName",label:"Site Name",placeholder:"Enter a name for the site",helperText:"",required:!0})}),(0,a.jsx)(o.A,{sx:{flex:1},children:(0,a.jsx)(w.D0.Select,{name:"siteType",label:"Site Type",placeholder:"Select site type",helperText:"",required:!0,children:null==D?void 0:D.map(e=>{let{SiteTypeId:l,SiteType:t}=e;return(0,a.jsx)(b.default,{value:l,children:t},l)})})})]}),(0,a.jsxs)(o.A,{sx:{display:"flex",gap:2},children:[(0,a.jsx)(o.A,{sx:{flex:1},children:(0,a.jsxs)(w.D0.Select,{name:"siteStatus",label:"Site Status",placeholder:"Select site status",helperText:"",required:!0,children:[(0,a.jsx)(b.default,{value:"Active",children:"Active"}),(0,a.jsx)(b.default,{value:"Under Construction",children:"Under Construction"}),(0,a.jsx)(b.default,{value:"Planned",children:"Planned"}),(0,a.jsx)(b.default,{value:"Completed",children:"Completed"})]})}),(0,a.jsx)(o.A,{sx:{flex:1},children:(0,a.jsx)(w.D0.Checkbox,{name:"isOperational",label:"Is Operational"})})]}),(0,a.jsx)(c.default,{children:"Location Details"}),(0,a.jsxs)(o.A,{sx:{display:"flex",gap:2},children:[(0,a.jsx)(o.A,{sx:{flex:1},children:(0,a.jsx)(w.D0.Text2,{name:"siteCity",label:"Site City",placeholder:"Enter a name for the city",helperText:"",required:!0})}),(0,a.jsx)(o.A,{sx:{flex:1},children:(0,a.jsx)(w.D0.Text2,{name:"nearByLandMark",label:"Near By Landmark",placeholder:"Enter a nearby land mark",helperText:""})})]}),(0,a.jsx)(o.A,{sx:{display:"flex",gap:2},children:(0,a.jsx)(o.A,{sx:{flex:1},children:(0,a.jsx)(w.D0.Text2,{name:"address",label:"Address",placeholder:"Enter a name for the address",helperText:"",multiline:!0,minRows:4,maxRows:8})})}),(0,a.jsxs)(o.A,{sx:{display:"flex",gap:2},children:[(0,a.jsx)(o.A,{sx:{flex:1},children:(0,a.jsx)(w.D0.Text2,{name:"siteSize",label:"Site Size",placeholder:"Enter a name for the Site Size",helperText:"",type:"number"})}),(0,a.jsx)(o.A,{sx:{flex:1},children:(0,a.jsx)(w.D0.DatePicker2,{name:"operationalDate",label:"Operational Date",timeMode:"endOfDay",slotProps:{field:{clearable:!0}}})})]}),(0,a.jsx)(o.A,{sx:{display:"flex",gap:2},children:(0,a.jsx)(o.A,{sx:{flex:1},children:(0,a.jsx)(w.D0.Text2,{name:"siteDescription",label:"Site Description",placeholder:"Enter a name for the site description",helperText:"",multiline:!0,minRows:4,maxRows:8})})}),(0,a.jsxs)(o.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[(0,a.jsx)(x.default,{onClick:z,color:"inherit",variant:"outlined",children:"Cancel"}),(0,a.jsx)(u.default,{type:"submit",variant:"contained",loading:F,disabled:F,children:F?k?"Updating...":"Creating...":k?"Edit":"Create"})]})]})})]})]})}},13896:(e,l,t)=>{t.d(l,{FA:()=>s,Fq:()=>i,ed:()=>r,j:()=>n});var a=t(55594);let i=a.z.object({siteName:a.z.string().min(1,{message:"Site name is required!"}),siteType:a.z.number().min(1,{message:"Site Type is required"}),siteStatus:a.z.enum(["Active","Under Construction","Planned","Completed"],{message:"Site Status is required"}),siteCity:a.z.string().min(1,{message:"Site City is required"}),nearByLandMark:a.z.string().nullable(),address:a.z.string().nullable(),siteSize:a.z.number().nullable(),operationalDate:a.z.union([a.z.string(),a.z.date()]).nullable().transform(e=>e instanceof Date?e.toISOString():e).nullable(),siteDescription:a.z.string().nullable(),isOperational:a.z.boolean().nullable()}),r=a.z.object({SiteId:a.z.preprocess(e=>""===e||null==e?0:Number(e),a.z.number().min(1,{message:"Site is required"})),InfraName:a.z.string().min(1,{message:"Infra name is required!"}),InfraCategory:a.z.string().min(1,{message:"Category is required"}).refine(e=>["Residential","Commercial","Mixed","Other"].includes(e),{message:"Please select a valid category"}),InfraFloorCount:a.z.preprocess(e=>""===e||null==e?0:Number(e),a.z.number().min(0,{message:"Floor count cannot be negative"})),AvailableUnits:a.z.preprocess(e=>""===e||null==e?0:Number(e),a.z.number().min(0,{message:"Available units cannot be negative"})),SoldUnits:a.z.preprocess(e=>""===e||null==e?0:Number(e),a.z.number().min(0,{message:"Sold units cannot be negative"})),BookedUnits:a.z.preprocess(e=>""===e||null==e?0:Number(e),a.z.number().min(0,{message:"Booked units cannot be negative"})),TotalUnits:a.z.preprocess(e=>""===e||null==e?0:Number(e),a.z.number().min(0,{message:"Total units cannot be negative"}))}),n=a.z.object({site:a.z.number().min(1,"Site is required"),infrastructure:a.z.number().min(1,"Infrastructure is required"),floorType:a.z.enum(["single","multiple"],{required_error:"Floor type is required"}),formula:a.z.string().min(1,"Formula is required"),prefix:a.z.string().min(1,"Prefix is required"),floor:a.z.string().optional(),floorRange:a.z.string().optional(),numberOfUnits:a.z.union([a.z.number(),a.z.string()]).optional(),startNumber:a.z.union([a.z.number(),a.z.string()]).optional(),numberRange:a.z.string().optional(),defaultUnits:a.z.string().optional(),defaultUnitAvailability:a.z.string().optional(),defaultUnitDirection:a.z.string().optional(),defaultUnitView:a.z.string().optional(),defaultUnitSize:a.z.number().min(1,"Default unit size must be at least 1").optional()}).refine(e=>!!(e.numberRange&&e.numberRange.trim())||!!e.numberRange&&!!e.numberRange.trim()||e.numberOfUnits&&e.startNumber,{message:'Either provide "Enter Number or Range" OR both "No. of Units" and "Start Number"',path:["numberOfUnits"]}).refine(e=>!!(e.numberRange&&e.numberRange.trim())||!!e.numberRange&&!!e.numberRange.trim()||e.numberOfUnits&&e.startNumber,{message:'Either provide "Enter Number or Range" OR both "No. of Units" and "Start Number"',path:["startNumber"]}),s=a.z.object({InfraId:a.z.number().min(0,"Infrastructure ID is required"),UnitNumber:a.z.number().min(1,"Unit number is required"),FloorNumber:a.z.number().min(0,"Floor number is required"),UnitSize:a.z.number().min(1,"Unit size must be at least 1"),AvailabilityStatus:a.z.string().min(1,"Availability status is required"),Direction:a.z.string().min(1,"Direction is required"),UnitType:a.z.string().min(1,"Unit type is required"),View:a.z.string().min(1,"View is required"),PurchaseReason:a.z.string().optional()})},15843:(e,l,t)=>{t.d(l,{A:()=>r});var a=t(76856),i=t(95155);let r=(0,a.A)((0,i.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},26285:(e,l,t)=>{t.d(l,{A:()=>v});var a=t(95155),i=t(12115),r=t(66292),n=t(78822),s=t(96801),o=t(92634),u=t(95946),d=t(77498),c=t(78880),f=t(26403),p=t(89547),h=t(2360),m=t(59886),x=t(73816),b=t(38867);let g=e=>{let{onApply:l,selectRef:t,label:r="Apply"}=e,n=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),(null==t?void 0:t.current)&&t.current.blur(),l(),setTimeout(()=>{let e=document.querySelector(".MuiModal-backdrop");e&&e.click()},0)},[l,t]);return(0,a.jsx)(h.default,{onClick:n,sx:e=>({position:"sticky",bottom:0,zIndex:1,justifyContent:"center",fontWeight:e.typography.button,bgcolor:e.palette.background.paper,border:"2px solid ".concat(e.palette.divider),"&:hover":{bgcolor:e.palette.background.paper}}),children:r})},v=e=>{let{filters:l,options:t,sx:v}=e,{state:y,setState:S}=l,[j,A]=(0,i.useState)(y.site),[w,C]=(0,i.useState)(y.infra),[z,U]=(0,i.useState)(y.bedroom),[D,k]=(0,i.useState)(y.direction),[E,N]=(0,i.useState)(y.view),[T,I]=(0,i.useState)(y.status),[R,O]=(0,i.useState)(y.searchQuery),[F,P]=(0,i.useState)(y.minSize),[M,V]=(0,i.useState)(y.maxSize),[B,q]=(0,i.useState)(!1),[W,L]=(0,i.useState)(!1),_=(0,i.useRef)(null),H=(0,i.useRef)(null),G=(0,i.useRef)(null),K=(0,i.useRef)(null),Z=(0,i.useRef)(null),Y=(0,i.useRef)(null);(0,i.useEffect)(()=>{A(y.site||null)},[y.site]),(0,i.useEffect)(()=>{C(y.infra||[])},[y.infra,y.site]),(0,i.useEffect)(()=>{U(y.bedroom||[])},[y.bedroom]),(0,i.useEffect)(()=>{k(y.direction||[])},[y.direction]),(0,i.useEffect)(()=>{N(y.view||[])},[y.view]),(0,i.useEffect)(()=>{I(y.status||[])},[y.status]),(0,i.useEffect)(()=>{O(y.searchQuery||"")},[y.searchQuery]),(0,i.useEffect)(()=>{P(y.minSize||"")},[y.minSize]),(0,i.useEffect)(()=>{V(y.maxSize||"")},[y.maxSize]),(0,i.useEffect)(()=>{var e;if((null==t||null==(e=t.site)?void 0:e.length)>0&&!y.site&&!j){let e=t.site[0];A(e),S({site:e})}},[null==t?void 0:t.site,y.site,j,S]);let Q=(0,i.useCallback)(e=>{let{target:{value:l}}=e;C(("string"==typeof l?l.split(","):l).filter(e=>"__apply__"!==e))},[]),X=(0,i.useCallback)(e=>{let{target:{value:l}}=e;U(("string"==typeof l?l.split(","):l).filter(e=>"__apply__"!==e))},[]),$=(0,i.useCallback)(e=>{let{target:{value:l}}=e;N(("string"==typeof l?l.split(","):l).filter(e=>"__apply__"!==e))},[]),J=(0,i.useCallback)(e=>{let{target:{value:l}}=e;k(("string"==typeof l?l.split(","):l).filter(e=>"__apply__"!==e))},[]),ee=(0,i.useCallback)(e=>{let{target:{value:l}}=e;I(("string"==typeof l?l.split(","):l).filter(e=>"__apply__"!==e))},[]),el=(0,i.useCallback)(()=>{S({infra:w})},[S,w]),et=(0,i.useCallback)(()=>{S({bedroom:z})},[S,z]),ea=(0,i.useCallback)(()=>{S({view:E})},[S,E]),ei=(0,i.useCallback)(()=>{S({direction:D})},[S,D]),er=(0,i.useCallback)(()=>{S({status:T})},[S,T]),en=null!==y.site||y.infra.length>0||y.bedroom.length>0||y.view.length>0||y.direction.length>0||y.status.length>0||""!==y.minSize||""!==y.maxSize||""!==y.searchQuery,es=(0,i.useCallback)(()=>{clearTimeout(_.current),A(null),C([]),U([]),k([]),N([]),I([]),O(""),P(""),V(""),q(!1),L(!1),S({site:null,infra:[],bedroom:[],view:[],direction:[],status:[],minSize:"",maxSize:"",searchQuery:""})},[S]),eo=(e,l)=>{let a=(t[e]||[]).find(e=>e.value===l);return a?a.label:String(l)},eu=(0,i.useMemo)(()=>({inputMode:"numeric",pattern:"[0-9]*",style:{textAlign:"right"}}),[]),ed=(0,i.useCallback)((e,l)=>{let t=""===e?-1:Number(e),a=""===l?-1:Number(l),i=!1,r=!1;return -1!==t&&(t<0||t>99999)?i="Value must be between 0 and 99999":-1!==t&&-1!==a&&t>a&&(i="Min value cannot exceed max value"),-1!==a&&(a<0||a>99999)?r="Value must be between 0 and 99999":-1!==t&&-1!==a&&a<t&&(r="Max value cannot be less than min value"),{minErr:i,maxErr:r}},[]),ec=(0,i.useCallback)(e=>{let l=e.target.value;if(""!==l&&!/^\d+$/.test(l))return;P(l);let{minErr:t,maxErr:a}=ed(l,M);q(t),L(a)},[M,ed]),ef=(0,i.useCallback)(e=>{let l=e.target.value;if(""!==l&&!/^\d+$/.test(l))return;V(l);let{minErr:t,maxErr:a}=ed(F,l);q(t),L(a)},[F,ed]);return(0,i.useEffect)(()=>{B?S({minSize:""}):S({minSize:F})},[F,B,S]),(0,i.useEffect)(()=>{W?S({maxSize:""}):S({maxSize:M})},[M,W,S]),(0,a.jsxs)(s.A,{sx:{width:"100%",gap:{xs:1,sm:2,md:2},display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(3, 1fr)",md:"repeat(5, 1fr)",lg:"repeat(auto-fit, minmax(180px, 1fr))"},...v},children:[(0,a.jsx)(o.default,{value:j,options:t.site,getOptionLabel:e=>e.label||"Unknown",onChange:(e,l)=>{A(l),S({site:l})},renderInput:e=>(0,a.jsx)(u.default,{...e,label:"Select Site"}),size:"small"}),(0,a.jsxs)(d.A,{sx:{flexShrink:0},size:"small",disabled:!y.site,children:[(0,a.jsx)(c.default,{htmlFor:"filter-infra-select",children:"Select Building"}),(0,a.jsxs)(f.A,{ref:H,multiple:!0,value:y.site?w:[],onChange:Q,onClose:el,input:(0,a.jsx)(p.default,{label:"Select Building"}),renderValue:e=>e.map(e=>eo("infra",e)).join(", "),inputProps:{id:"filter-infra-select"},sx:{textTransform:"capitalize"},MenuProps:{PaperProps:{sx:{maxHeight:300}}},children:[t.infra.map(e=>(0,a.jsxs)(h.default,{value:e.value,children:[(0,a.jsx)(m.default,{disableRipple:!0,size:"small",checked:w.includes(e.value)}),e.label]},e.value)),(0,a.jsx)(g,{onApply:el,selectRef:H})]})]}),(0,a.jsxs)(d.A,{sx:{flexShrink:0},size:"small",children:[(0,a.jsx)(c.default,{htmlFor:"filter-bedroom-select",children:"Select Bedroom"}),(0,a.jsxs)(f.A,{ref:G,multiple:!0,value:z,onChange:X,onClose:et,input:(0,a.jsx)(p.default,{label:"Select Bedroom"}),renderValue:e=>e.map(e=>e).join(", "),inputProps:{id:"filter-bedroom-select"},sx:{textTransform:"capitalize"},MenuProps:{PaperProps:{sx:{maxHeight:300}}},children:[t.bedroom.map(e=>(0,a.jsxs)(h.default,{value:e.value,children:[(0,a.jsx)(m.default,{disableRipple:!0,size:"small",checked:z.includes(e.value)}),e.label]},e.value)),(0,a.jsx)(g,{onApply:et,selectRef:G})]})]}),(0,a.jsxs)(d.A,{sx:{flexShrink:0},size:"small",children:[(0,a.jsx)(c.default,{htmlFor:"filter-direction-select",children:"Select Direction"}),(0,a.jsxs)(f.A,{ref:K,multiple:!0,value:D,onChange:J,onClose:ei,input:(0,a.jsx)(p.default,{label:"Select Direction"}),renderValue:e=>e.map(e=>e).join(", "),inputProps:{id:"filter-direction-select"},sx:{textTransform:"capitalize"},MenuProps:{PaperProps:{sx:{maxHeight:300}}},children:[t.direction.map(e=>(0,a.jsxs)(h.default,{value:e,children:[(0,a.jsx)(m.default,{disableRipple:!0,size:"small",checked:D.includes(e)}),e]},e)),(0,a.jsx)(g,{onApply:ei,selectRef:K})]})]}),(0,a.jsxs)(d.A,{sx:{flexShrink:0},size:"small",children:[(0,a.jsx)(c.default,{htmlFor:"filter-view-select",children:"Select View"}),(0,a.jsxs)(f.A,{ref:Z,multiple:!0,value:E,onChange:$,onClose:ea,input:(0,a.jsx)(p.default,{label:"Select View"}),renderValue:e=>e.map(e=>e).join(", "),inputProps:{id:"filter-view-select"},sx:{textTransform:"capitalize"},MenuProps:{PaperProps:{sx:{maxHeight:300}}},children:[t.view.map(e=>(0,a.jsxs)(h.default,{value:e,children:[(0,a.jsx)(m.default,{disableRipple:!0,size:"small",checked:E.includes(e)}),e]},e)),(0,a.jsx)(g,{onApply:ea,selectRef:Z})]})]}),(0,a.jsxs)(d.A,{sx:{flexShrink:0},size:"small",children:[(0,a.jsx)(c.default,{htmlFor:"filter-status-select",children:"Select Status"}),(0,a.jsxs)(f.A,{ref:Y,multiple:!0,value:T,onChange:ee,onClose:er,input:(0,a.jsx)(p.default,{label:"Select Status"}),renderValue:e=>e.map(e=>eo("status",e)).join(", "),inputProps:{id:"filter-status-select"},sx:{textTransform:"capitalize"},MenuProps:{PaperProps:{sx:{maxHeight:300}}},children:[t.status.map(e=>(0,a.jsxs)(h.default,{value:e.value,children:[(0,a.jsx)(m.default,{disableRipple:!0,size:"small",checked:T.includes(e.value)}),e.label]},e.value)),(0,a.jsx)(g,{onApply:er,selectRef:Y})]})]}),(0,a.jsx)(u.default,{label:"Min. Size (sq ft)",value:F||"",onChange:ec,error:!!B,helperText:B||"",inputProps:eu,placeholder:"0-99999",size:"small",fullWidth:!0}),(0,a.jsx)(u.default,{label:"Max. Size (sq ft)",value:M||"",onChange:ef,error:!!W,helperText:W||"",inputProps:eu,placeholder:"0-99999",size:"small",fullWidth:!0}),(0,a.jsx)(u.default,{fullWidth:!0,size:"small",placeholder:"Search by unit no.",value:R||"",onChange:e=>{let l=e.target.value;/^\d*$/.test(l)&&(O(l),clearTimeout(_.current),_.current=setTimeout(()=>{S({searchQuery:l})},500))},onKeyDown:e=>{/[\d]|Backspace|ArrowLeft|ArrowRight|Tab|Enter/.test(e.key)||e.preventDefault(),"Enter"===e.key&&(clearTimeout(_.current),S({searchQuery:R}))},InputProps:{startAdornment:(0,a.jsx)(x.A,{position:"start",children:(0,a.jsx)(b.W,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),(0,a.jsx)(n.default,{title:"Reset all filters",arrow:!0,children:(0,a.jsx)(r.default,{variant:"contained",color:"inherit",size:"small",disabled:!en,onClick:es,startIcon:(0,a.jsx)(b.W,{icon:"solar:restart-bold"}),children:"Reset"})})]})}},31847:(e,l,t)=>{t.d(l,{I4:()=>U,JT:()=>A,KI:()=>w,Li:()=>z,ND:()=>m,Nz:()=>x,Oe:()=>y,Pu:()=>u,T7:()=>p,Xk:()=>r,c5:()=>S,dk:()=>b,eD:()=>v,eX:()=>C,en:()=>o,h0:()=>a,ie:()=>h,mA:()=>d,nz:()=>s,o4:()=>D,oU:()=>f,rl:()=>n,z4:()=>g,zR:()=>i,zf:()=>c});let a=[{value:"single",label:"Single Floor"},{value:"multiple",label:"Multiple Floor"}],i=[{value:"residential",label:"Residential"},{value:"commercial",label:"Commercial"},{value:"mixed",label:"Mixed Use"}],r=[{value:"available",label:"Available"},{value:"sold",label:"Sold"},{value:"reserved",label:"Reserved"},{value:"blocked",label:"Blocked"}],n=[{value:"north",label:"North"},{value:"south",label:"South"},{value:"east",label:"East"},{value:"west",label:"West"},{value:"northeast",label:"North East"},{value:"northwest",label:"North West"},{value:"southeast",label:"South East"},{value:"southwest",label:"South West"}],s=[{value:"garden",label:"Garden View"},{value:"city",label:"City View"},{value:"sea",label:"Sea View"},{value:"mountain",label:"Mountain View"},{value:"pool",label:"Pool View"},{value:"road",label:"Road View"}],o=[{label:"1 BHK",value:"1 BHK"},{label:"2 BHK",value:"2 BHK"},{label:"3 BHK",value:"3 BHK"},{label:"4 BHK",value:"4 BHK"},{label:"Studio Apartment",value:"Studio Apartment"},{label:"Penthouse",value:"Penthouse"},{label:"Duplex",value:"Duplex"},{label:"Triplex",value:"Triplex"},{label:"Office Space",value:"Office Space"},{label:"Retail Shop",value:"Retail Shop"},{label:"Coworking Space",value:"Coworking Space"},{label:"Showroom",value:"Showroom"},{label:"Row House",value:"Row House"},{label:"Bungalow",value:"Bungalow"},{label:"Farmhouse",value:"Farmhouse"},{label:"Factory Unit",value:"Factory Unit"},{label:"Warehouse/Storage",value:"Warehouse/Storage"},{label:"None/Unknown",value:null}],u=["North","South","East","West","Northeast","Northwest","Southeast","Southwest"],d=[{label:"Available",value:"Available"},{label:"Booked",value:"Booked"},{label:"Purchased",value:"Purchased"},{label:"Sold",value:"Sold"},{label:"None/Unknown",value:null}],c=["Garden View","City View","Sea View","Lake View","Mountain View","Pool View","Street View","Main Road View","Open Land View","Forest View","Industrial Area View","Highway View"],f={available:"success",booked:"warning",purchased:"info",sold:"error"},p=[{label:"New",value:"New"},{label:"Completed",value:"Completed"}],h=[{label:"Today",value:"today"},{label:"This week",value:"this_week"},{label:"Overdue",value:"overdue"}],m={New:{color:"secondary",label:"New"},Completed:{color:"success",label:"Completed"}},x=[{value:"Call",label:"Call"},{value:"Text/SMS",label:"Text/SMS"},{value:"Email",label:"Email"},{value:"Meeting",label:"Meeting"},{value:"Other",label:"Other"}],b=[{value:"Pending",label:"Pending"},{value:"Completed",label:"Completed"},{value:"Cancelled",label:"Cancelled"},{value:"Rescheduled",label:"Rescheduled"},{value:"No Response",label:"No Response"}],g=[{group:"",classify:["New","Win","Lost","Visit","Stale","Qualify"]}],v=[{label:"New",value:"New"},{label:"Win",value:"Win"},{label:"Lost",value:"Lost"},{label:"Visit",value:"Visit"},{label:"Stale",value:"Stale"},{label:"Qualify",value:"Qualify"}],y=[{group:"Social Media(Specific)",classify:["Facebook","Instagram","Twitter/X","YouTube","WhatsApp","Reddit"]},{group:"Offline",classify:["Broker","Walk-in","Event/Expo","Networking","Print Advertisement"]},{group:"Online",classify:["Housing.com","Website","Email Campaign","Online Ads","Webinar","Social Media"]},{group:"Referral & Partner",classify:["Referral","Partner","Existing Customer","Employee Referral"]},{group:"Direct Outreach",classify:["Cold Call","Direct Mail","Door-to-Door Sales","Sales Team Outreach"]},{group:"Other",classify:["Other"]}],S=[{label:"Scheduled",value:"Scheduled"},{label:"Rescheduled",value:"Rescheduled"},{label:"Completed",value:"Completed"},{label:"Cancelled",value:"Cancelled"}],j=e=>({label:e,value:e}),A=["Property Viewing","Property Valuation","Market Analysis","Listing Consultation","Buyer Consultation","Property Inspection","Comparative Market Analysis","Investment Analysis","Rental Assessment","Final Walkthrough","Key Handover","Document Signing","Site Measurement","Photography/Marketing","Open House Preparation","Neighborhood Tour","Follow-up Visit","Client Meeting","Other"].map(j),w=["Positive","Neutral","Negative"].map(j),C={OVERDUE:"overdue",TODAY:"today",THIS_WEEK:"this_week",SCHEDULED:"scheduled",NONE:"none"},z={[C.OVERDUE]:"Overdue",[C.TODAY]:"Today",[C.THIS_WEEK]:"This Week",[C.SCHEDULED]:"Scheduled",[C.NONE]:"None"},U=e=>{if(!e)return C.NONE;let l=e.toLowerCase().trim().replace(/\s+/g,"_");return Object.values(C).includes(l)?l:C.NONE},D=function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(U(e)){case C.OVERDUE:return{label:"⚠️ ".concat(l||1,"d overdue"),emoji:"⚠️",text:"".concat(l||1,"d overdue"),color:"error"};case C.TODAY:return{label:"\uD83D\uDCC5 Due Today",emoji:"\uD83D\uDCC5",text:"Due Today",color:"warning"};case C.THIS_WEEK:return{label:"\uD83D\uDDD3️ This Week",emoji:"\uD83D\uDDD3️",text:"This Week",color:"warning"};case C.SCHEDULED:if(t){let e=new Date,l=Math.ceil((new Date(t)-e)/864e5);if(l>0&&l<=7)return{label:"✅ In ".concat(l,"d"),emoji:"✅",text:"In ".concat(l,"d"),color:"info"};return{label:"✅ Scheduled",emoji:"✅",text:"Scheduled",color:"info",date:t}}return{label:"✅ Scheduled",emoji:"✅",text:"Scheduled",color:"info"};case C.NONE:default:return{label:"—",emoji:"",text:"—",color:"default"}}}},37890:(e,l,t)=>{t.d(l,{$h:()=>s,My:()=>o,_r:()=>r,dF:()=>u,mv:()=>i,rN:()=>n});let a=(e,l)=>e.label.localeCompare(l.label),i=(e,l,t)=>{var i;return(null==e||null==(i=e.map(e=>({label:e[l],value:e[t]})))?void 0:i.sort(a))||[]},r=(e,l,t)=>{let i=new Map;return null==e||e.forEach(e=>{let a=e[t];i.has(a)||i.set(a,{label:e[l],value:a})}),Array.from(i.values()).sort(a)},n=(e,l,t)=>{if(!Array.isArray(e)||"function"!=typeof t)return;let a=e;Array.isArray(null==l?void 0:l.infra)&&l.infra.length>0&&(a=e.filter(e=>l.infra.includes(e.InfraId))),t(a.reduce((e,l)=>{let t=Number(l.InfraFloorCount)||0;return t>e?t:e},0))};function s(e){let{inputData:l,filters:t}=e;if(!(null==l?void 0:l.length))return[];let{site:a,infra:i,bedroom:r,view:n,direction:s,searchQuery:o,minSize:u,maxSize:d,status:c,floor:f}=t;if(null===a)return[];if(!i.length&&!r.length&&!n.length&&!s.length&&!c.length&&-1===f&&""===o&&""===u&&""===d)return l;let p=i.length>0,h=r.length>0,m=n.length>0,x=s.length>0,b=c.length>0,g=f>=0,v=o.length>0,y=""!==u&&""===d,S=""!==d&&""===u,j=""!==u&&""!==d;console.log("hasMinSizeFilter",y),console.log("hasMaxSizeFilter",S);let A=p?new Set(i):null,w=h?new Set(r):null,C=m?new Set(n):null,z=x?new Set(s):null,U=b?new Set(c):null,D=Number(u),k=Number(d);return l.filter(e=>(!p||!!A.has(e.InfraId))&&(!h||!!w.has(e.UnitType))&&(!m||!!C.has(e.View))&&(!x||!!z.has(e.Direction))&&(!b||!!U.has(e.AvailabilityStatus))&&(!g||f===e.FloorNumber)&&(!v||!!e.UnitNumber.toString().includes(o))&&(!y||e.UnitSize>D)&&(!S||e.UnitSize<k)&&(!j||!!(e.UnitSize>D&&e.UnitSize<k))&&!0)}let o=e=>{if("number"!=typeof e||e<0)return[];let l=[];for(let t=e-1;t>=1;t--)l.push({label:String(t),value:t});return l.push({label:"Ground",value:0}),l},u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},53889:(e,l,t)=>{t.d(l,{b:()=>D});var a=t(95155),i=t(38543),r=t(62177),n=t(90221),s=t(12115),o=t(96801),u=t(68074),d=t(15843),c=t(9670),f=t(78822),p=t(53494),h=t(15930),m=t(80158),x=t(66292),b=t(2360),g=t(5551),v=t(7433),y=t(49742),S=t(72635),j=t(74234),A=t(13896),w=t(56117),C=t(31847),z=t(38867),U=t(54961);function D(e){let{open:l,onClose:t,actionItemsMutate:D,infraUnitId:k}=e,{infraUnitsData:E,infraUnitsLoading:N}=(0,w.oB)(k),T=(0,s.useMemo)(()=>{var e,l,t,a,i;return{InfraId:(null==E?void 0:E.InfraId)||0,UnitNumber:(null==E?void 0:E.UnitNumber)||0,FloorNumber:null!=(i=null==E?void 0:E.FloorNumber)?i:0,UnitSize:(null==E?void 0:E.UnitSize)||0,UnitType:(null==E?void 0:E.UnitType)||"",AvailabilityStatus:(null==E?void 0:E.AvailabilityStatus)||"",Direction:(null==E||null==(e=E.Direction)?void 0:e.toLowerCase())||"",View:(null==E||null==(a=E.View)||null==(t=a.split(" "))||null==(l=t[0])?void 0:l.toLowerCase())||"",PurchaseReason:(null==E?void 0:E.PurchaseReason)||""}},[E]),I=(0,r.mN)({mode:"all",resolver:(0,n.u)(A.FA),defaultValues:T}),{reset:R,handleSubmit:O,trigger:F,formState:{isSubmitting:P,isDirty:M,errors:V}}=I;(0,s.useEffect)(()=>{l&&R(T)},[T,R,l]);let B=(0,s.useCallback)(()=>{R(T)},[R,T]),q=O(async e=>{console.log("Submit handler - Form errors:",V),console.log("Submit handler - Form data:",e);try{let l={InfraId:Number(e.InfraId),UnitNumber:Number(e.UnitNumber),FloorNumber:Number(e.FloorNumber),UnitSize:Number(e.UnitSize),UnitType:e.UnitType,AvailabilityStatus:e.AvailabilityStatus,Direction:e.Direction,View:e.View,PurchaseReason:e.PurchaseReason};await (0,j._y)({newInfraUnitsData:l,id:k}),i.oR.success("Infra Unit ".concat(k," updated successfully!")),D(),B(),t()}catch(e){console.error("Error updating infra unit:",e),i.oR.error("Error updating infra unit!")}}),W=async e=>{if(!await F()||Object.keys(V).length>0){console.error("Validation errors detected:",V),i.oR.error("Please fix form errors before submitting");return}k&&await q(e)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.default,{disableRipple:!0,variant:"contained",color:"inherit",component:S.W,href:y.f.dashboard.site.infraunits,startIcon:(0,a.jsx)(d.A,{}),sx:{mx:2,my:1},children:"New Infra Unit"}),(0,a.jsxs)(g.Ay,{anchor:"right",open:l,onClose:t,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:400,maxWidth:"90vw",display:"flex",flexDirection:"column",height:"100%"}},transitionDuration:300,children:[(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.A,{sx:{py:2,pr:1,pl:2.5,display:"flex",alignItems:"center"},children:[(0,a.jsxs)(c.default,{variant:"h6",sx:{flexGrow:1},children:[k?"Edit":"Add"," an Infra Unit"]}),(0,a.jsx)(f.default,{title:"Reset Form",arrow:!0,children:(0,a.jsx)(p.default,{onClick:B,children:(0,a.jsx)(h.default,{color:"error",variant:"dot",invisible:!M,children:(0,a.jsx)(z.W,{icon:"solar:restart-bold",width:24,height:24})})})}),(0,a.jsx)(p.default,{onClick:t,children:(0,a.jsx)(z.W,{icon:"mingcute:close-line",width:24,height:24})})]}),(0,a.jsx)(m.default,{sx:{borderStyle:"dashed"}})]}),(0,a.jsx)(o.A,{sx:{flexGrow:1,overflowY:"auto"},children:N?(0,a.jsx)(v.A,{}):(0,a.jsx)(U.lV,{methods:I,onSubmit:e=>W(e),id:"infra-unit-form",children:(0,a.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2,flexGrow:1,height:"100%",p:2},children:[(0,a.jsxs)(o.A,{sx:{display:"flex",gap:2},children:[(0,a.jsx)(U.D0.Text2,{name:"UnitNumber",label:"Unit Number",placeholder:"e.g., 202",type:"number",required:!0}),(0,a.jsx)(U.D0.Text2,{name:"FloorNumber",label:"Floor Number",placeholder:"e.g., 2",type:"number",required:!0})]}),(0,a.jsxs)(o.A,{sx:{display:"flex",gap:2},children:[(0,a.jsx)(U.D0.Text2,{name:"UnitSize",label:"Unit Size (sq. ft.)",placeholder:"e.g., 557.47",type:"number",required:!0}),(0,a.jsx)(U.tX,{name:"UnitType",label:"Unit Type",placeholder:"Select direction",children:C.en.map(e=>(0,a.jsx)(b.default,{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)(U.D0.Select,{name:"AvailabilityStatus",label:"Availability Status",placeholder:"Select status",required:!0,children:[(0,a.jsx)(b.default,{value:"Available",children:"Available"}),(0,a.jsx)(b.default,{value:"Sold",children:"Sold"}),(0,a.jsx)(b.default,{value:"Booked",children:"Booked"}),(0,a.jsx)(b.default,{value:"Reserved",children:"Reserved"})]}),(0,a.jsxs)(o.A,{sx:{display:"flex",gap:2},children:[(0,a.jsx)(U.tX,{name:"Direction",label:"Direction",placeholder:"Select direction",children:C.rl.map(e=>(0,a.jsx)(b.default,{value:e.value,children:e.label},e.value))}),(0,a.jsx)(U.tX,{name:"View",label:"View",placeholder:"Select view type",children:C.nz.map(e=>(0,a.jsx)(b.default,{value:e.value,children:e.label},e.value))})]}),(0,a.jsx)(U.D0.Text2,{name:"PurchaseReason",label:"Purchase Reason",placeholder:"Enter reason for purchase",multiline:!0,minRows:4})]})})}),(0,a.jsxs)(o.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2,p:2},children:[(0,a.jsx)(x.default,{onClick:t,color:"inherit",variant:"outlined",children:"Cancel"}),(0,a.jsx)(u.default,{type:"submit",variant:"contained",loading:P,disabled:P,form:"infra-unit-form",onClick:q,children:P?"Editing...":"Edit"})]})]})]})}},56117:(e,l,t)=>{t.d(l,{AK:()=>u,oB:()=>d,zS:()=>o});var a=t(19169),i=t(12115),r=t(18835);let n=async e=>{let[l,t]=Array.isArray(e)?e:[e];try{return(await r.Ay.get(l,{...t})).data}catch(e){if("string"==typeof e&&(e.includes("No infrastructure found")||e.includes("No data found")||e.includes("not found")))return[];throw console.error("Failed to fetch (".concat(l,"):"),e),e}},s={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function o(e){let l=e?[r.vZ.infraUnit.searchBySiteId(e)]:"",{data:t,isLoading:o,error:u,isValidating:d,mutate:c}=(0,a.Ay)(l,n,s),f=u&&"string"==typeof u&&(u.includes("No infrastructure found")||u.includes("not found")||u.includes("No data found"));return(0,i.useMemo)(()=>({infraUnitsData:f||!t?[]:t,infraUnitsLoading:o,infraUnitsError:f?null:u?(null==u?void 0:u.message)||"Error fetching (useGetDetailedLead)":null,infraUnitsValidating:d,infraUnitsEmpty:!o&&!d&&(!Array.isArray(t)||0===t.length||f),refetch:()=>c()}),[t,u,o,d,c,f])}function u(e,l,t,n,o){let u=e=>null==e||""===e||"string"==typeof e&&""===e.trim(),d=!u(e)||!u(l)||!u(t)||!u(n)||!u(o),c=d?r.vZ.infraUnit.searchSWR(e,l,t,n,o):null,{data:f,isLoading:p,error:h,isValidating:m,mutate:x}=(0,a.Ay)(c,r.GO,s);return(0,i.useMemo)(()=>({infraUnitSearchData:null!=f?f:[],infraUnitSearchLoading:p&&d,infraUnitSearchError:h?(null==h?void 0:h.message)||"Error searching infra units":null,infraUnitSearchValidating:m&&d,infraUnitSearchEmpty:d&&!p&&!m&&(!Array.isArray(f)||0===f.length),refetchInfraUnit:()=>d&&x(),hasValidParams:d}),[f,h,p,m,x,d])}function d(e){let l=e?[r.vZ.infraUnit.readSingle(e)]:"",{data:t,isLoading:n,error:o,isValidating:u,mutate:d}=(0,a.Ay)(l,r.GO,s);return(0,i.useMemo)(()=>({infraUnitsData:null!=t?t:[],infraUnitsLoading:n,infraUnitsError:o?(null==o?void 0:o.message)||"Error fetching (useGetDetailedLead)":null,infraUnitsValidating:u,infraUnitsEmpty:!n&&!u&&(!Array.isArray(t)||0===t.length),refetch:()=>d()}),[t,o,n,u,d])}},71984:(e,l,t)=>{t.d(l,{MZ:()=>s,Q$:()=>u,d0:()=>o,lr:()=>d});var a=t(19169),i=t(12115),r=t(18835);let n={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function s(){let e=r.vZ.site.readAll,{data:l,isLoading:t,error:s,isValidating:o,mutate:u}=(0,a.Ay)(e,r.GO,n);return(0,i.useMemo)(()=>({sitesData:null!=l?l:[],sitesLoading:t,sitesError:s?(null==s?void 0:s.message)||"Error fetching data":null,sitesValidating:o,sitesEmpty:!t&&!o&&(!Array.isArray(l)||0===l.length),mutateAllSites:u}),[l,s,t,o,u])}function o(){let e=r.vZ.site.siteType,{data:l,isLoading:t,error:s,isValidating:o,mutate:u}=(0,a.Ay)(e,r.GO,n);return(0,i.useMemo)(()=>({sitesTypeData:null!=l?l:[],sitesTypeLoading:t,sitesTypeError:s?(null==s?void 0:s.message)||"Error fetching data":null,sitesTypeValidating:o,sitesTypeEmpty:!t&&!o&&(!Array.isArray(l)||0===l.length),getAllSitesMutations:u}),[l,s,t,o,u])}function u(){let e=r.vZ.site.siteFullDetails,{data:l,isLoading:t,error:s,isValidating:o,mutate:u}=(0,a.Ay)(e,r.GO,n);return(0,i.useMemo)(()=>({siteFullData:null!=l?l:[],siteFullLoading:t,siteFullError:s?(null==s?void 0:s.message)||"Error fetching data":null,siteFullValidating:o,siteFullEmpty:!t&&!o&&(!Array.isArray(l)||0===l.length),getSiteFullDetailsMutation:u}),[l,s,t,o,u])}function d(e){let l=e?r.vZ.site.readSingle(e):null,{data:t,isLoading:s,error:o,isValidating:u,mutate:d}=(0,a.Ay)(l,r.GO,n);return(0,i.useMemo)(()=>({siteData:null!=t?t:[],siteLoading:s,siteError:o?(null==o?void 0:o.message)||"Error fetching data":null,siteValidating:u,siteEmpty:!s&&!u&&(!Array.isArray(t)||0===t.length),getSiteMutation:d}),[t,o,s,u,d])}},74378:(e,l,t)=>{t.d(l,{_:()=>o});var a=t(19169),i=t(12115),r=t(18835);let n=async e=>{let[l,t]=Array.isArray(e)?e:[e];try{return(await r.Ay.get(l,{...t})).data}catch(e){if("string"==typeof e&&(e.includes("No infrastructure found")||e.includes("not found")))return[];throw console.error("Failed to fetch (".concat(l,"):"),e),e}},s={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function o(e){let l=e?[r.vZ.siteInfra.searchBySiteId(e)]:"",{data:t,isLoading:o,error:u,isValidating:d,mutate:c}=(0,a.Ay)(l,n,s),f=u&&"string"==typeof u&&(u.includes("No infrastructure found")||u.includes("not found"));return(0,i.useMemo)(()=>({infrasData:f||!t?[]:t,infrasLoading:o,infrasError:f?null:u?(null==u?void 0:u.message)||"Error fetching (useGetDetailedLead)":null,infrasValidating:d,infrasEmpty:!o&&!d&&(!Array.isArray(t)||0===t.length||f),refetch:()=>c()}),[t,u,o,d,c,f])}},75191:(e,l,t)=>{t.d(l,{_q:()=>u,ce:()=>o,qy:()=>s});var a=t(19169),i=t(12115),r=t(18835);let n={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function s(){let e=r.vZ.infra.readAll,{data:l,isLoading:t,error:s,isValidating:o,mutate:u}=(0,a.Ay)(e,r.GO,n);return(0,i.useMemo)(()=>({infrasData:null!=l?l:[],infrasLoading:t||o,infrasError:s?(null==s?void 0:s.message)||"Error fetching infras":null,infrasValidating:o,infrasEmpty:!t&&!o&&(!Array.isArray(l)||0===l.length),getAllInfrasMutations:()=>u()}),[l,s,t,o,u])}function o(e){let l=e?r.vZ.infra.readSingle(e):null,{data:t,isLoading:s,error:o,isValidating:u,mutate:d}=(0,a.Ay)(l,r.GO,n);return(0,i.useMemo)(()=>({infraData:null!=t?t:[],infraLoading:s,infraError:o?(null==o?void 0:o.message)||"Error fetching infras":null,infraValidating:u,infraEmpty:!s&&!u&&(!Array.isArray(t)||0===t.length),getInfraMutation:()=>d()}),[t,o,s,u,d])}function u(e){var l,t,s,o,u,d,c;let f=e?r.vZ.infra.getBySiteId(e):null,{data:p,isLoading:h,error:m,isValidating:x,mutate:b}=(0,a.Ay)(f,r.ev,n),g=m&&((null==(s=m.response)||null==(t=s.data)||null==(l=t.detail)?void 0:l.includes("No infrastructure found"))||(null==(d=m.response)||null==(u=d.data)||null==(o=u.detail)?void 0:o.includes("not found"))||(null==(c=m.response)?void 0:c.status)===404);return(0,i.useMemo)(()=>({infrasData:g||!p?[]:p,infrasLoading:h,infrasError:g?null:m?(null==m?void 0:m.message)||"Error fetching infrastructure":null,infrasValidating:x,infrasEmpty:!h&&!x&&(!Array.isArray(p)||0===p.length||g),refetch:()=>b()}),[p,m,h,x,b,g])}},79262:(e,l,t)=>{t.d(l,{y:()=>U});var a=t(95155),i=t(38543),r=t(62177),n=t(90221),s=t(12115),o=t(96801),u=t(68074),d=t(15843),c=t(9670),f=t(78822),p=t(53494),h=t(15930),m=t(80158),x=t(66292),b=t(2360),g=t(5551),v=t(7433),y=t(75191),S=t(71984),j=t(13896),A=t(74234),w=t(38867),C=t(54961);let z=["Residential","Commercial","Mixed","Other"];function U(e){var l,t;let{open:U,onOpen:D,onClose:k,actionItemsMutate:E,infrasData:N,infraId:T,sites:I}=e,{infraData:R,infraLoading:O}=(0,y.ce)(U&&T?T:null),{sitesData:F,sitesLoading:P}=(0,S.MZ)(),M=(0,s.useMemo)(()=>({SiteId:(null==R?void 0:R.SiteId)||"",InfraName:(null==R?void 0:R.InfraName)||"",InfraCategory:(null==R?void 0:R.InfraCategory)||"",InfraFloorCount:(null==R?void 0:R.InfraFloorCount)||0,AvailableUnits:(null==R?void 0:R.AvailableUnits)||0,SoldUnits:(null==R?void 0:R.SoldUnits)||0,BookedUnits:(null==R?void 0:R.BookedUnits)||0,TotalUnits:parseInt(null==R?void 0:R.TotalUnits)||0}),[R]),V=(0,r.mN)({mode:"all",resolver:(0,n.u)(j.ed),defaultValues:M}),{reset:B,handleSubmit:q,watch:W,setValue:L,formState:{isSubmitting:_,isDirty:H}}=V,G=(0,s.useCallback)(()=>{B(M)},[B,M]);(0,s.useEffect)(()=>{U&&B(M)},[M,B,U,T]),(0,s.useEffect)(()=>{let e=W((e,l)=>{let{name:t}=l;if("AvailableUnits"===t||"SoldUnits"===t||"BookedUnits"===t){let l=e.AvailableUnits||0,t=e.SoldUnits||0;L("TotalUnits",l+t+(e.BookedUnits||0),{shouldValidate:!0})}});return()=>e.unsubscribe()},[W,L]);let K=q(async e=>{try{let l={SiteId:e.SiteId,InfraName:e.InfraName,InfraCategory:e.InfraCategory,TotalUnits:""+e.TotalUnits,AvailableUnits:e.AvailableUnits,SoldUnits:e.SoldUnits,BookedUnits:e.BookedUnits,InfraFloorCount:e.InfraFloorCount},t=await (0,A.HV)(l);i.oR.success("Infra ".concat(t.InfraId," created successfully!")),E(),k()}catch(e){console.error("Error creating site:",e),i.oR.error("Error creating site!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})}}),Z=q(async e=>{try{let l={SiteId:e.SiteId,InfraName:e.InfraName,InfraCategory:e.InfraCategory,TotalUnits:""+e.TotalUnits,AvailableUnits:e.AvailableUnits,SoldUnits:e.SoldUnits,BookedUnits:e.BookedUnits,InfraFloorCount:e.InfraFloorCount};await (0,A.zx)({newInfraData:l,id:T}),i.oR.success("Infra ".concat(T," updated successfully!")),E(),k()}catch(e){console.error("Error creating site:",e),i.oR.error("Error creating site!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})}}),Y=async e=>{T?await Z(e):await K(e)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.default,{disableRipple:!0,variant:"contained",color:"inherit",onClick:()=>D(),startIcon:(0,a.jsx)(d.A,{}),sx:{mx:2,my:1},children:"New Infra"}),(0,a.jsxs)(g.Ay,{anchor:"right",open:U,onClose:k,onKeyDown:e=>{"Escape"===e.key&&k()},slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:{xs:"100%",sm:500,md:500},maxWidth:"100vw",display:"flex",flexDirection:"column",height:"100%"}},transitionDuration:300,children:[(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.A,{sx:{py:2,pr:1,pl:2.5,display:"flex",alignItems:"center"},children:[(0,a.jsxs)(c.default,{variant:"h6",sx:{flexGrow:1},children:[T?"Edit":"Create New"," Infrastructure"]}),(0,a.jsx)(f.default,{title:"Reset Form",arrow:!0,children:(0,a.jsx)(p.default,{onClick:G,children:(0,a.jsx)(h.default,{color:"error",variant:"dot",invisible:!H,children:(0,a.jsx)(w.W,{icon:"solar:restart-bold",width:24,height:24})})})}),(0,a.jsx)(p.default,{onClick:k,children:(0,a.jsx)(w.W,{icon:"mingcute:close-line",width:24,height:24})})]}),(0,a.jsx)(m.default,{sx:{borderStyle:"dashed"}})]}),O||P?(0,a.jsxs)(o.A,{sx:{p:3},children:[(0,a.jsx)(v.A,{}),(0,a.jsxs)(c.default,{variant:"body2",sx:{mt:1,color:"text.secondary"},children:["Loading ",O?"infrastructure":"sites"," data..."]})]}):(0,a.jsx)(C.lV,{methods:V,onSubmit:Y,children:(0,a.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:3,flexGrow:1,height:"100%",p:3,overflowY:"auto"},children:[(0,a.jsxs)(o.A,{children:[(0,a.jsx)(c.default,{variant:"subtitle2",sx:{mb:1.5,fontWeight:600,color:"text.secondary"},children:"Basic Information"}),(0,a.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,a.jsxs)(o.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2},children:[(0,a.jsx)(C.D0.Select,{name:"SiteId",label:"Site",placeholder:"Select a site",helperText:"Choose the site this infrastructure belongs to",disabled:(null==(l=I||F)?void 0:l.length)===1,required:!0,autoFocus:U,size:"small",children:P?(0,a.jsx)(b.default,{disabled:!0,children:"Loading sites..."}):(null==(t=I||F)?void 0:t.length)>0?(I||F).map(e=>{let{SiteId:l,SiteName:t}=e;return(0,a.jsx)(b.default,{value:l,children:t},l)}):(0,a.jsx)(b.default,{disabled:!0,children:"No sites available"})}),(0,a.jsx)(C.D0.Text2,{name:"InfraName",label:"Infrastructure Name",placeholder:"e.g., Tower A, Building 1",helperText:"Unique name to identify this infrastructure",required:!0,size:"small"})]}),(0,a.jsxs)(o.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2},children:[(0,a.jsx)(C.D0.Select,{name:"InfraCategory",label:"Category",placeholder:"Select category",helperText:"Type of property",required:!0,size:"small",children:z.map(e=>(0,a.jsx)(b.default,{value:e,children:e},e))}),(0,a.jsx)(C.D0.Text2,{name:"InfraFloorCount",label:"Number of Floors",placeholder:"e.g., 15",helperText:"Total floors (ground to top)",required:!0,type:"number",size:"small"})]})]})]}),(0,a.jsx)(m.default,{sx:{borderStyle:"dashed"}}),(0,a.jsxs)(o.A,{children:[(0,a.jsx)(c.default,{variant:"subtitle2",sx:{mb:1.5,fontWeight:600,color:"text.secondary"},children:"Unit Distribution"}),(0,a.jsxs)(o.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2},children:[(0,a.jsx)(C.D0.Text2,{name:"AvailableUnits",label:"Available Units",placeholder:"e.g., 50",helperText:"Units available for sale",required:!0,type:"number",size:"small"}),(0,a.jsx)(C.D0.Text2,{name:"SoldUnits",label:"Sold Units",placeholder:"e.g., 30",helperText:"Units already sold",required:!0,type:"number",size:"small"}),(0,a.jsx)(C.D0.Text2,{name:"BookedUnits",label:"Booked Units",placeholder:"e.g., 20",helperText:"Units under booking",required:!0,type:"number",size:"small"}),(0,a.jsx)(C.D0.Text2,{name:"TotalUnits",label:"Total Units",placeholder:"e.g., 100",helperText:"Auto-calculated (can be overridden)",required:!0,type:"number",size:"small"})]}),(0,a.jsx)(o.A,{sx:{mt:2,p:1.5,backgroundColor:"primary.lighter",borderRadius:1,border:1,borderColor:"primary.light"},children:(0,a.jsxs)(c.default,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5,color:"primary.darker"},children:[(0,a.jsx)(w.W,{icon:"solar:calculator-minimalistic-bold",width:16}),(0,a.jsx)("strong",{children:"Calculation:"}),"\xa0",W("AvailableUnits")||0," + ",W("SoldUnits")||0," + ",W("BookedUnits")||0," = ",W("TotalUnits")||0]})})]}),(0,a.jsx)(o.A,{sx:{flexGrow:1}}),(0,a.jsxs)(o.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[(0,a.jsx)(x.default,{onClick:k,color:"inherit",variant:"outlined",children:"Cancel"}),(0,a.jsx)(u.default,{type:"submit",variant:"contained",loading:_,disabled:_,children:_?T?"Editing":"Creating...":T?"Edit":"Create"})]})]})})]})]})}},83469:(e,l,t)=>{t.d(l,{g:()=>y});var a=t(95155),i=t(35206),r=t(17764),n=t(72635),s=t(38867);function o(e){let{sx:l,label:t,...i}=e;return(0,a.jsxs)(r.A,{component:n.W,color:"inherit",underline:"none",sx:[e=>({verticalAlign:"middle",["& .".concat(s.M.root)]:{verticalAlign:"inherit",transform:"translateY(-2px)",ml:{xs:"-14px",md:"-18px"},transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.shorter,easing:e.transitions.easing.sharp})},"&:hover":{["& .".concat(s.M.root)]:{opacity:.48}}}),...Array.isArray(l)?l:[l]],...i,children:[(0,a.jsx)(s.W,{width:18,icon:"eva:arrow-ios-back-fill"}),t]})}var u=t(35881);function d(e){let{links:l,sx:t,...i}=e;return(0,a.jsx)(c,{sx:t,...i,children:null==l?void 0:l.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)(r.A,{href:e,variant:"body2",target:"_blank",rel:"noopener",children:e})},e))})}let c=(0,u.default)("ul")(()=>({display:"flex",flexDirection:"column","& > li":{display:"flex"}}));function f(e){let{href:l,icon:t,name:i,disabled:s,...o}=e,u=()=>(0,a.jsxs)(p,{disabled:s,...o,children:[t&&(0,a.jsx)(h,{children:t}),i]});return l?(0,a.jsx)(r.A,{component:n.W,href:l,color:"inherit",sx:{display:"inline-flex",...s&&{pointerEvents:"none"}},children:u()}):u()}let p=(0,u.default)("div",{shouldForwardProp:e=>!["disabled","sx"].includes(e)})(e=>{let{disabled:l,theme:t}=e;return{...t.typography.body2,alignItems:"center",gap:t.spacing(1),display:"inline-flex",color:t.vars.palette.text.primary,...l&&{cursor:"default",pointerEvents:"none",color:t.vars.palette.text.disabled}}}),h=(0,u.default)("span")(()=>({display:"inherit","& > :first-of-type:not(style):not(:first-of-type ~ *), & > style + *":{width:20,height:20}})),m=(0,u.default)("div")(e=>{let{theme:l}=e;return{display:"flex",flexDirection:"column",gap:l.spacing(2)}}),x=(0,u.default)("h6")(e=>{let{theme:l}=e;return{...l.typography.h4,margin:0,padding:0,display:"inline-flex"}}),b=(0,u.default)("div")(e=>{let{theme:l}=e;return{display:"flex",flexWrap:"wrap",gap:l.spacing(2),alignItems:"flex-start",justifyContent:"flex-end"}}),g=(0,u.default)("div")(e=>{let{theme:l}=e;return{display:"flex",flex:"1 1 auto",gap:l.spacing(2),flexDirection:"column"}}),v=(0,u.default)("span")(e=>{let{theme:l}=e;return{width:4,height:4,borderRadius:"50%",backgroundColor:l.vars.palette.text.disabled}});function y(e){var l,t;let{sx:r,action:n,backHref:s,heading:u,slots:c={},links:p=[],moreLinks:h=[],slotProps:y={},activeLast:S=!1,...j}=e,A=null==(l=p[p.length-1])?void 0:l.name;return(0,a.jsxs)(m,{sx:r,...j,children:[(0,a.jsxs)(b,{...null==y?void 0:y.container,children:[(0,a.jsxs)(g,{...null==y?void 0:y.content,children:[(u||s)&&(0,a.jsx)(x,{...null==y?void 0:y.heading,children:s?(0,a.jsx)(o,{href:s,label:u}):u}),(!!p.length||(null==c?void 0:c.breadcrumbs))&&(null!=(t=null==c?void 0:c.breadcrumbs)?t:(0,a.jsx)(i.A,{separator:(0,a.jsx)(v,{}),...null==y?void 0:y.breadcrumbs,children:p.map((e,l)=>{var t;return(0,a.jsx)(f,{icon:e.icon,href:e.href,name:e.name,disabled:e.name===A&&!S||!e.href},null!=(t=e.name)?t:l)})}))]}),n]}),!!(null==h?void 0:h.length)&&(0,a.jsx)(d,{links:h,...null==y?void 0:y.moreLinks})]})}}}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7331],{7497:(e,t,l)=>{"use strict";l.d(t,{M:()=>S});var a=l(95155),r=l(12115),i=l(96801),n=l(17764),o=l(21030),s=l(25949),d=l(60032),c=l(57236),u=l(72330),h=l(72137),x=l(9670),m=l(62516),p=l(49742),f=l(72635),g=l(32104),b=l(85098);let v={width:"90%",marginLeft:"3.5%",bgcolor:"background.paper",borderRadius:1,boxShadow:"0 1px 3px 0 rgba(0,0,0,0.1)",overflow:"auto",my:1.5,border:"1px solid",borderColor:"divider",maxWidth:"100%"},y={px:3,py:2,fontWeight:600,fontSize:"0.9rem",borderBottom:"1px solid",borderColor:"divider"},j={fontWeight:600,fontSize:"0.75rem"},w={fontSize:"0.875rem"},S=r.memo(function(e){let{id:t,type:l}=e,{visitByLeadData:S,visitByLeadLoading:C,visitByLeadError:I,visitByLeadEmpty:A}=(0,b.jE)("lead"===l?t:null),N=(0,r.useMemo)(()=>["Action","Visit Date","Site","Infra","Status","Purpose","Outlook"],[]);return(0,a.jsxs)(i.A,{sx:v,children:[(0,a.jsx)(x.default,{variant:"subtitle1",sx:y,children:"Visit History"}),C?(0,a.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,a.jsx)(m.default,{size:24})}):I?(0,a.jsx)(x.default,{color:"error",sx:{p:3},children:"Something Went Wrong, Please Try Again!"}):A||!S||0===S.length?(0,a.jsx)(x.default,{sx:{px:3,py:2,fontStyle:"italic",color:"text.secondary"},children:"No visit data available for this lead."}):(0,a.jsxs)(s.A,{size:"small",children:[(0,a.jsx)(h.A,{sx:{bgcolor:"#f7f7f9"},children:(0,a.jsx)(d.default,{children:N.map(e=>(0,a.jsx)(u.default,{sx:j,children:e},e))})}),(0,a.jsx)(c.A,{children:S.map(e=>{var t,l;return(0,a.jsxs)(d.default,{hover:!0,children:[(0,a.jsx)(u.default,{children:(0,a.jsx)(n.A,{component:f.W,href:p.f.dashboard.visit.profile(e.VisitId),underline:"hover",sx:w,"aria-label":"View details for visit ".concat(e.VisitId),children:"View More"})}),(0,a.jsx)(u.default,{children:(0,a.jsxs)(o.A,{spacing:.5,children:[(0,a.jsx)(i.A,{component:"span",sx:{fontSize:"0.875rem",fontWeight:500},children:(0,g.ts)(e.VisitDate)}),(0,a.jsx)(i.A,{component:"span",sx:{fontSize:"0.75rem",color:"text.secondary"},children:(0,g.qi)(e.VisitDate)})]})}),(0,a.jsx)(u.default,{sx:w,children:(null==(t=e.site)?void 0:t.SiteName)||"-"}),(0,a.jsx)(u.default,{sx:w,children:(null==(l=e.infra)?void 0:l.InfraName)||"-"}),(0,a.jsx)(u.default,{sx:w,children:e.VisitStatus||"-"}),(0,a.jsx)(u.default,{sx:w,children:e.Purpose||"-"}),(0,a.jsx)(u.default,{sx:w,children:e.VisitOutlook||"-"})]},e.VisitId)})})]})]})})},57185:(e,t,l)=>{"use strict";l.r(t),l.d(t,{LeadDetailList:()=>tm});var a=l(95155),r=l(38543),i=l(49742),n=l(35046),o=l(83469),s=l(45567),d=l(10478),c=l(36339),u=l(12115),h=l(11743),x=l(93972),m=l(73746),p=l(42861),f=l(96801),g=l(53494),b=l(9670),v=l(84256),y=l(66292),j=l(78822),w=l(10242),S=l(16957),C=l(77498),I=l(78880),A=l(26403),N=l(2360),k=l(15930),D=l(76681),M=l(7433),L=l(66587),W=l(55592),z=l(34152),R=l(62516),F=l(72635),U=l(31847);let P=e=>(0,d.Cp)({parse:t=>t?(Array.isArray(t)?t:[t]).map(t=>e.parse(t)).filter(e=>null!=e):[],serialize:t=>Array.isArray(t)&&0!==t.length?t.map(t=>e.serialize(t)):null}),T=P(d.tU),E=P(d.GJ),B=(0,d.Cp)({parse:e=>e&&""!==e?e:null,serialize:e=>e||""}),O=(0,d.Cp)({parse(e){if(!e||""===e)return null;let t=e.split("|");if(4===t.length){let[e,l,a,r]=t,i=parseInt(e,10);if(!isNaN(i))return{value:i,ContactFName:decodeURIComponent(l||""),ContactLName:decodeURIComponent(a||""),ContactNo:decodeURIComponent(r||""),label:"".concat(decodeURIComponent(l||"")," ").concat(decodeURIComponent(a||"")," (").concat(decodeURIComponent(r||""),")").trim()}}let l=parseInt(e,10);return isNaN(l)?null:{value:l}},serialize:e=>(null==e?void 0:e.value)?e.ContactFName||e.ContactLName||e.ContactNo?"".concat(e.value,"|").concat(encodeURIComponent(e.ContactFName||""),"|").concat(encodeURIComponent(e.ContactLName||""),"|").concat(encodeURIComponent(e.ContactNo||"")):e.value.toString():""}),H=(0,d.Cp)({parse:e=>e&&""!==e?(0,U.I4)(e):"",serialize:e=>e&&""!==e?e:""}),q={leadStatus:T.withDefault([]),leadSource:T.withDefault([]),site:E.withDefault([]),prospect:E.withDefault([]),broker:O.withDefault(null),customer:O.withDefault(null),startDate:B.withDefault(null),endDate:B.withDefault(null),healthScoreMin:d.GJ.withDefault(null),healthScoreMax:d.GJ.withDefault(null),buyingIntentMin:d.GJ.withDefault(null),buyingIntentMax:d.GJ.withDefault(null),overdueDaysMin:d.GJ.withDefault(null),overdueDaysMax:d.GJ.withDefault(null),followUpStatus:H.withDefault(""),healthScoreRange:d.tU.withDefault(""),buyingIntent:d.tU.withDefault(""),sortBy:d.tU.withDefault(null),page:d.GJ.withDefault(0),pageSize:d.GJ.withDefault(20)};var V=l(18835),_=l(71984),G=l(16531),J=l(97439),Q=l(88165),Y=l(38867),X=l(69004),K=l(1407),Z=l(68974),$=l(33106),ee=l(29716),et=l(62966),el=l(12422),ea=l(96358),er=l(44192),ei=l(89438),en=l(21030),eo=l(58821),es=l(55398);function ed(e){var t,l,n,o;let{broker:s}=e,d=e=>{e&&(navigator.clipboard.writeText(e),r.oR.success("Copied to clipboard",{containerId:"success",autoClose:2e3}))};return(0,a.jsxs)(f.A,{children:[(0,a.jsx)(b.default,{variant:"subtitle2",sx:{mb:1,color:"secondary.main",fontWeight:600},children:"BROKER INFORMATION"}),(0,a.jsx)(v.A,{sx:{p:1.5,bgcolor:"background.neutral",minHeight:100,display:"flex",alignItems:"center"},children:(null==s?void 0:s.id)?(0,a.jsxs)(f.A,{sx:{display:"flex",gap:2,alignItems:"center",width:"100%"},children:[(0,a.jsx)(es.A,{sx:{width:40,height:40,bgcolor:"secondary.main"},children:(null==(l=s.name)||null==(t=l.charAt(0))?void 0:t.toUpperCase())||"B"}),(0,a.jsxs)(f.A,{sx:{flex:1},children:[(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,a.jsx)(b.default,{variant:"body1",fontWeight:"600",children:s.name||"N/A"}),s.id&&(0,a.jsx)(F.W,{href:i.f.dashboard.contact.profile(s.id),target:"_blank",rel:"noopener noreferrer",children:(0,a.jsx)(g.default,{size:"small",sx:{p:.5},children:(0,a.jsx)(Y.W,{icon:"eva:external-link-fill",width:16})})})]}),(0,a.jsxs)(f.A,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[s.phone&&(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,a.jsx)(Y.W,{icon:"eva:phone-fill",width:16}),(0,a.jsx)(b.default,{variant:"caption",children:s.phone}),(0,a.jsx)(g.default,{size:"small",sx:{p:.25},onClick:()=>d(s.phone),children:(0,a.jsx)(Y.W,{icon:"eva:copy-fill",width:14})})]}),(null==(n=s.details)?void 0:n.ContactEmail)&&(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,a.jsx)(Y.W,{icon:"eva:email-fill",width:16}),(0,a.jsx)(b.default,{variant:"caption",children:s.details.ContactEmail}),(0,a.jsx)(g.default,{size:"small",sx:{p:.25},onClick:()=>d(s.details.ContactEmail),children:(0,a.jsx)(Y.W,{icon:"eva:copy-fill",width:14})})]}),(null==(o=s.details)?void 0:o.ContactAddress)&&(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,a.jsx)(Y.W,{icon:"eva:pin-fill",width:16}),(0,a.jsxs)(b.default,{variant:"caption",children:[s.details.ContactAddress,s.details.ContactCity&&", ".concat(s.details.ContactCity),s.details.ContactState&&", ".concat(s.details.ContactState),s.details.ContactPostalCode&&" - ".concat(s.details.ContactPostalCode)]})]})]})]})]}):(0,a.jsx)(f.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:(0,a.jsx)(b.default,{variant:"body2",color:"text.secondary",fontStyle:"italic",children:"No broker assigned"})})})]})}function ec(e){var t,l,n;let{customer:o}=e,s=e=>{e&&(navigator.clipboard.writeText(e),r.oR.success("Copied to clipboard",{containerId:"success",autoClose:2e3}))};return(0,a.jsxs)(f.A,{children:[(0,a.jsx)(b.default,{variant:"subtitle2",sx:{mb:1,color:"primary.main",fontWeight:600},children:"CUSTOMER INFORMATION"}),(0,a.jsx)(v.A,{sx:{p:1.5,bgcolor:"background.neutral",minHeight:100,display:"flex",alignItems:"center"},children:(null==o?void 0:o.id)?(0,a.jsxs)(f.A,{sx:{display:"flex",gap:2,alignItems:"center",width:"100%"},children:[(0,a.jsx)(es.A,{sx:{width:40,height:40,bgcolor:"primary.main"},children:(null==(l=o.name)||null==(t=l.charAt(0))?void 0:t.toUpperCase())||"?"}),(0,a.jsxs)(f.A,{sx:{flex:1},children:[(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,a.jsx)(b.default,{variant:"body1",fontWeight:"600",children:o.name||"N/A"}),o.id&&(0,a.jsx)(F.W,{href:i.f.dashboard.contact.profile(o.id),target:"_blank",rel:"noopener noreferrer",children:(0,a.jsx)(g.default,{size:"small",sx:{p:.5},children:(0,a.jsx)(Y.W,{icon:"eva:external-link-fill",width:16})})})]}),(0,a.jsxs)(f.A,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[o.phone&&(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,a.jsx)(Y.W,{icon:"eva:phone-fill",width:16}),(0,a.jsx)(b.default,{variant:"caption",children:o.phone}),(0,a.jsx)(g.default,{size:"small",sx:{p:.25},onClick:()=>s(o.phone),children:(0,a.jsx)(Y.W,{icon:"eva:copy-fill",width:14})})]}),o.email&&(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,a.jsx)(Y.W,{icon:"eva:email-fill",width:16}),(0,a.jsx)(b.default,{variant:"caption",children:o.email}),(0,a.jsx)(g.default,{size:"small",sx:{p:.25},onClick:()=>s(o.email),children:(0,a.jsx)(Y.W,{icon:"eva:copy-fill",width:14})})]}),(null==(n=o.details)?void 0:n.ContactAddress)&&(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,a.jsx)(Y.W,{icon:"eva:pin-fill",width:16}),(0,a.jsxs)(b.default,{variant:"caption",children:[o.details.ContactAddress,o.details.ContactCity&&", ".concat(o.details.ContactCity),o.details.ContactState&&", ".concat(o.details.ContactState),o.details.ContactPostalCode&&" - ".concat(o.details.ContactPostalCode)]})]})]})]})]}):(0,a.jsx)(f.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:(0,a.jsx)(b.default,{variant:"body2",color:"text.secondary",children:"No customer assigned"})})})]})}var eu=l(32104);function eh(e){let{dates:t}=e;if(!t)return null;let l=[{icon:"eva:plus-circle-fill",label:"Created",date:t.created,color:"primary.main"},{icon:"eva:edit-fill",label:"Last Updated",date:t.updated,color:"info.main"},{icon:"eva:checkmark-circle-2-fill",label:"Closed",date:t.closed,color:"success.main"}].filter(e=>e.date);return l.length?(0,a.jsxs)(f.A,{children:[(0,a.jsx)(b.default,{variant:"subtitle2",sx:{mb:.5,fontWeight:600},children:"TIMELINE"}),(0,a.jsx)(v.A,{sx:{p:1,minHeight:60,display:"flex",alignItems:"center"},children:(0,a.jsx)(en.A,{spacing:.25,sx:{width:"100%"},children:l.map(e=>(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center"},children:[(0,a.jsx)(f.A,{sx:{width:20,display:"flex",alignItems:"center"},children:(0,a.jsx)(Y.W,{icon:e.icon,width:14,sx:{color:e.color}})}),(0,a.jsxs)(b.default,{variant:"caption",color:"text.secondary",sx:{width:80,lineHeight:1.2,whiteSpace:"nowrap"},children:[e.label,":"]}),(0,a.jsx)(b.default,{variant:"caption",fontWeight:"medium",sx:{lineHeight:1.2},children:(0,eu.ts)(e.date)})]},e.label))})})]}):null}var ex=l(31224);function em(e){let{amounts:t}=e;if(!t)return null;let l=[{label:"Requested Amount",value:t.requested||0,color:"info.main"},{label:"Quoted Amount",value:t.quoted||0,color:"warning.main"},{label:"Closed Amount",value:t.closed||0,color:"success.main"}];return(0,a.jsxs)(f.A,{children:[(0,a.jsx)(b.default,{variant:"subtitle2",sx:{mb:.5,fontWeight:600},children:"FINANCIAL SUMMARY"}),(0,a.jsx)(v.A,{sx:{p:1,minHeight:60,display:"flex",alignItems:"center"},children:(0,a.jsx)(f.A,{sx:{display:"flex",gap:2,justifyContent:"space-around",width:"100%",alignItems:"center"},children:l.map(e=>(0,a.jsxs)(f.A,{sx:{borderLeft:2,borderColor:e.color,pl:1},children:[(0,a.jsx)(b.default,{variant:"caption",color:"text.secondary",display:"block",sx:{lineHeight:1},children:e.label}),(0,a.jsx)(b.default,{variant:"body2",fontWeight:"600",sx:{lineHeight:1.2},children:(0,ex.KZ)(e.value)})]},e.label))})})]})}var ep=l(14208),ef=l(29453);function eg(e){let{notes:t,leadId:l,leadName:r,onUpdate:i}=e,[n,o]=(0,u.useState)(!1),[s,d]=(0,u.useState)(t||""),[c,h]=(0,u.useState)(!1);(0,u.useEffect)(()=>{n||d(t||"")},[t,n]);let x=()=>{o(!0),d(t||"")},m=async()=>{h(!0);try{await (0,Q.cF)(l,{LeadName:r,LeadNotes:s}),ef.oR.success("Lead notes updated successfully"),o(!1),i&&i({leadNotes:s})}catch(e){console.error("Failed to update lead notes:",e),ef.oR.error("Failed to update lead notes")}finally{h(!1)}};return n?(0,a.jsxs)(f.A,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,a.jsx)(b.default,{variant:"subtitle2",sx:{mb:.5,fontWeight:600},children:"LEAD NOTES"}),(0,a.jsxs)(v.A,{sx:{p:2,flex:1,display:"flex",flexDirection:"column"},children:[(0,a.jsx)(ep.K,{simple:!0,id:"lead-notes-dialog-editor",value:s,onChange:d,sx:{minHeight:200,flex:1}}),(0,a.jsxs)(f.A,{sx:{display:"flex",gap:1,mt:2,justifyContent:"flex-end"},children:[(0,a.jsx)(g.default,{onClick:()=>{d(t||""),o(!1)},size:"small",disabled:c,children:(0,a.jsx)(j.default,{title:"Cancel",arrow:!0,children:(0,a.jsx)(Y.W,{icon:"solar:close-circle-bold"})})}),(0,a.jsx)(g.default,{onClick:m,size:"small",disabled:c,children:(0,a.jsx)(j.default,{title:c?"Saving...":"Save",arrow:!0,children:c?(0,a.jsx)(R.default,{size:20}):(0,a.jsx)(Y.W,{icon:"fa-solid:check"})})})]})]})]}):t&&""!==t.trim()?(0,a.jsxs)(f.A,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[(0,a.jsx)(b.default,{variant:"subtitle2",sx:{fontWeight:600},children:"LEAD NOTES"}),(0,a.jsx)(g.default,{onClick:x,size:"small",children:(0,a.jsx)(j.default,{title:"Edit",arrow:!0,children:(0,a.jsx)(Y.W,{icon:"solar:pen-bold",width:16})})})]}),(0,a.jsx)(v.A,{sx:{p:2,flex:1,display:"flex",flexDirection:"column"},children:(0,a.jsx)(f.A,{dangerouslySetInnerHTML:{__html:t},sx:{"& p":{margin:0,marginBottom:1},"& p:last-child":{marginBottom:0},"& ul, & ol":{marginTop:.5,marginBottom:.5,paddingLeft:2},"& h1, & h2, & h3, & h4, & h5, & h6":{marginTop:.5,marginBottom:.5},fontSize:"0.875rem",lineHeight:1.5}})})]}):(0,a.jsxs)(f.A,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[(0,a.jsx)(b.default,{variant:"subtitle2",sx:{fontWeight:600},children:"LEAD NOTES"}),(0,a.jsx)(g.default,{onClick:x,size:"small",children:(0,a.jsx)(j.default,{title:"Edit",arrow:!0,children:(0,a.jsx)(Y.W,{icon:"solar:pen-bold",width:16})})})]}),(0,a.jsx)(v.A,{sx:{p:2,flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(b.default,{variant:"body2",color:"text.secondary",children:"No notes available"})})]})}function eb(e){let{requirements:t}=e;if(!t)return null;let l=[{icon:"eva:layers-fill",label:"Floor",value:t.floor?"Floor ".concat(t.floor):"N/A"},{icon:"eva:eye-fill",label:"View",value:t.view||"N/A"},{icon:"eva:compass-fill",label:"Direction",value:t.direction||"N/A"},{icon:"eva:home-fill",label:"Bedrooms",value:t.bedrooms||"N/A"},{icon:"eva:expand-fill",label:"Size",value:t.size?"".concat(t.size," sq ft"):"N/A"}];return(0,a.jsxs)(f.A,{children:[(0,a.jsx)(b.default,{variant:"subtitle2",sx:{mb:.5,fontWeight:600},children:"REQUIREMENTS"}),(0,a.jsx)(v.A,{sx:{p:1,minHeight:85,display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,a.jsxs)(f.A,{children:[(0,a.jsx)(f.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(3, 1fr)"},gap:.5,mb:.5},children:l.map(e=>(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,a.jsx)(Y.W,{icon:e.icon,width:14,sx:{color:"text.secondary"}}),(0,a.jsxs)(f.A,{sx:{display:"flex",gap:.5,alignItems:"baseline"},children:[(0,a.jsxs)(b.default,{variant:"caption",color:"text.secondary",children:[e.label,":"]}),(0,a.jsx)(b.default,{variant:"caption",fontWeight:"medium",sx:{lineHeight:1.2},children:e.value})]})]},e.label))}),void 0!==t.buyingIntent&&null!==t.buyingIntent&&(0,a.jsx)(f.A,{children:(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(b.default,{variant:"caption",color:"text.secondary",children:"Intent:"}),(0,a.jsx)(f.A,{sx:{flex:1},children:(0,a.jsx)(M.A,{variant:"determinate",value:10*t.buyingIntent,sx:{height:3,borderRadius:.5}})}),(0,a.jsxs)(b.default,{variant:"caption",fontWeight:"medium",sx:{minWidth:30},children:[t.buyingIntent,"/10"]})]})})]})})]})}var ev=l(91580);let ey=e=>({Win:"success",Lost:"error",Qualify:"secondary"})[e]||"default";function ej(e){let{lead:t}=e;return t?(0,a.jsxs)(f.A,{children:[(0,a.jsx)(b.default,{variant:"subtitle2",sx:{mb:.5,fontWeight:600},children:"LEAD DETAILS"}),(0,a.jsx)(v.A,{sx:{p:1,minHeight:85,display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,a.jsxs)(f.A,{children:[(0,a.jsxs)(f.A,{sx:{display:"flex",gap:.5,mb:.5,flexWrap:"wrap"},children:[t.leadStatus&&(0,a.jsx)(ev.default,{label:t.leadStatus,size:"small",color:ey(t.leadStatus),sx:{height:22}}),t.leadSource&&(0,a.jsx)(ev.default,{label:t.leadSource,size:"small",variant:"outlined",sx:{height:22}}),t.leadPriority&&(0,a.jsx)(ev.default,{label:"P".concat(t.leadPriority),size:"small",variant:"outlined",sx:{height:22}})]}),(0,a.jsxs)(f.A,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:.5},children:[t.buyerType&&(0,a.jsxs)(f.A,{sx:{display:"flex",gap:.5,alignItems:"baseline"},children:[(0,a.jsx)(b.default,{variant:"caption",color:"text.secondary",sx:{minWidth:35},children:"Type:"}),(0,a.jsx)(b.default,{variant:"caption",fontWeight:"medium",children:t.buyerType})]}),t.siteName&&(0,a.jsxs)(f.A,{sx:{display:"flex",gap:.5,alignItems:"baseline"},children:[(0,a.jsx)(b.default,{variant:"caption",color:"text.secondary",sx:{minWidth:35},children:"Site:"}),(0,a.jsx)(b.default,{variant:"caption",fontWeight:"medium",children:t.siteName})]}),t.suggestedUnitNumber&&(0,a.jsxs)(f.A,{sx:{display:"flex",gap:.5,alignItems:"baseline"},children:[(0,a.jsx)(b.default,{variant:"caption",color:"text.secondary",sx:{minWidth:35},children:"Unit:"}),(0,a.jsxs)(b.default,{variant:"caption",fontWeight:"medium",children:[t.suggestedUnitNumber,t.floorPreference&&" (F".concat(t.floorPreference,")")]})]}),t.leadType&&(0,a.jsxs)(f.A,{sx:{display:"flex",gap:.5,alignItems:"baseline"},children:[(0,a.jsx)(b.default,{variant:"caption",color:"text.secondary",sx:{minWidth:35},children:"Lead:"}),(0,a.jsx)(b.default,{variant:"caption",fontWeight:"medium",children:t.leadType})]})]})]})})]}):null}var ew=l(85098);let eS=e=>{switch(null==e?void 0:e.toLowerCase()){case"done":case"completed":return{bgcolor:"success.lighter",color:"success.darker"};case"pending":return{bgcolor:"warning.lighter",color:"warning.darker"};case"scheduled":return{bgcolor:"info.lighter",color:"info.darker"};case"cancelled":return{bgcolor:"error.lighter",color:"error.darker"};case"in progress":case"inprogress":return{bgcolor:"secondary.lighter",color:"secondary.darker"};default:return{bgcolor:"grey.200",color:"grey.800"}}};function eC(e){let{leadId:t,leadName:l,label:r}=e,{visitByLeadData:n,visitByLeadLoading:o,visitByLeadError:s}=(0,ew.jE)(t),d=(0,u.useMemo)(()=>[{field:"actions",headerName:"Actions",width:130,sortable:!1,disableColumnMenu:!0,renderCell:e=>(0,a.jsx)(y.default,{component:F.W,href:i.f.dashboard.visit.profile(e.row.id),size:"small",variant:"text",startIcon:(0,a.jsx)(Y.W,{icon:"eva:eye-fill",width:16}),sx:{whiteSpace:"nowrap"},children:"View More"})},{field:"visitDate",headerName:"Visit Date",minWidth:120,flex:1,renderCell:e=>(0,eu.ts)(e.value)},{field:"siteName",headerName:"Site",minWidth:150,flex:1},{field:"visitStatus",headerName:"Status",minWidth:110,renderCell:e=>{let t=eS(e.value);return(0,a.jsx)(ev.default,{label:e.value,size:"small",sx:{...t,fontWeight:"medium",borderRadius:1,"&:hover":{...t,filter:"brightness(1.2)"}}})}},{field:"purpose",headerName:"Purpose",minWidth:130,flex:1},{field:"visitOutlook",headerName:"Outlook",minWidth:130,flex:1}],[]),c=(0,u.useMemo)(()=>n?n.map((e,t)=>{var l;return{id:e.VisitId||t,visitDate:e.VisitDate,siteName:(null==(l=e.site)?void 0:l.SiteName)||"N/A",visitStatus:e.VisitStatus,purpose:e.Purpose||"N/A",visitOutlook:e.VisitOutlook||"N/A"}}):[],[n]);return t?s?(0,a.jsx)(f.A,{sx:{p:3,textAlign:"center",bgcolor:"error.lighter",borderRadius:1,border:1,borderColor:"error.light"},children:(0,a.jsxs)(b.default,{variant:"body2",color:"error.darker",children:["Failed to load visit history: ",s]})}):(0,a.jsx)(f.A,{children:(0,a.jsx)(f.A,{sx:{height:400,width:"100%"},children:(0,a.jsx)(h._,{rows:c,columns:d,loading:o,density:"standard",disableRowSelectionOnClick:!0,disableAggregation:!0,disablePivoting:!0,showToolbar:!0,pageSizeOptions:[10,20,50],label:"Visit History for ".concat(l||"Current Lead"),initialState:{pagination:{paginationModel:{pageSize:10}}},sx:{border:1,borderColor:"divider","& .MuiDataGrid-cell":{borderColor:"divider",py:.5},"& .MuiDataGrid-row":{minHeight:"48px !important"},"& .MuiDataGrid-columnHeader":{bgcolor:"background.neutral",borderColor:"divider"}}})})}):null}var eI=l(30832),eA=l.n(eI),eN=l(38637),ek=l.n(eN),eD=l(62177),eM=l(90221),eL=l(68074),eW=l(84762),ez=l(95946),eR=l(80158),eF=l(42921);let eU=e=>e?e.replace(/<[^>]*>?/gm,"").trim():"";var eP=l(7841),eT=l(77308),eE=l(55594);let eB=eE.z.object({leadId:eE.z.string().optional(),type:eE.z.string().min(1,"Follow-up type is required"),followUpDate:eE.z.any().refine(e=>e&&eA()(e).isValid(),{message:"Follow-up date & time is required and must be valid"}).refine(e=>!e||eA()(e).isAfter(eA()().subtract(1,"day")),{message:"Follow-up date cannot be too far in the past"}),nextFollowUpDate:eE.z.any().nullable().optional().refine(e=>!e||eA()(e).isValid(),{message:"Next follow-up date must be valid if provided"}),status:eE.z.string().min(1,"Status is required"),userId:eE.z.union([eE.z.string().min(1,"Assigned user is required"),eE.z.number().min(1,"Assigned user is required")]),notes:eE.z.string().max(1e3,"Notes cannot exceed 1000 characters").optional()}).refine(e=>!e.nextFollowUpDate||!e.followUpDate||eA()(e.nextFollowUpDate).isAfter(eA()(e.followUpDate)),{message:"Next follow-up date must be after the follow-up date",path:["nextFollowUpDate"]});var eO=l(54961);let eH=e=>{switch(e){case"Completed":return"success";case"Cancelled":return"error";case"Pending":return"warning";case"Rescheduled":return"info";default:return"default"}};function eq(e){var t;let{open:l,onClose:i,followUp:n,onSave:o,leadId:s,currentLead:d,context:c="lead",visitId:h=null,currentVisit:x=null}=e,[m,p]=(0,u.useState)(!1),{usersData:v,usersLoading:w,usersError:S}=(0,eP.jR)(),{userData:C}=(0,eT._)(),I=(0,u.useMemo)(()=>({leadId:(null==d?void 0:d.leadName)||(null==d?void 0:d.LeadName)||"",type:(null==n?void 0:n.type)||"Call",followUpDate:(null==n?void 0:n.followUpDate)?eA()(n.followUpDate):eA()(),nextFollowUpDate:(null==n?void 0:n.nextFollowUpDate)?eA()(n.nextFollowUpDate):(null==n?void 0:n.followUpDate)?eA()(n.followUpDate).add(7,"day"):eA()().add(7,"day"),status:(null==n?void 0:n.status)||"Pending",userId:(null==n?void 0:n.userId)||(null==C?void 0:C.id)||"",notes:(null==n?void 0:n.notes)||""}),[n,d,C]),A=(0,eD.mN)({mode:"all",resolver:(0,eM.u)(eB),defaultValues:I}),{reset:D,watch:M,handleSubmit:L,formState:{isSubmitting:W,isDirty:z}}=A,F=M("status"),P=(0,u.useCallback)(()=>{D(I)},[D,I]),T=(0,u.useCallback)(()=>{z&&!W?p(!0):i()},[z,W,i]),E=(0,u.useCallback)(()=>{p(!1),i()},[i]),B=(0,u.useCallback)(()=>{p(!1)},[]);(0,u.useEffect)(()=>{l&&(n?D(I):D({leadId:(null==d?void 0:d.leadName)||(null==d?void 0:d.LeadName)||"",type:"Call",followUpDate:eA()(),nextFollowUpDate:eA()().add(7,"day"),status:"Pending",userId:(null==C?void 0:C.id)||"",notes:""}))},[l,n,D,I,d,C]),(0,u.useEffect)(()=>{let e=e=>{"Escape"===e.key&&l&&!W&&i()};if(l)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[l,i,W]);let O=L(async e=>{try{let t={LeadId:"lead"===c?"string"==typeof s?parseInt(s,10):s:null,VisitId:"visit"===c?"string"==typeof h?parseInt(h,10):h:null,UserId:"string"==typeof e.userId?parseInt(e.userId,10):e.userId,FollowUpType:e.type,Status:e.status,FollowUpDate:eA()(e.followUpDate).format("YYYY-MM-DDTHH:mm:ss.SSSSSS"),NextFollowUpDate:e.nextFollowUpDate?eA()(e.nextFollowUpDate).format("YYYY-MM-DDTHH:mm:ss.SSSSSS"):null};((null==n?void 0:n.id)||(null==n?void 0:n.FollowUpId))&&(t.FollowUpId=n.id||n.FollowUpId),e.notes&&""!==e.notes.trim()&&(t.Notes=eU(e.notes)),await (null==o?void 0:o(t)),r.oR.success("Follow-up ".concat(n?"updated":"created"," successfully"),{containerId:"success",autoClose:2e3}),i()}catch(t){console.error("Error saving follow-up:",t);let e=(null==t?void 0:t.message)||t||"Failed to save follow-up";r.oR.error(e,{containerId:"error"})}});return l?(0,a.jsxs)(f.A,{sx:{position:"absolute",right:0,top:0,height:"100%",width:{xs:"100%",sm:"".concat(500,"px")},zIndex:1400,transform:l?"translateX(0)":"translateX(100%)",transition:"transform 300ms cubic-bezier(0.4, 0, 0.2, 1)",pointerEvents:l?"auto":"none"},children:[(0,a.jsxs)(eW.default,{elevation:8,sx:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:0,borderLeft:1,borderColor:"divider"},children:[(0,a.jsxs)(f.A,{sx:{py:2,px:2.5,display:"flex",alignItems:"center",borderBottom:1,borderColor:"divider",bgcolor:"background.neutral"},children:[(0,a.jsxs)(b.default,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:[n?"Edit":"Quick"," Follow-up"]}),n&&(0,a.jsx)(ev.default,{label:F,size:"small",color:eH(F),sx:{mr:1,textTransform:"capitalize"}}),(0,a.jsx)(j.default,{title:"Reset Form",arrow:!0,children:(0,a.jsx)(g.default,{onClick:P,size:"small","aria-label":"Reset form",children:(0,a.jsx)(k.default,{color:"error",variant:"dot",invisible:!z,children:(0,a.jsx)(Y.W,{icon:"solar:restart-bold",width:20})})})}),(0,a.jsx)(g.default,{onClick:T,size:"small","aria-label":"Close panel",children:(0,a.jsx)(Y.W,{icon:"mingcute:close-line",width:22})})]}),(0,a.jsx)(f.A,{sx:{flexGrow:1,overflowY:"auto"},children:(0,a.jsxs)(eO.lV,{methods:A,onSubmit:O,children:[(0,a.jsxs)(f.A,{sx:{p:2.5,display:"flex",flexDirection:"column",gap:2.5},children:["lead"===c&&(0,a.jsx)(ez.default,{label:"Lead",value:(null==d?void 0:d.leadName)||(null==d?void 0:d.LeadName)||"",disabled:!0,fullWidth:!0,InputProps:{readOnly:!0}}),"visit"===c&&(0,a.jsx)(ez.default,{label:"Visit",value:x?"".concat(x.siteName||"Visit"," - ").concat(x.visitDate?(0,eu.ts)(x.visitDate):"N/A"):"",disabled:!0,fullWidth:!0,InputProps:{readOnly:!0}}),(0,a.jsx)(eO.D0.Select,{name:"type",label:"Follow-up Type",required:!0,children:U.Nz.map(e=>(0,a.jsx)(N.default,{value:e.value,children:e.label},e.value))}),(0,a.jsxs)(f.A,{sx:{display:"flex",gap:1.5,flexDirection:{xs:"column",sm:"row"}},children:[(0,a.jsx)(eO.D0.DatePicker2,{name:"followUpDate",label:"Follow-up Date"}),(0,a.jsx)(eO.D0.DatePicker2,{name:"nextFollowUpDate",label:"Next Follow-up Date"})]}),(0,a.jsx)(eO.D0.Select,{name:"status",label:"Status",required:!0,children:U.dk.map(e=>(0,a.jsx)(N.default,{value:e.value,children:e.label},e.value))}),(0,a.jsx)(eO.D0.Select,{name:"userId",label:"Assigned To",required:!0,disabled:w,error:!!S,children:w?(0,a.jsx)(N.default,{disabled:!0,children:(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(R.default,{size:16}),(0,a.jsx)(b.default,{variant:"body2",children:"Loading users..."})]})}):S?(0,a.jsx)(N.default,{disabled:!0,children:(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:1,color:"error.main"},children:[(0,a.jsx)(Y.W,{icon:"solar:danger-bold",width:16}),(0,a.jsx)(b.default,{variant:"body2",children:"Error loading users. Please refresh."})]})}):(null==v?void 0:v.length)===0?(0,a.jsx)(N.default,{disabled:!0,children:(0,a.jsx)(b.default,{variant:"body2",color:"text.secondary",children:"No users available"})}):null==v?void 0:v.map(e=>(0,a.jsxs)(N.default,{value:e.id,children:[e.FirstName," ",e.LastName]},e.id))}),(0,a.jsx)(eO.D0.Text,{name:"notes",label:"Additional Notes",placeholder:"Enter notes (max 1000 characters)...",multiline:!0,rows:4,helperText:"".concat((null==(t=M("notes"))?void 0:t.length)||0,"/1000 characters"),inputProps:{maxLength:1e3}})]}),(0,a.jsx)(eR.default,{}),(0,a.jsxs)(f.A,{sx:{p:2.5,display:"flex",justifyContent:"flex-end",gap:1.5},children:[(0,a.jsx)(y.default,{onClick:T,color:"inherit",variant:"outlined",children:"Cancel"}),(0,a.jsx)(eL.default,{type:"submit",variant:"contained",loading:W,children:n?"Update":"Create"})]})]})})]}),(0,a.jsxs)(ee.A,{open:m,onClose:B,"aria-labelledby":"unsaved-changes-dialog",children:[(0,a.jsx)(et.A,{id:"unsaved-changes-dialog",children:"Unsaved Changes"}),(0,a.jsx)(el.A,{children:(0,a.jsx)(eF.A,{children:"You have unsaved changes. Are you sure you want to close without saving?"})}),(0,a.jsxs)(ea.default,{children:[(0,a.jsx)(y.default,{onClick:B,color:"inherit",children:"Continue Editing"}),(0,a.jsx)(y.default,{onClick:E,color:"error",variant:"contained",autoFocus:!0,children:"Discard Changes"})]})]})]}):null}eq.propTypes={open:ek().bool.isRequired,onClose:ek().func.isRequired,followUp:ek().object,onSave:ek().func.isRequired,leadId:ek().oneOfType([ek().string,ek().number]),currentLead:ek().object,context:ek().oneOf(["lead","visit"]),visitId:ek().oneOfType([ek().string,ek().number]),currentVisit:ek().object};var eV=l(25949),e_=l(72137),eG=l(60032),eJ=l(72330),eQ=l(57236),eY=l(20837),eX=l(7497);let eK=e=>({Win:"success",Lost:"error",Qualify:"secondary"})[e]||"default",eZ=e=>{var t;return{leadId:e.data.LeadId,leadName:e.data.LeadName,leadStatus:e.data.LeadStatus,leadSource:e.data.LeadSource,siteName:null==(t=e.data.site)?void 0:t.SiteName,createdDate:e.data.CreatedDate}};function e$(e){let{customerId:t,currentLeadId:l,onLeadClick:r,customerName:i}=e,[n,o]=(0,u.useState)({}),{searchedLeadsData:s,searchedLeadsLoading:d,searchedLeadsError:c}=(0,Q.Me)(null,t,null),h=(0,u.useMemo)(()=>s?s.map(e=>eZ(e)).filter(e=>e.leadId!==l):[],[s,l]),x=e=>{o(t=>({...t,[e]:!t[e]}))};return d?(0,a.jsx)(f.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:10},children:(0,a.jsx)(R.default,{})}):c?(0,a.jsx)(f.A,{sx:{p:3,textAlign:"center",bgcolor:"error.lighter",borderRadius:1,border:1,borderColor:"error.light"},children:(0,a.jsxs)(b.default,{variant:"body2",color:"error.darker",children:["Failed to load other leads: ",c]})}):h.length?(0,a.jsxs)(f.A,{children:[(0,a.jsxs)(b.default,{variant:"h6",sx:{mb:2},children:["Other Leads of ",i||"Customer"," (",h.length,")"]}),(0,a.jsx)(f.A,{sx:{maxHeight:400,overflow:"auto",border:1,borderColor:"divider",borderRadius:1},children:(0,a.jsxs)(eV.A,{stickyHeader:!0,children:[(0,a.jsx)(e_.A,{children:(0,a.jsxs)(eG.default,{children:[(0,a.jsx)(eJ.default,{width:40}),(0,a.jsx)(eJ.default,{children:"Lead Name"}),(0,a.jsx)(eJ.default,{children:"Site"}),(0,a.jsx)(eJ.default,{children:"Status"}),(0,a.jsx)(eJ.default,{children:"Source"}),(0,a.jsx)(eJ.default,{children:"Created"}),(0,a.jsx)(eJ.default,{children:"Actions"})]})}),(0,a.jsx)(eQ.A,{children:h.map(e=>(0,a.jsxs)(u.Fragment,{children:[(0,a.jsxs)(eG.default,{hover:!0,children:[(0,a.jsx)(eJ.default,{children:(0,a.jsx)(g.default,{size:"small",onClick:()=>x(e.leadId),children:(0,a.jsx)(Y.W,{icon:n[e.leadId]?"eva:arrow-down-fill":"eva:arrow-right-fill"})})}),(0,a.jsx)(eJ.default,{children:e.leadName}),(0,a.jsx)(eJ.default,{children:e.siteName}),(0,a.jsx)(eJ.default,{children:(0,a.jsx)(ev.default,{label:e.leadStatus,size:"small",color:eK(e.leadStatus)})}),(0,a.jsx)(eJ.default,{children:e.leadSource}),(0,a.jsx)(eJ.default,{children:(0,eu.ts)(e.createdDate)}),(0,a.jsx)(eJ.default,{children:(0,a.jsx)(y.default,{size:"small",variant:"outlined",onClick:()=>{let t=s.find(t=>t.data.LeadId===e.leadId);if(t){var l,a,i,n,o,d,c,u,h,x;r({id:t.data.LeadId,leadName:t.data.LeadName,contactId:t.data.ContactId,customerName:t.data.ContactId&&"".concat(null==(l=t.data.contacts)?void 0:l.ContactFName," ").concat(null==(a=t.data.contacts)?void 0:a.ContactLName),customerContact:null==(i=t.data.contacts)?void 0:i.ContactNo,customerEmail:null==(n=t.data.contacts)?void 0:n.ContactEmail,brokerId:t.data.BrokerId,brokerName:t.data.BrokerId&&"".concat(null==(o=t.data.broker)?void 0:o.ContactFName," ").concat(null==(d=t.data.broker)?void 0:d.ContactLName),brokerContact:null==(c=t.data.broker)?void 0:c.ContactNo,leadStatus:t.data.LeadStatus,leadSource:t.data.LeadSource,siteName:null==(u=t.data.site)?void 0:u.SiteName,buyerType:null==(h=t.data.prospecttypes)?void 0:h.ProspectTypeName,floorPreference:t.data.FloorPreference,viewType:t.data.ViewType,direction:t.data.Direction,bedrooms:t.data.Bedrooms,sizeSqFt:t.data.SizeSqFt,buyingIntent:t.data.BuyingIntent,requestedAmount:t.data.RequestedAmount,quotedAmount:t.data.QuotedAmount,closedAmount:t.data.ClosedAmount,leadCreatedDate:t.data.CreatedDate,leadUpdatedDate:t.data.UpdatedDate,leadClosedDate:t.data.LeadClosedDate,suggestedUnitNumber:t.data.SuggestedUnitId&&(null==(x=t.data.suggestedunit)?void 0:x.UnitNumber),leadPriority:t.data.LeadPriority,leadType:t.data.LeadType,contacts:t.data.contacts,broker:t.data.broker})}},startIcon:(0,a.jsx)(Y.W,{icon:"eva:eye-fill"}),children:"View"})})]}),n[e.leadId]&&(0,a.jsx)(eG.default,{children:(0,a.jsx)(eJ.default,{colSpan:7,sx:{py:0,bgcolor:"background.neutral"},children:(0,a.jsx)(eY.A,{in:n[e.leadId],timeout:"auto",unmountOnExit:!0,children:(0,a.jsxs)(f.A,{sx:{m:2},children:[(0,a.jsx)(b.default,{variant:"subtitle2",sx:{mb:1},children:"Visit History"}),(0,a.jsx)(eX.M,{id:e.leadId,type:"lead"})]})})})})]},e.leadId))})]})})]}):(0,a.jsx)(X.H,{title:"No Other Leads",description:"This customer has no other leads",sx:{py:10}})}let e0=(0,u.forwardRef)(function(e,t){return(0,a.jsx)($.A,{direction:"up",ref:t,...e})});function e1(e){let{children:t,value:l,index:r,...i}=e;return(0,a.jsx)("div",{role:"tabpanel",hidden:l!==r,id:"lead-detail-tabpanel-".concat(r),"aria-labelledby":"lead-detail-tab-".concat(r),...i,children:l===r&&t})}function e2(e){let{open:t,onClose:l,lead:r,leadId:n,onDataChange:o}=e,s=(0,m.default)(),d=(0,p.A)(s.breakpoints.down("md"));(0,p.A)(s.breakpoints.between("sm","md"));let{mutate:c}=(0,Z.iX)(),[h,x]=(0,u.useState)(null),[v,j]=(0,u.useState)(0),[w,S]=(0,u.useState)(0),[C,I]=(0,u.useState)(r),[A,N]=(0,u.useState)(!1),[k,D]=(0,u.useState)(null),M=(0,u.useCallback)(e=>{x(e)},[]),L=(0,u.useCallback)(()=>{x(null)},[]),W=(0,u.useCallback)(e=>{I(t=>({...t,...e})),o&&o()},[o]),z=(0,u.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;D(e),N(!0)},[]),R=(0,u.useCallback)(()=>{N(!1),D(null)},[]),U=(0,u.useCallback)(async e=>{try{console.log("=== SAVE FOLLOW-UP ==="),console.log("Mode:",(null==e?void 0:e.FollowUpId)?"EDIT":"CREATE"),console.log("FollowUpId:",null==e?void 0:e.FollowUpId),console.log("Payload:",e),(null==e?void 0:e.FollowUpId)?await (0,G.Y3)(e,e.FollowUpId):await (0,G.XL)(e),(null==C?void 0:C.id)&&await c(V.vZ.followups.readByLead(C.id)),R(),o&&o()}catch(e){throw console.error("Error saving quick follow-up:",e),e}},[null==C?void 0:C.id,c,o,R]);return((0,u.useEffect)(()=>{I(r)},[r]),(0,u.useEffect)(()=>{if(t){let e=e=>{document.querySelectorAll(e).forEach(e=>{e&&(e.style.pointerEvents="",e.style.visibility="")})};e(".MuiModal-root, .MuiDialog-root"),e(".MuiDialog-container"),e(".MuiBackdrop-root")}else{let e=setTimeout(()=>{document.body.style.overflow="",document.body.style.paddingRight="";let e=e=>!!e&&null!==e.querySelector('.MuiIconButton-root, [aria-label*="close"]');document.querySelectorAll('.MuiDialog-container, [class*="MuiDialog-container"]').forEach(t=>{t&&!e(t)&&(t.style.pointerEvents="none",t.style.visibility="hidden")}),document.querySelectorAll(".MuiBackdrop-root, .MuiModal-backdrop").forEach(e=>{e&&(e.style.pointerEvents="none",e.style.visibility="hidden")}),document.querySelectorAll(".MuiModal-root, .MuiDialog-root").forEach(t=>{t&&"true"===t.getAttribute("aria-hidden")&&!e(t)&&(t.style.pointerEvents="none",t.style.visibility="hidden")})},100);return()=>clearTimeout(e)}},[t]),C||n)?h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e2,{open:t,onClose:l,lead:r,leadId:n}),(0,a.jsx)(e2,{open:!!h,onClose:L,lead:h})]}):(0,a.jsxs)(ee.A,{open:t,onClose:l,maxWidth:!d&&"lg",fullWidth:!0,fullScreen:d,TransitionComponent:d?e0:void 0,keepMounted:!1,disableScrollLock:!0,slotProps:{backdrop:{timeout:500,unmountOnExit:!0}},PaperProps:{sx:{height:d?"100vh":"90vh",display:"flex",flexDirection:"column",m:2*!d,position:"relative",overflow:"hidden"}},sx:{"&.MuiModal-root":{'&:has(> div[style*="opacity: 0"])':{pointerEvents:"none"}}},children:[(0,a.jsxs)(et.A,{sx:{pb:0,px:d?2:3},children:[(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:d?1:2},children:[(0,a.jsx)(b.default,{variant:d?"subtitle1":"h6",sx:{fontWeight:600,fontSize:d?"1rem":"1.25rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:{xs:"calc(100% - 64px)",sm:"calc(100% - 56px)",md:"calc(100% - 48px)"}},children:d?(null==C?void 0:C.leadName)||"Lead Details":"Lead Details - ".concat((null==C?void 0:C.leadName)||"Unknown")}),(0,a.jsx)(g.default,{onClick:l,size:d?"medium":"small",sx:{position:"relative",zIndex:10,flexShrink:0,ml:1},children:(0,a.jsx)(Y.W,{icon:"eva:close-fill"})})]}),(0,a.jsxs)(er.A,{value:v,onChange:(e,t)=>{j(t)},"aria-label":"lead detail tabs",variant:d?"fullWidth":"standard",sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{minHeight:d?40:48,textTransform:"none",fontSize:d?"0.75rem":"0.875rem",fontWeight:500,px:d?1:2}},children:[(0,a.jsx)(ei.default,{label:d?"Details":"Current Lead Details",id:"lead-detail-tab-0","aria-controls":"lead-detail-tabpanel-0"}),(0,a.jsx)(ei.default,{label:d?"History":"Other Leads & History",id:"lead-detail-tab-1","aria-controls":"lead-detail-tabpanel-1"})]})]}),(0,a.jsxs)(el.A,{sx:{flex:1,overflowY:"auto",px:d?1:2},children:[(0,a.jsx)(e1,{value:v,index:0,children:(0,a.jsxs)(en.A,{spacing:d?1.5:2,sx:{p:d?1:3},children:[(0,a.jsxs)(f.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr",md:"1fr 1fr"},gap:d?1:2},children:[(0,a.jsx)(ec,{customer:{id:null==C?void 0:C.contactId,name:null==C?void 0:C.customerName,phone:null==C?void 0:C.customerContact,email:null==C?void 0:C.customerEmail,details:null==C?void 0:C.contacts}}),(0,a.jsx)(ed,{broker:{id:null==C?void 0:C.brokerId,name:null==C?void 0:C.brokerName,phone:null==C?void 0:C.brokerContact,details:null==C?void 0:C.broker}})]}),(0,a.jsxs)(f.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr",md:"1fr 1fr"},gap:d?1:2},children:[(0,a.jsx)(ej,{lead:C}),(0,a.jsx)(eb,{requirements:{floor:null==C?void 0:C.floorPreference,view:null==C?void 0:C.viewType,direction:null==C?void 0:C.direction,bedrooms:null==C?void 0:C.bedrooms,size:null==C?void 0:C.sizeSqFt,buyingIntent:null==C?void 0:C.buyingIntent}})]}),(0,a.jsxs)(f.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr",md:"1fr 1fr"},gap:d?1:2},children:[(0,a.jsx)(eg,{notes:null==C?void 0:C.leadNotes,leadId:null==C?void 0:C.id,leadName:null==C?void 0:C.leadName,onUpdate:W}),(0,a.jsxs)(en.A,{spacing:2,children:[(0,a.jsx)(eh,{dates:{created:null==C?void 0:C.leadCreatedDate,updated:null==C?void 0:C.leadUpdatedDate,closed:null==C?void 0:C.leadClosedDate}}),(0,a.jsx)(em,{amounts:{requested:null==C?void 0:C.requestedAmount,quoted:null==C?void 0:C.quotedAmount,closed:null==C?void 0:C.closedAmount}})]})]}),(0,a.jsxs)(f.A,{sx:{mt:2},children:[(0,a.jsxs)(er.A,{value:w,onChange:(e,t)=>{S(t)},variant:d?"fullWidth":"standard",sx:{borderBottom:1,borderColor:"divider",backgroundColor:"background.neutral",borderRadius:"4px 4px 0 0","& .MuiTab-root":{fontSize:d?"0.7rem":"0.8rem",minHeight:d?36:40,textTransform:"none",fontWeight:500,px:d?1:2},"& .Mui-selected":{fontWeight:600}},children:[(0,a.jsx)(ei.default,{label:"Follow-Ups",id:"visit-tab-0","aria-controls":"visit-tabpanel-0"}),(0,a.jsx)(ei.default,{label:"Visits",id:"visit-tab-1","aria-controls":"visit-tabpanel-1"})]}),(0,a.jsx)(e1,{value:w,index:0,children:(0,a.jsx)(f.A,{sx:{mt:1},children:(0,a.jsx)(eo.FollowUps,{leadId:null==C?void 0:C.id,currentLead:C,onOpenSlidePanel:z})})}),(0,a.jsx)(e1,{value:w,index:1,children:(0,a.jsx)(f.A,{sx:{mt:1},children:(0,a.jsx)(eC,{leadId:null==C?void 0:C.id,leadName:null==C?void 0:C.leadName})})})]})]})}),(0,a.jsx)(e1,{value:v,index:1,children:(0,a.jsx)(en.A,{spacing:d?1.5:2,sx:{p:d?1:3},children:(0,a.jsx)(e$,{customerId:null==C?void 0:C.contactId,currentLeadId:null==C?void 0:C.id,customerName:null==C?void 0:C.customerName,onLeadClick:M})})})]}),(0,a.jsx)(ea.default,{sx:{px:d?2:3,py:d?1.5:2,flexDirection:d?"column":"row",gap:+!!d,"& > :not(:first-of-type)":{ml:+!d}},children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.default,{fullWidth:!0,component:F.W,href:i.f.dashboard.lead.profile(null==C?void 0:C.id),target:"_blank",rel:"noopener noreferrer",variant:"contained",color:"primary",startIcon:(0,a.jsx)(Y.W,{icon:"eva:external-link-fill"}),children:"View Full Profile"}),(0,a.jsx)(y.default,{fullWidth:!0,onClick:l,variant:"outlined",color:"inherit",children:"Close"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.default,{onClick:l,color:"inherit",children:"Close"}),(0,a.jsx)(y.default,{component:F.W,href:i.f.dashboard.lead.profile(null==C?void 0:C.id),target:"_blank",rel:"noopener noreferrer",variant:"outlined",startIcon:(0,a.jsx)(Y.W,{icon:"eva:external-link-fill"}),children:"View Full Profile"})]})}),(0,a.jsx)(eq,{open:A,onClose:R,onSave:U,followUp:k,leadId:null==C?void 0:C.id,currentLead:C})]}):(0,a.jsxs)(ee.A,{open:t,onClose:l,maxWidth:"sm",children:[(0,a.jsx)(et.A,{children:"Error"}),(0,a.jsx)(el.A,{children:(0,a.jsx)(b.default,{children:"No lead data available to display."})}),(0,a.jsx)(ea.default,{children:(0,a.jsx)(y.default,{onClick:l,color:"primary",children:"Close"})})]})}var e5=l(17764);let e3=(0,u.memo)(function(e){var t,l;let{params:r,href:i,emptyValue:n="—"}=e;if((null==r||null==(t=r.rowNode)?void 0:t.type)==="group")return(0,a.jsx)(b.default,{variant:"subtitle2",sx:{fontWeight:600},children:r.value||n});let o=null==r||null==(l=r.row)?void 0:l.customerName;if(!o)return(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",minWidth:1,py:1},children:[(0,a.jsx)(es.A,{sx:{width:30,height:30,mr:2,fontSize:"0.875rem"}}),(0,a.jsx)("span",{children:n})]});let s=o.charAt(0).toUpperCase();return(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",minWidth:1,py:1},children:[(0,a.jsx)(es.A,{alt:o,sx:{width:30,height:30,mr:2,fontSize:"0.875rem"},children:s}),(0,a.jsx)(e5.A,{component:F.W,href:i,variant:"body2",color:"inherit",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical","&:hover":{color:"primary.main"}},children:o})]})}),e6=(0,u.memo)(function(e){var t,l;let{params:r,emptyValue:i="—"}=e;if((null==r||null==(t=r.rowNode)?void 0:t.type)==="group")return(0,a.jsx)(b.default,{variant:"subtitle2",sx:{fontWeight:600},children:r.value||i});let n=null==r||null==(l=r.row)?void 0:l[r.field];if(null==n||""===n)return(0,a.jsx)("span",{children:i});let o="string"==typeof n?n:String(n);return(0,a.jsx)(b.default,{variant:"body2",color:"inherit",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",wordBreak:"break-word"},children:o})}),e4=(0,u.memo)(function(e){var t,l;let{params:r,emptyValue:i="—"}=e;if((null==r||null==(t=r.rowNode)?void 0:t.type)==="group")return(0,a.jsx)(b.default,{variant:"subtitle2",sx:{fontWeight:600},children:r.value||i});let n=null==r||null==(l=r.row)?void 0:l[r.field];return null==n||""===n?(0,a.jsx)("span",{children:i}):(0,a.jsx)(b.default,{variant:"body2",color:"inherit",sx:{fontVariantNumeric:"tabular-nums",textAlign:"right",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),e8=(0,u.memo)(function(e){var t;let{params:l,emptyValue:r="—"}=e,i=null==l||null==(t=l.row)?void 0:t[l.field];return null==i||""===i?(0,a.jsx)("span",{children:r}):(0,a.jsx)(b.default,{variant:"body2",color:"inherit",sx:{fontVariantNumeric:"tabular-nums",textAlign:"right",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(0,ex.KZ)(i)})}),e7=(0,u.memo)(function(e){var t;let{params:l,emptyValue:r="—",showTime:i=!0}=e,n=null==l||null==(t=l.row)?void 0:t[l.field];return!n||isNaN(new Date(n).getTime())?(0,a.jsx)("span",{children:r}):(0,a.jsxs)(en.A,{spacing:.5,alignItems:"flex-start",children:[(0,a.jsx)(b.default,{variant:"body2",children:(0,eu.ts)(n)}),i&&(0,a.jsx)(b.default,{variant:"caption",color:"text.secondary",children:(0,eu.qi)(n)})]})});var e9=l(32591);let te=[20,40,60,80,100],tt="leadListColumnVisibility",tl="leadListSortPreference",ta="created_date_desc",tr=[{value:"ai_priority",label:"AI Priority (Recommended)",icon:"solar:sort-by-time-bold"},{value:"health_score_desc",label:"Health Score (High to Low)",icon:"solar:heart-bold"},{value:"health_score_asc",label:"Health Score (Low to High)",icon:"solar:heart-broken-bold"},{value:"buying_intent_desc",label:"Buying Intent (Highest)",icon:"solar:fire-bold"},{value:"created_date_desc",label:"Created Date (Newest)",icon:"solar:calendar-add-bold"},{value:"created_date_asc",label:"Created Date (Oldest)",icon:"solar:calendar-minimalistic-bold"},{value:"lead_name_asc",label:"Lead Name (A-Z)",icon:"solar:sort-by-alphabet-bold"},{value:"budget_desc",label:"Budget (Highest)",icon:"solar:dollar-bold"},{value:"follow_up_date",label:"Follow-up Date",icon:"solar:clock-circle-bold"},{value:"last_contact_date",label:"Last Contact Date",icon:"solar:phone-calling-bold"}],ti=(e,t)=>e.label.localeCompare(t.label),tn=(e,t,l)=>{var a;return(null==e||null==(a=e.map(e=>({label:e[t],value:e[l]})).filter(e=>e.label&&""!==e.label.trim()))?void 0:a.sort(ti))||[]},to=U.z4.flatMap(e=>e.classify.map(e=>({label:e,value:e}))).sort(ti)||[],ts=U.Oe.flatMap(e=>e.classify.map(e=>({label:e,value:e}))).sort(ti)||[],td=[{label:"Lost",color:"#FF5630"},{label:"Win",color:"#22C55E"},{label:"Qualify",color:"#8E33FF"}],tc=e=>e||0===e?e<40?"Critical":e<70?"Attention":"Healthy":null;function tu(){var e,t;let l=(0,m.default)(),n=(0,p.A)(l.breakpoints.down("md")),[o,R]=(0,u.useState)(()=>{try{let e=localStorage.getItem("leadListViewPreferences");if(e){let t=JSON.parse(e);return n?t.mobile||"card":t.desktop||"table"}}catch(e){console.error("Failed to parse view preferences:",e)}return n?"card":"table"}),[P,T]=(0,u.useState)(()=>{try{let e=localStorage.getItem(tt);return e?JSON.parse(e):{}}catch(e){return console.error("Failed to load column visibility preferences:",e),{}}}),[E,B]=(0,u.useState)(null),[O,H]=(0,u.useState)(!1),[Z,$]=(0,u.useState)(!1),[ee,et]=(0,u.useState)(null),[el,ea]=(0,u.useState)(!1),[er,ei]=(0,u.useState)(null),[en,eo]=(0,u.useState)(null),es=(0,u.useCallback)(e=>{if(null!==e){R(e);try{let t=localStorage.getItem("leadListViewPreferences"),l=t?JSON.parse(t):{};n?l.mobile=e:l.desktop=e,localStorage.setItem("leadListViewPreferences",JSON.stringify(l))}catch(e){console.error("Failed to save view preference:",e)}}},[n]),ed=(0,u.useCallback)(e=>{T(e);try{localStorage.setItem(tt,JSON.stringify(e))}catch(e){console.error("Failed to save column visibility preferences:",e)}},[]);(0,u.useEffect)(()=>{try{let e=localStorage.getItem("leadListViewPreferences");if(e){let t=JSON.parse(e),l=n?t.mobile||"card":t.desktop||"table";l!==o&&R(l)}else{let e=n?"card":"table";e!==o&&R(e)}}catch(e){console.error("Failed to sync view mode:",e)}},[n]);let[ec,eu]=(0,d.ab)(q,{shallow:!0,history:"push"}),[eh,ex]=(0,u.useState)({page:ec.page||0,pageSize:ec.pageSize||20}),[em,ep]=(0,u.useState)(0),[ef,eg]=(0,u.useState)([]),[eb,ev]=(0,u.useState)([]),[ey,ej]=(0,u.useState)(null),ew=eh.page*eh.pageSize+1,eS=(0,c.xI)(()=>{var e,t;return{leadStatus:ec.leadStatus||[],leadSource:ec.leadSource||[],site:ec.site||[],prospect:ec.prospect||[],startDate:ec.startDate,endDate:ec.endDate,broker:ec.broker,customer:ec.customer,healthScoreMin:ec.healthScoreMin,healthScoreMax:ec.healthScoreMax,buyingIntentMin:ec.buyingIntentMin,buyingIntentMax:ec.buyingIntentMax,overdueDaysMin:ec.overdueDaysMin,overdueDaysMax:ec.overdueDaysMax,followUpStatus:ec.followUpStatus||"",healthScoreRange:ec.healthScoreRange||"",buyingIntent:ec.buyingIntent||"",sortBy:null!=(t=null!=(e=ec.sortBy)?e:localStorage.getItem(tl))?t:ta}}),{state:eC}=eS,{sitesData:eI,sitesLoading:eA,sitesError:eN}=(0,_.MZ)(),{prospectData:ek,prospectLoading:eD,prospectError:eM}=(0,J.n)(),eL=(0,u.useMemo)(()=>eA||eN||!Array.isArray(eI)?[]:tn(eI,"SiteName","SiteId"),[eI,eA,eN]),eW=(0,u.useMemo)(()=>eD||eM||!Array.isArray(ek)?[]:tn(ek,"ProspectTypeName","ProspectTypeId"),[ek,eD,eM]),ez=(0,u.useMemo)(()=>{var e,t,l,a;let r={};if(eC.leadStatus&&Array.isArray(eC.leadStatus)&&eC.leadStatus.length>0&&(r.LeadStatus=eC.leadStatus),eC.leadSource&&Array.isArray(eC.leadSource)&&eC.leadSource.length>0&&(r.LeadSource=eC.leadSource),eC.site&&Array.isArray(eC.site)&&eC.site.length>0&&eL.length>0){let e=eC.site.map(e=>{var t;return null==(t=eL.find(t=>t.value===e))?void 0:t.label}).filter(Boolean);e.length>0&&(r.SiteName=e)}if(eC.prospect&&Array.isArray(eC.prospect)&&eC.prospect.length>0&&eW.length>0){let e=eC.prospect.map(e=>{var t;return null==(t=eW.find(t=>t.value===e))?void 0:t.label}).filter(Boolean);e.length>0&&(r.ProspectTypeName=e)}return eC.startDate&&(r.StartDate=eC.startDate),eC.endDate&&(r.EndDate=eC.endDate),(null==(e=eC.broker)?void 0:e.value)&&(null==(t=eC.broker)?void 0:t.ContactNo)&&(r.BrokerNumber=[eC.broker.ContactNo]),(null==(l=eC.customer)?void 0:l.value)&&(null==(a=eC.customer)?void 0:a.ContactNo)&&(r.CustomerNo=[eC.customer.ContactNo]),null!=eC.healthScoreMin&&(r.HealthScoreMin=eC.healthScoreMin),null!=eC.healthScoreMax&&(r.HealthScoreMax=eC.healthScoreMax),null!=eC.buyingIntentMin&&(r.BuyingIntentMin=eC.buyingIntentMin),null!=eC.buyingIntentMax&&(r.BuyingIntentMax=eC.buyingIntentMax),null!=eC.overdueDaysMin&&(r.OverdueDaysMin=eC.overdueDaysMin),null!=eC.overdueDaysMax&&(r.OverdueDaysMax=eC.overdueDaysMax),eC.followUpStatus&&(r.FollowUpStatus=eC.followUpStatus),r.sortBy=eC.sortBy||ta,r},[eC,eL,eW]),{detailedLeadsData:eR,detailedLeadsLoading:eF,detailedLeadsError:eU,refetch:eP}=(0,Q.aA)(ew,eh.pageSize,ez),{aggregatesData:eT,aggregatesLoading:eE,aggregatesError:eB,refetchAggregates:eO}=(0,Q.Ey)();(0,u.useEffect)(()=>{if(eU){let e=(null==eU?void 0:eU.message)||"Failed to load lead data";r.oR.error(e,{containerId:"error",autoClose:5e3})}},[eU]),(0,u.useEffect)(()=>{if(eB){var e,t;console.error("Aggregates error:",eB);let l=(null==eB||null==(t=eB.response)||null==(e=t.data)?void 0:e.detail)||(null==eB?void 0:eB.message)||"Failed to load priority alerts";r.oR.error("".concat(l,". Some counts may be unavailable."),{containerId:"error",autoClose:5e3})}},[eB]),(0,u.useEffect)(()=>{if(!eF){var e;(null==eR||null==(e=eR.data)?void 0:e.length)?eg(eR.data.map(e=>{var t,l,a,r,i,n,o,s,d;return{id:e.LeadId,leadName:e.LeadName,contactId:e.ContactId,customerName:e.ContactId&&"".concat(null==(t=e.contacts)?void 0:t.ContactFName," ").concat(null==(l=e.contacts)?void 0:l.ContactLName),customerContact:null==(a=e.contacts)?void 0:a.ContactNo,customerEmail:null==(r=e.contacts)?void 0:r.ContactEmail,brokerId:e.BrokerId,brokerName:e.BrokerId&&(null==(i=e.broker)?void 0:i.ContactFName)?"".concat(e.broker.ContactFName," ").concat(e.broker.ContactLName):null,brokerContact:null==(n=e.broker)?void 0:n.ContactNo,prospectTypeId:e.ProspectTypeId,buyerType:null==(o=e.prospecttypes)?void 0:o.ProspectTypeName,leadStatus:e.LeadStatus,leadSource:e.LeadSource,leadCreatedDate:e.CreatedDate,leadUpdatedDate:e.UpdatedDate,leadClosedDate:e.LeadClosedDate,quotedAmount:e.QuotedAmount,closedAmount:e.ClosedAmount,requestedAmount:e.RequestedAmount,siteId:e.SiteId,siteName:null==(s=e.site)?void 0:s.SiteName,suggestedUnitId:e.SuggestedUnitId,suggestedUnitNumber:e.SuggestedUnitId&&(null==(d=e.suggestedunit)?void 0:d.UnitNumber),viewType:e.ViewType,floorPreference:e.FloorPreference,direction:e.Direction,bedrooms:e.Bedrooms,buyingIntent:e.BuyingIntent,infraId:e.InfraId,infraUnitId:e.InfraUnitId,sizeSqFt:e.SizeSqFt,leadPriority:e.LeadPriority,leadType:e.LeadType,leadNotes:e.LeadNotes,healthScore:e.HealthScore,healthScoreLabel:tc(e.HealthScore),aiPriority:e.AIPriority,velocityScore:e.VelocityScore,followUpStatus:(0,U.I4)(e.FollowUpStatus),overdueDays:e.OverdueDays||0,aiRecommendation:e.RecommendationJson?(()=>{try{return JSON.parse(e.RecommendationJson)}catch(e){return console.error("Failed to parse RecommendationJson:",e),null}})():null,conversionProbability:e.ConversionProbability,churnRisk:e.ChurnRisk,scoresLastUpdated:e.ScoresLastUpdated,contacts:e.contacts,broker:e.broker}})):eg([])}},[eR,eF]),(0,u.useEffect)(()=>{(null==eR?void 0:eR.total_records)!==void 0&&ep(eR.total_records)},[eR]);let eH=(0,u.useCallback)(e=>{e.pageSize!==eh.pageSize?ex({...e,page:0}):ex(e)},[eh.pageSize]);(0,u.useEffect)(()=>{eu({leadStatus:Array.isArray(eC.leadStatus)&&eC.leadStatus.length>0?eC.leadStatus:null,leadSource:Array.isArray(eC.leadSource)&&eC.leadSource.length>0?eC.leadSource:null,site:Array.isArray(eC.site)&&eC.site.length>0?eC.site:null,prospect:Array.isArray(eC.prospect)&&eC.prospect.length>0?eC.prospect:null,broker:eC.broker||null,customer:eC.customer||null,startDate:eC.startDate||null,endDate:eC.endDate||null,healthScoreMin:null!=eC.healthScoreMin?eC.healthScoreMin:null,healthScoreMax:null!=eC.healthScoreMax?eC.healthScoreMax:null,buyingIntentMin:null!=eC.buyingIntentMin?eC.buyingIntentMin:null,buyingIntentMax:null!=eC.buyingIntentMax?eC.buyingIntentMax:null,overdueDaysMin:null!=eC.overdueDaysMin?eC.overdueDaysMin:null,overdueDaysMax:null!=eC.overdueDaysMax?eC.overdueDaysMax:null,healthScoreRange:eC.healthScoreRange||null,buyingIntent:eC.buyingIntent||null,followUpStatus:eC.followUpStatus||null,sortBy:eC.sortBy||null,page:eh.page,pageSize:eh.pageSize})},[eC,eh,eu]),(0,u.useEffect)(()=>{ex(e=>({...e,page:0}))},[eC]);let eq=(0,u.useMemo)(()=>ef,[ef]),eV=Array.isArray(eC.leadStatus)&&eC.leadStatus.length>0||Array.isArray(eC.leadSource)&&eC.leadSource.length>0||Array.isArray(eC.site)&&eC.site.length>0||Array.isArray(eC.prospect)&&eC.prospect.length>0||eC.startDate||eC.endDate||(null==(e=eC.broker)?void 0:e.value)||(null==(t=eC.customer)?void 0:t.value)||eC.healthScoreRange||null!=eC.healthScoreMin||null!=eC.healthScoreMax||eC.buyingIntent||null!=eC.buyingIntentMin||null!=eC.buyingIntentMax||null!=eC.overdueDaysMin||null!=eC.overdueDaysMax||eC.followUpStatus,e_=(0,u.useMemo)(()=>eq.reduce((e,t)=>(e[t.id]=t,e),{}),[eq]),eG=(0,u.useCallback)((e,t)=>{ei(e.currentTarget),eo(t)},[]),eJ=(0,u.useCallback)(()=>{ei(null),eo(null)},[]),eQ=(0,u.useCallback)(async e=>{if(en)try{await (0,Q.cF)(en.id,{LeadName:en.leadName,LeadStatus:e}),r.oR.success("Updated Lead Status to ".concat(e),{containerId:"success"}),eP(),eO(),eJ()}catch(e){r.oR.error(e.message||"Failed to update lead status",{containerId:"error"})}},[en,eP]),eY=(0,u.useCallback)(e=>{et(e),$(!0)},[]),eX=(0,u.useCallback)(()=>{$(!1),et(null)},[]),eK=(0,u.useCallback)(e=>{B(e),H(!0)},[]),eZ=(0,u.useCallback)(async e=>{try{let t=await (0,G.XL)(e);r.oR.success("Follow-up ".concat((null==t?void 0:t.FollowUpsId)||""," created successfully!"),{containerId:"success"}),await (0,s.j)(V.vZ.home.todos.readAll,void 0,{revalidate:!0}),eX(),eP(),eO()}catch(t){console.error("Error creating follow-up:",t);let e="string"==typeof t?t:(null==t?void 0:t.message)||"Error creating follow-up!";throw r.oR.error(e,{containerId:"error"}),t}},[eP,eX]),e$=(0,u.useCallback)(e=>{eS.setState({customer:e})},[eS]),e0=(0,u.useCallback)(e=>{eS.setState({broker:e})},[eS]),e1=(0,u.useCallback)(async e=>{if(!eb.length)return void r.oR.warning("Please select at least one lead to update",{containerId:"error"});try{let t=eb.filter(e=>e_[e]);if(0===t.length)return void r.oR.error("No valid leads found to update",{containerId:"error"});eb.filter(e=>!e_[e]).length>0&&r.oR.warning("Some selected leads could not be found and will be skipped",{containerId:"error"});let l=t.map(t=>(0,Q.cF)(t,{LeadName:e_[t].leadName,LeadStatus:e}).catch(e=>({error:!0,id:t,message:e.message}))),a=(await Promise.all(l)).filter(e=>null==e?void 0:e.error),i=t.length-a.length;i>0&&r.oR.success("Successfully updated ".concat(i," lead").concat(i>1?"s":""," to ").concat(e," status"),{containerId:"success"}),a.length>0&&r.oR.error("Failed to update ".concat(a.length," lead").concat(a.length>1?"s":""),{containerId:"error"}),eP(),eO()}catch(e){r.oR.error("Failed to update leads: ".concat(e.message||"Unknown error"),{containerId:"error"})}},[eb,e_,eP]),e5=()=>[{field:"leadName",headerName:"Lead Name",minWidth:n?120:180,flex:1,hideable:!1,groupable:!1,renderCell:e=>(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,a.jsx)(g.default,{size:"small",onMouseDown:e=>{e.stopPropagation()},onClick:t=>{t.stopPropagation(),B(e.row),H(!0)},sx:{color:"text.secondary",p:.5,"&:hover":{color:"primary.main"}},children:(0,a.jsx)(Y.W,{icon:"eva:eye-fill",width:20})}),(0,a.jsx)(b.default,{variant:"body2",sx:{cursor:"pointer",flexGrow:1,"&:hover":{textDecoration:"underline",color:"primary.main"}},onMouseDown:e=>{e.stopPropagation()},onClick:t=>{t.stopPropagation(),B(e.row),H(!0)},children:e.value||"—"}),n&&(0,a.jsx)(g.default,{size:"small",onMouseDown:e=>{e.stopPropagation()},onClick:t=>{t.stopPropagation(),eG(t,e.row)},sx:{color:"text.secondary",p:.5,"&:hover":{color:"primary.main"}},children:(0,a.jsx)(Y.W,{icon:"eva:more-vertical-fill",width:20})})]})},{field:"siteName",headerName:"Site Name",minWidth:n?100:130,hide:n,renderCell:e=>(0,a.jsx)(e6,{params:e,fieldType:"siteName"})},{field:"customerName",headerName:n?"Customer":"Cust Name",minWidth:n?100:140,flex:1,hideable:!1,renderCell:e=>(0,a.jsx)(e3,{params:e,href:i.f.dashboard.contact.profile(e.row.contactId)})},{field:"customerContact",headerName:n?"Contact":"Cust Contact",minWidth:n?90:130,hide:n,renderCell:e=>(0,a.jsx)(e4,{params:e})},{field:"leadStatus",headerName:n?"Status":"Lead Status",minWidth:n?80:100,renderCell:e=>(0,a.jsx)(e6,{params:e})},{field:"followUpStatus",headerName:n?"Follow":"Follow-up",minWidth:n?100:150,sortable:!0,hide:n,renderCell:e=>(0,a.jsx)(e9.H,{params:e}),sortComparator:(e,t)=>{var l,a;let r={overdue:0,today:1,this_week:2,scheduled:3,none:4};return(null!=(l=r[e])?l:99)-(null!=(a=r[t])?a:99)}},{field:"healthScore",headerName:"Health",minWidth:n?80:120,sortable:!0,type:"number",renderCell:e=>(0,a.jsx)(e9.HA,{params:e})},{field:"aiPriority",headerName:n?"Pri":"Priority",minWidth:n?60:100,sortable:!0,type:"number",hide:n,renderCell:e=>(0,a.jsx)(e9.NN,{params:e})},{field:"buyingIntent",headerName:n?"Intent":"Buying Intent",minWidth:n?80:140,sortable:!0,type:"number",hide:!n,renderCell:e=>(0,a.jsx)(e9.Jh,{params:e})},{field:"brokerName",headerName:"Broker Name",minWidth:140,hide:!0,renderCell:e=>(0,a.jsx)(e6,{params:e})},{field:"brokerContact",headerName:"Broker Contact",minWidth:140,hide:!0,renderCell:e=>(0,a.jsx)(e4,{params:e})},{field:"leadSource",headerName:"Lead Source",minWidth:140,hide:n,renderCell:e=>(0,a.jsx)(e6,{params:e})},{field:"suggestedUnitNumber",headerName:"Unit No",minWidth:80,groupable:!1,hide:!0,renderCell:e=>(0,a.jsx)(e6,{params:e})},{field:"customerEmail",headerName:"Cust Email",minWidth:140,groupable:!1,hide:!0,renderCell:e=>(0,a.jsx)(e6,{params:e})},{field:"buyerType",headerName:"Buyer Type",minWidth:140,hide:n,renderCell:e=>(0,a.jsx)(e6,{params:e})},{field:"requestedAmount",headerName:"Requested Amount",minWidth:150,groupable:!1,hide:n,renderCell:e=>(0,a.jsx)(e8,{params:e})},{field:"quotedAmount",headerName:"Quoted Amount",minWidth:130,groupable:!1,hide:!0,renderCell:e=>(0,a.jsx)(e8,{params:e})},{field:"closedAmount",headerName:"Closed Amount",minWidth:130,groupable:!1,hide:!0,renderCell:e=>(0,a.jsx)(e8,{params:e})},{field:"floorPreference",headerName:"Floor Preference",minWidth:140,groupable:!1,hide:!0,renderCell:e=>(0,a.jsx)(e6,{params:e})},{field:"viewType",headerName:"View Preference",minWidth:140,groupable:!1,hide:!0,renderCell:e=>(0,a.jsx)(e6,{params:e})},{field:"bedrooms",headerName:"Bedroom Preference",minWidth:140,groupable:!1,hide:!0,renderCell:e=>(0,a.jsx)(e6,{params:e})},{field:"direction",headerName:"Direction Preference",minWidth:140,groupable:!1,hide:!0,renderCell:e=>(0,a.jsx)(e6,{params:e})},{field:"leadCreatedDate",headerName:"Created Date",minWidth:150,groupable:!1,hide:n,renderCell:e=>(0,a.jsx)(e7,{params:e})},{field:"leadUpdatedDate",headerName:"Updated Date",minWidth:150,groupable:!1,hide:!0,renderCell:e=>(0,a.jsx)(e7,{params:e})},{field:"leadClosedDate",headerName:"Closed Date",minWidth:150,groupable:!1,hide:!0,renderCell:e=>(0,a.jsx)(e7,{params:e})},{field:"actions",headerName:n?"Actions":"Quick Actions",headerClassName:"sticky-column",cellClassName:"sticky-column",width:n?100:220,sortable:!1,filterable:!1,disableColumnMenu:!0,resizable:!0,groupable:!1,hide:n,renderCell:e=>(0,a.jsx)(th,{params:e,refetch:eP,refetchAggregates:eO,onOpenFollowUpDrawer:eY})}],ti=(0,u.useMemo)(()=>e5().map(e=>({...e,headerAlign:e.headerAlign||"center",align:e.align||"center"})),[n,eP,eY]),tu=[{groupId:"lead",headerName:"Lead Info",children:[{field:"leadName"},{field:"siteName"},{field:"leadStatus"},{field:"leadSource"},{field:"suggestedUnitNumber"},{field:"buyerType"}]},{groupId:"customer",headerName:"Customer Info",children:[{field:"customerName"},{field:"customerContact"},{field:"customerEmail"}]},{groupId:"scoring",headerName:"Lead Scoring",children:[{field:"followUpStatus"},{field:"healthScore"},{field:"aiPriority"},{field:"buyingIntent"}]},{groupId:"broker",headerName:"Broker Info",children:[{field:"brokerName"},{field:"brokerContact"}]},{groupId:"amounts",headerName:"Lead Amounts Info",children:[{field:"requestedAmount"},{field:"quotedAmount"},{field:"closedAmount"}]},{groupId:"preferences",headerName:"Lead Preferences/Requirements",children:[{field:"floorPreference"},{field:"viewType"},{field:"bedrooms"},{field:"direction"}]},{groupId:"dates",headerName:"Lead Dates",children:[{field:"leadCreatedDate"},{field:"leadUpdatedDate"},{field:"leadClosedDate"}]}].map(e=>({...e,headerAlign:"center"})),tx=(0,u.useCallback)(e=>{eS.setState({sortBy:e});try{localStorage.setItem(tl,e)}catch(e){console.error("Failed to save sort preference:",e)}ex(e=>({...e,page:0}))},[eS]),tm=(0,u.useCallback)(()=>(0,a.jsx)(e9.Jw,{canReset:eV,filters:eS,filteredResults:eq.length,totalRecords:em,hasActiveFilters:eV,leadStatusOptions:to,leadSourceOptions:ts,prospectOptions:eW,siteOptions:eL,STATUS_OPTIONS:td,SORT_OPTIONS:tr,selectedRowIds:eb,handleMassUpdateStatus:e1,onResetPage:()=>ex(e=>({...e,page:0})),viewMode:o,isMobile:n,currentSortBy:eC.sortBy||ta,onSortChange:tx}),[eC,eb,eV,eq,em,eV,o,n,tx]),tp=eU&&!eF;(0,u.useEffect)(()=>{let e=39===eC.healthScoreMax&&4===eC.overdueDaysMin,t=eC.followUpStatus===U.eX.TODAY,l=8===eC.buyingIntentMin&&!eC.buyingIntentMax,a=eC.followUpStatus===U.eX.OVERDUE;("urgent"!==ey||e)&&("due_today"!==ey||t)&&("high_intent"!==ey||l)&&("overdue"!==ey||a)||ej(null)},[eC,ey]);let tf=(0,u.useMemo)(()=>{var e,t,l,a,r,i;return[(null==(e=eC.leadStatus)?void 0:e.length)>0,(null==(t=eC.leadSource)?void 0:t.length)>0,(null==(l=eC.site)?void 0:l.length)>0,(null==(a=eC.prospect)?void 0:a.length)>0,!!eC.startDate,!!eC.endDate,!!(null==(r=eC.broker)?void 0:r.value),!!(null==(i=eC.customer)?void 0:i.value),!!eC.healthScoreRange,!!eC.buyingIntent,!!eC.followUpStatus].filter(Boolean).length},[eC]),tg=(0,u.useCallback)(e=>{let t={leadStatus:[],leadSource:[],site:[],prospect:[],startDate:null,endDate:null,broker:null,customer:null,healthScoreMin:null,healthScoreMax:null,buyingIntentMin:null,buyingIntentMax:null,overdueDaysMin:null,overdueDaysMax:null,followUpStatus:"",healthScoreRange:"",buyingIntent:"",sortBy:eC.sortBy||"ai_priority"};if(ey===e){ej(null),eS.setState(t),ex(e=>({...e,page:0}));return}switch(ej(e),e){case"urgent":eS.setState({...t,healthScoreMax:39,overdueDaysMin:4});break;case"due_today":eS.setState({...t,followUpStatus:U.eX.TODAY});break;case"high_intent":eS.setState({...t,buyingIntentMin:8});break;case"overdue":eS.setState({...t,followUpStatus:U.eX.OVERDUE});break;default:console.warn("Unknown badge ID:",e);return}ex(e=>({...e,page:0}))},[eS,eC.sortBy,ey]);return tp&&!ef.length?(0,a.jsx)(v.A,{sx:{p:3},children:(0,a.jsx)(X.H,{title:"Failed to load leads",description:(null==eU?void 0:eU.message)||"There was an error loading the lead data. Please try refreshing the page.",action:(0,a.jsx)(y.default,{variant:"contained",startIcon:(0,a.jsx)(Y.W,{icon:"eva:refresh-fill"}),onClick:()=>{eP(),eO()},children:"Retry"})})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(f.A,{mb:{xs:1,md:1,lg:1,xl:2},sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"center"},gap:{xs:1.5,md:2}},children:[(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,a.jsx)(j.default,{title:"Create new lead",arrow:!0,children:(0,a.jsx)(y.default,{component:F.W,href:i.f.dashboard.lead.new,variant:"contained",color:"inherit",size:"small",startIcon:(0,a.jsx)(Y.W,{icon:"mingcute:add-line"}),children:"New"})}),(0,a.jsxs)(w.A,{value:o,exclusive:!0,onChange:(e,t)=>{null!==t&&es(t)},size:"small",color:"standard",sx:{"& .MuiToggleButton-root":{px:1.5,py:.5,color:"text.primary",borderColor:"divider",backgroundColor:"rgba(145, 158, 171, 0.16)","&:hover":{backgroundColor:"rgba(145, 158, 171, 0.24)"},"&.Mui-selected":{backgroundColor:"rgba(145, 158, 171, 0.24)",color:"text.primary",borderColor:"primary.main",borderWidth:"2px","&:hover":{backgroundColor:"rgba(145, 158, 171, 0.32)"}}}},children:[(0,a.jsxs)(S.default,{value:"table","aria-label":"table view",color:"inherit",children:[(0,a.jsx)(Y.W,{icon:"material-symbols:table-rows",width:20,sx:{mr:.5}}),!n&&"Table"]}),(0,a.jsx)(S.default,{value:"card","aria-label":"card view",children:(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,a.jsx)(Y.W,{icon:"material-symbols:grid-view",width:20,sx:{mr:.5}}),!n&&"Cards",n&&(0,a.jsx)(Y.W,{icon:"solar:star-bold",width:12,sx:{color:"warning.main",ml:.25}})]})})]})]}),(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:{xs:1.5,sm:2},marginLeft:{xs:0,md:"auto"},width:{xs:"100%",md:"auto"}},children:[(0,a.jsxs)(C.A,{size:"small",sx:{flex:{xs:1,sm:0},minWidth:{xs:0,sm:200,md:220},maxWidth:{xs:"100%",sm:300}},children:[(0,a.jsx)(I.default,{children:"Sort By"}),(0,a.jsx)(A.A,{value:eC.sortBy||ta,onChange:e=>tx(e.target.value),label:"Sort By",sx:{"& .MuiSelect-select":{pr:{xs:4,sm:6},display:"flex",alignItems:"center",fontSize:{xs:"0.875rem",sm:"1rem"}}},children:tr.map(e=>(0,a.jsx)(N.default,{value:e.value,children:(0,a.jsxs)(f.A,{sx:{display:"flex",alignItems:"center",gap:{xs:.5,sm:1},fontSize:{xs:"0.875rem",sm:"1rem"}},children:[(0,a.jsx)(Y.W,{icon:e.icon,width:{xs:16,sm:18}}),(0,a.jsx)("span",{children:e.label.replace(" (Recommended)","").replace(" (High to Low)"," ↓").replace(" (Low to High)"," ↑").replace(" (Highest)","").replace(" (Newest)"," ↓").replace(" (Oldest)"," ↑").replace(" (A-Z)","").replace(" First","")})]})},e.value))})]}),(0,a.jsx)(y.default,{variant:"contained",color:"inherit",size:"small",startIcon:(0,a.jsx)(Y.W,{icon:"material-symbols:filter-alt",width:18}),onClick:()=>ea(!0),endIcon:tf>0?(0,a.jsx)(k.default,{badgeContent:tf,color:"primary",children:(0,a.jsx)(f.A,{})}):null,sx:{minWidth:{xs:100,sm:120},px:{xs:1.5,sm:2},whiteSpace:"nowrap"},children:"Filters"})]})]}),(eF||eE)&&!ef.length?(0,a.jsx)(e9.xE,{}):(0,a.jsx)(e9.N$,{aggregates:eT||{},loading:eE,error:eB,onBadgeClick:tg,activeBadge:ey,onRetry:eO}),(0,a.jsxs)(v.A,{sx:{minHeight:{xs:600,md:600},flexGrow:{md:1},display:"flex",height:{xs:"auto",md:"1px"},flexDirection:"column",overflow:"auto"},children:[eF&&!ef.length?(0,a.jsx)(e9.Z3,{}):tm(),eF&&!ef.length?(0,a.jsx)(e9.oB,{viewMode:o}):"card"===o?(0,a.jsxs)(f.A,{sx:{display:"flex",flexDirection:"column",flex:1},children:[(0,a.jsx)(f.A,{sx:{overflowY:"auto",flex:1},children:(0,a.jsx)(e9.Cy,{leads:eq,loading:eF&&ef.length>0,onRefresh:eP,onOpenFollowUp:eY,onViewDetails:eK})}),(0,a.jsx)(D.A,{component:"div",count:em,page:eh.page,onPageChange:(e,t)=>{ex({...eh,page:t})},rowsPerPage:eh.pageSize,onRowsPerPageChange:e=>{ex({page:0,pageSize:parseInt(e.target.value,10)})},rowsPerPageOptions:te,labelRowsPerPage:n?"Per page:":"Rows per page:",sx:{borderTop:1,borderColor:"divider","& .MuiTablePagination-toolbar":{minHeight:{xs:48,sm:52}},"& .MuiTablePagination-selectLabel, & .MuiTablePagination-displayedRows":{fontSize:{xs:"0.75rem",sm:"0.875rem"}}}})]}):(0,a.jsx)(h._,{rows:eq,columns:ti,columnGroupingModel:tu,rowCount:em,loading:eF,pagination:!0,paginationMode:"server",paginationModel:eh,onPaginationModelChange:eH,pageSizeOptions:te,columnVisibilityModel:P,onColumnVisibilityModelChange:ed,initialState:{pinnedColumns:n?{left:[x.f.field]}:{left:[x.f.field],right:["actions"]}},onRowSelectionModelChange:e=>{(null==e?void 0:e.ids)instanceof Set?ev(Array.from(e.ids)):ev([])},slots:{toolbar:e9.Ti,loadingOverlay:M.A,noRowsOverlay:()=>(0,a.jsx)(X.H,{title:eV?"No leads found":"No leads available",description:eV?"No leads match the current filters. Try adjusting your filter criteria.":"There are no leads in the system yet."}),noResultsOverlay:()=>(0,a.jsx)(X.H,{title:"No results found",description:"No leads match your search criteria. Try different filters or search terms."})},slotProps:{toolbar:{filters:eC,onCustomerChange:e$,onBrokerChange:e0}},checkboxSelection:!0,disableRowSelectionOnClick:!0,disableAggregation:!0,disablePivoting:!0,showToolbar:!0,columnHeaderHeight:40,getRowHeight:()=>"auto",rowHeight:52,scrollbarSize:30,sx:{minHeight:450,"& .MuiDataGrid-virtualScroller":{overflow:"auto"},"& .MuiDataGrid-pinnedColumnHeaders, & .MuiDataGrid-pinnedColumns":{backgroundColor:"background.paper",zIndex:1},"& .MuiDataGrid-pinnedColumnHeaders":{zIndex:2},"& .MuiDataGrid-columnHeaders":{display:"flex",alignItems:"center",borderTop:"2px solid",borderColor:"divider"},"& .MuiDataGrid-columnHeaderGroup":{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.04)",fontWeight:"bold"},"& .MuiDataGrid-groupHeaderCell":{justifyContent:"center",fontSize:"0.875rem",fontWeight:700,color:"primary.main"},"& .MuiDataGrid-columnHeaderTitle":{textAlign:"center",width:"100%"},"& .MuiDataGrid-cell":{borderRight:"1px solid",borderColor:"divider",display:"flex",alignItems:"center",justifyContent:"center"},"& .MuiDataGrid-row":{borderColor:"divider"},"& .MuiDataGrid-columnHeader":{borderColor:"divider"}}})]}),(0,a.jsx)(e2,{open:O,onClose:()=>{H(!1),B(null)},lead:E,onDataChange:eP}),(0,a.jsxs)(L.A,{anchorEl:er,open:!!er,onClose:eJ,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{minWidth:200,"& .MuiMenuItem-root":{px:2,py:1}}},children:[(0,a.jsxs)(N.default,{onClick:()=>eQ("Win"),children:[(0,a.jsx)(W.default,{children:(0,a.jsx)(Y.W,{icon:"ic:baseline-check-circle",width:24,sx:{color:"#22C55E"}})}),(0,a.jsx)(z.A,{children:"Mark as Win"})]}),(0,a.jsxs)(N.default,{onClick:()=>eQ("Lost"),children:[(0,a.jsx)(W.default,{children:(0,a.jsx)(Y.W,{icon:"mingcute:close-circle-fill",width:24,sx:{color:"#FF5630"}})}),(0,a.jsx)(z.A,{children:"Mark as Lost"})]}),(0,a.jsxs)(N.default,{onClick:()=>eQ("Qualify"),children:[(0,a.jsx)(W.default,{children:(0,a.jsx)(Y.W,{icon:"material-symbols:diamond",width:24,sx:{color:"#8E33FF"}})}),(0,a.jsx)(z.A,{children:"Mark as Qualify"})]}),(0,a.jsxs)(N.default,{onClick:()=>{eY(en),eJ()},children:[(0,a.jsx)(W.default,{children:(0,a.jsx)(Y.W,{icon:"material-symbols:add-task",width:24,sx:{color:"#00B8D9"}})}),(0,a.jsx)(z.A,{primary:"Create Follow-up"})]})]}),(0,a.jsx)(K.u,{open:Z,onClose:eX,onSave:eZ,followUp:null,context:"lead",leadId:null==ee?void 0:ee.id,currentLead:{LeadName:null==ee?void 0:ee.leadName}}),(0,a.jsx)(e9.qk,{open:el,onClose:()=>ea(!1),filters:eS,options:{leadStatus:to,leadSource:ts,site:eL,prospect:eW},onResetPage:()=>ex(e=>({...e,page:0}))})]})}let th=(0,u.forwardRef)((e,t)=>{let{params:l,refetch:i,refetchAggregates:n,onOpenFollowUpDrawer:o,sx:s={}}=e,{id:d,leadName:c,leadStatus:h}=l.row,[x,m]=(0,u.useState)(!1),[p,b]=(0,u.useState)(null),v=(0,u.useCallback)(async e=>{m(!0),b(e);try{await (0,Q.cF)(d,{LeadName:c,LeadStatus:e}),r.oR.success("Updated Lead Status from ".concat(h," to ").concat(e),{containerId:"success"}),i(),n()}catch(a){var t,l;let e=(null==(l=a.response)||null==(t=l.data)?void 0:t.message)||a.message||"Failed to update lead status";r.oR.error(e,{containerId:"error"})}finally{m(!1),b(null)}},[d,c,h,i,n]),w=(0,u.useCallback)(()=>{o&&o(l.row)},[o,l.row]);return(0,a.jsx)(f.A,{ref:t,sx:{display:"flex",alignItems:"center",gap:.5,...s},children:[{label:"Win",color:"#22C55E",tooltip:"Mark as Won",icon:"ic:baseline-check-circle",onclick:()=>v("Win")},{label:"Lost",color:"#FF5630",tooltip:"Mark as Lost",icon:"mingcute:close-circle-fill",onclick:()=>v("Lost")},{label:"Qualify",color:"#8E33FF",tooltip:"Mark as Qualified",onclick:()=>v("Qualify")},{label:"Follow",color:"#FFA500",tooltip:"Create Follow-up",icon:"mdi:calendar-clock",onclick:w}].map(e=>{let t=p===e.label,l=h===e.label,r="Follow"===e.label,i=r?x:x||l;return(null==e?void 0:e.icon)?(0,a.jsx)(j.default,{title:r?e.tooltip:l?"Current status: ".concat(e.label):x&&!t?"Please wait...":e.tooltip||e.label,arrow:!0,children:(0,a.jsx)("span",{children:(0,a.jsx)(g.default,{onMouseDown:e=>{e.stopPropagation()},onClick:t=>{t.stopPropagation(),e.onclick()},disabled:i,sx:{position:"relative",opacity:i?.5:1,"&:hover":{transform:i?"none":"scale(1.1)"},transition:"all 0.2s"},children:t&&!r?(0,a.jsx)(R.default,{size:26,sx:{color:e.color}}):(0,a.jsx)(Y.W,{icon:e.icon,color:r?e.color:l?"#919EAB":e.color,width:26,height:26})})})},e.label):(0,a.jsx)(y.default,{size:"small",onMouseDown:e=>{e.stopPropagation()},onClick:t=>{t.stopPropagation(),e.onclick()},variant:"text",disabled:i,sx:{minWidth:60,position:"relative",opacity:i?.6:1,"&:hover":{transform:i?"none":"scale(1.05)"},transition:"all 0.2s"},children:t?(0,a.jsx)(R.default,{size:16,sx:{color:e.color}}):(0,a.jsx)(f.A,{component:"span",sx:{backgroundColor:l?"#919EAB":e.color,color:"white",borderRadius:"4px",px:.8,py:.2,fontSize:"0.75rem",fontWeight:600,boxShadow:l?"none":"0 2px 4px rgba(0,0,0,0.1)"},children:e.label})},e.label)})})});var tx=l(92447);function tm(){return(0,a.jsxs)(n.KG,{maxWidth:"none",sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[(0,a.jsx)(o.g,{links:[{name:"Home",href:i.f.dashboard.root},{name:"Lead"}],sx:{mb:{xs:1,xl:2}}}),(0,a.jsx)(tx.z,{children:(0,a.jsx)(tu,{})}),(0,a.jsx)(r.N9,{containerId:"success",position:"top-right",autoClose:2e3}),(0,a.jsx)(r.N9,{containerId:"error",position:"top-right",autoClose:!1,closeOnClick:!0})]})}},57331:(e,t,l)=>{Promise.resolve().then(l.bind(l,57185)),Promise.resolve().then(l.bind(l,60662)),Promise.resolve().then(l.bind(l,81052))},60662:(e,t,l)=>{"use strict";l.r(t),l.d(t,{LeadProfileView:()=>V});var a=l(95155),r=l(38543),i=l(35695),n=l(49742),o=l(695),s=l(35046),d=l(83469),c=l(40054),u=l.n(c),h=l(55594),x=l(62177),m=l(90221),p=l(12115),f=l(68074),g=l(78894),b=l(21030),v=l(68086),y=l(84256),j=l(44192),w=l(89438),S=l(40001),C=l(96801),I=l(78822),A=l(53494),N=l(66292),k=l(72635),D=l(27740),M=l(85098),L=l(88165),W=l(38867),z=l(60521),R=l(54961),F=l(58821),U=l(32030),P=l(50827),T=l(32591);let E=h.z.object({brokerId:h.z.number().nullable().optional(),contactDetails:R.yf.nullableInput(h.z.object({id:h.z.number(),name:h.z.string(),phoneNumber:h.z.number()}),{message:"Contact Details is required!"}),brokerDetails:h.z.object({id:h.z.number(),name:h.z.string(),phoneNumber:h.z.number()}).nullable().optional(),siteDetails:h.z.object({id:h.z.number(),name:h.z.string(),fullAddress:h.z.string()}).nullable().optional()});function B(e){var t;let{leadId:l}=e,{detailedLeadData:i,detailedLeadLoading:n,refetch:o}=(0,L.OB)(l),{visitByLeadData:s,visitByLeadLoading:d}=(0,M.jE)(l),[c,h]=(0,p.useState)({}),[f,C]=(0,p.useState)({}),[I,A]=(0,p.useState)(!1),[N,k]=(0,p.useState)(null),D=(0,p.useRef)(!1),[W,z]=(0,p.useState)(!1),R=(0,p.useRef)(!1);async function B(e,t){try{return await (0,L.Q6)(e,t),r.oR.dismiss(),r.oR.success("Successfully edited lead data!",{containerId:"success"}),!0}catch(e){throw r.oR.dismiss(),r.oR.error("Failed to edit lead data!",{containerId:"error"}),window.Sentry&&window.Sentry.captureException(e),e}}(0,p.useEffect)(()=>{i&&Object.keys(i).length>0&&!n&&(R.current||(h(i),C(i),z(!1),D.current=!1))},[i,n]);let H=e=>{if(!e)return"Unknown Contact";let t=e.ContactFName||"",l=e.ContactLName||"";return"".concat(t," ").concat(l).trim()||"Unknown Contact"},q=(0,p.useMemo)(()=>{var e,t,l,a;return{leadName:c.LeadName,leadStatus:c.LeadStatus,leadSource:c.LeadSource,prospectType:c.ProspectType,buyingIntent:c.BuyingIntent,propertyType:c.PropertyType,contactDetails:c.ContactId?{id:c.ContactId,name:H(c.contacts),phoneNumber:null==(e=c.contacts)?void 0:e.ContactNo}:null,brokerDetails:c.BrokerId?{id:c.BrokerId,name:H(c.broker),phoneNumber:null==(t=c.broker)?void 0:t.ContactNo}:null,siteDetails:c.SiteId?{id:c.SiteId,name:(null==(l=c.site)?void 0:l.SiteName)||"Unknown Site",fullAddress:(null==(a=c.site)?void 0:a.SiteAddress)||"No Address"}:null}},[c]),{watch:V,reset:_}=(0,x.mN)({mode:"all",resolver:(0,m.u)(E),defaultValues:q}),G=V();(0,p.useEffect)(()=>{_(q)},[q,_]);let J=async()=>{var e,t,a;let i=Number(c.BuyingIntent);if(i&&(i<0||i>10))return void r.oR.error("Buying Intent must be between 0 and 10");let n={LeadId:l,LeadName:c.LeadName,ContactId:c.ContactId,SiteId:c.SiteId,InfraId:c.InfraId||null,InfraUnitId:c.InfraUnitId||null,ProspectTypeId:c.ProspectTypeId||null,QuotedAmount:null!=(e=c.QuotedAmount)?e:null,RequestedAmount:null!=(t=c.RequestedAmount)?t:null,ClosedAmount:null!=(a=c.ClosedAmount)?a:null,LeadStatus:c.LeadStatus,BrokerId:c.BrokerId,SuggestedUnitId:c.SuggestedUnitId,Bedrooms:c.Bedrooms,SizeSqFt:c.SizeSqFt,ViewType:c.ViewType,FloorPreference:c.FloorPreference,BuyingIntent:i||null,LeadPriority:c.LeadPriority,LeadType:c.LeadType,LeadSource:c.LeadSource,LeadNotes:c.LeadNotes,Direction:c.Direction,Locality:c.Locality||null,LostReasons:c.LostReasons||null};try{A(!0),k(null),await B(l,n),await o(),C({...c}),z(!1),D.current=!1,R.current=!1}catch(e){k(e.message)}finally{A(!1)}},[Q,Y]=(0,p.useState)(!1),[X,K]=(0,p.useState)("visit"),Z=(0,p.useCallback)((e,t)=>{K(t)},[]);return(0,p.useEffect)(()=>{let e=!u().isEqual(c,f);e!==W&&(z(e),D.current=e,R.current=e)},[c,f,W]),(0,p.useEffect)(()=>{let e=e=>{if(D.current)return e.preventDefault(),e.returnValue="You have unsaved changes","You have unsaved changes"};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(b.A,{spacing:1,sx:{mb:1},children:[(0,a.jsx)(O,{saveAll:J,resetAll:()=>{Y(!0),h(f),z(!1),D.current=!1,R.current=!1,k(null)},isDirty:W,loading:I}),n?(0,a.jsx)(v.A,{variant:"rectangular",width:"100%",height:145,sx:{borderRadius:3}}):(0,a.jsx)(P.x,{currentLead:c,setCurrentLead:h}),n?(0,a.jsx)(v.A,{variant:"rectangular",width:"100%",height:130,sx:{borderRadius:3}}):(0,a.jsx)(y.A,{children:(0,a.jsx)(T.vo,{currentLead:c,setCurrentLead:h,isReset:Q,setIsReset:Y})}),n?(0,a.jsx)(v.A,{variant:"rectangular",width:"100%",height:180,sx:{borderRadius:3}}):(0,a.jsx)(T.Md,{siteId:(null==G||null==(t=G.siteDetails)?void 0:t.id)||(null==c?void 0:c.SiteId),currentLead:c,setCurrentLead:h}),n?(0,a.jsx)(v.A,{variant:"rectangular",width:"100%",height:180,sx:{borderRadius:3}}):(0,a.jsxs)(y.A,{children:[(0,a.jsxs)(j.A,{value:X,onChange:Z,sx:{px:3,boxShadow:e=>"inset 0 -2px 0 0 ".concat((0,g.X4)(e.palette.grey[500],.08))},children:[(0,a.jsx)(w.default,{value:"visit",label:"Visit"}),(0,a.jsx)(w.default,{value:"followup",label:"Follow-Up"}),(0,a.jsx)(w.default,{value:"notes",label:"Notes"})]}),"visit"===X&&(0,a.jsx)(T.Ed,{visitByLeadData:s,visitByLeadLoading:d,isLoading:n,leadId:l}),"followup"===X&&(0,a.jsx)(F.FollowUps,{leadId:l,currentLead:c}),"notes"===X&&(0,a.jsx)(T.uC,{currentLead:c,setCurrentLead:h})]})]}),N&&(0,a.jsxs)(S.default,{severity:"error",sx:{mt:2},onClose:()=>k(null),children:["Failed to save: ",N]}),(0,a.jsx)(U.A,{isDirty:W})]})}function O(e){let{saveAll:t,resetAll:l,isDirty:r,loading:i}=e;return(0,a.jsxs)(C.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",md:"repeat(2, 1fr)"}},children:[(0,a.jsxs)(C.A,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[(0,a.jsx)(I.default,{title:"Create new lead",arrow:!0,children:(0,a.jsx)(f.default,{size:"small",color:"inherit",variant:"contained",component:k.W,href:n.f.dashboard.lead.new,startIcon:(0,a.jsx)(W.W,{icon:"mingcute:add-line"}),sx:{pr:1.5,mr:1.5},children:"New"})}),(0,a.jsx)(I.default,{title:"View List",arrow:!0,children:(0,a.jsx)(A.default,{component:k.W,href:n.f.dashboard.lead.root,children:(0,a.jsx)(W.W,{icon:"material-symbols:view-list",sx:{width:30,height:30}})})}),(0,a.jsx)(I.default,{title:"View Kanban",arrow:!0,children:(0,a.jsx)(A.default,{component:k.W,href:n.f.dashboard.lead.kanban,children:(0,a.jsx)(z.Q,{src:"".concat(D.P.assetsDir,"/assets/icons/navbar/ic-kanban.svg"),sx:{width:30,height:30}})})})]}),!0===r&&(0,a.jsxs)(C.A,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:[(0,a.jsx)(I.default,{title:"Reset changes",arrow:!0,children:(0,a.jsx)(N.default,{onClick:l,color:"inherit",variant:"outlined",size:"small",sx:{mr:1.5},disabled:i,children:"Reset"})}),(0,a.jsx)(I.default,{title:"Save changes",arrow:!0,children:(0,a.jsx)(f.default,{onClick:t,type:"submit",size:"small",variant:"contained",loading:i,disabled:i,children:"Save"})})]})]})}var H=l(9670);class q extends p.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){window.Sentry&&window.Sentry.captureException(e,{contexts:{react:{componentStack:t.componentStack}}}),this.setState({errorInfo:t})}render(){if(this.state.hasError){let{error:e,retryCount:t}=this.state;return(0,a.jsxs)(y.A,{sx:{p:4,textAlign:"center",maxWidth:600,mx:"auto",mt:4},children:[(0,a.jsx)(C.A,{sx:{mb:3},children:(0,a.jsx)(W.W,{icon:"solar:danger-triangle-bold",width:64,sx:{color:"error.main"}})}),(0,a.jsx)(H.default,{variant:"h5",gutterBottom:!0,color:"error",children:"Something went wrong"}),(0,a.jsx)(H.default,{variant:"body2",color:"text.secondary",sx:{mb:3},children:(null==e?void 0:e.message)||"Unable to load lead profile. Please try again."}),t>2&&(0,a.jsx)(S.default,{severity:"warning",sx:{mb:2},children:"Multiple errors detected. Please contact support if the problem persists."}),(0,a.jsxs)(C.A,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[(0,a.jsx)(N.default,{variant:"outlined",onClick:this.handleReset,startIcon:(0,a.jsx)(W.W,{icon:"solar:refresh-bold"}),children:"Try Again"}),(0,a.jsx)(N.default,{variant:"contained",onClick:this.handleReload,startIcon:(0,a.jsx)(W.W,{icon:"solar:restart-bold"}),children:"Reload Page"})]}),!1]})}return this.props.children}constructor(e){super(e),this.handleReset=()=>{this.setState(e=>({hasError:!1,error:null,errorInfo:null,retryCount:e.retryCount+1}))},this.handleReload=()=>{window.location.reload()},this.state={hasError:!1,error:null,errorInfo:null,retryCount:0}}}function V(){let e=(0,i.useParams)(),t=(0,o.rd)(),l=(0,i.useSearchParams)(),c=(null==e?void 0:e.leadId)||l.get("id"),u=Number(c);if(!c||isNaN(u)||!Number.isSafeInteger(u)||u<=0||u>0x7fffffff)return window.gtag&&window.gtag("event","invalid_lead_access",{attempted_id:c,timestamp:new Date().toISOString()}),t.replace("/404"),null;let h=l.toString()?"".concat(n.f.dashboard.lead.root,"?").concat(l.toString()):n.f.dashboard.lead.root;return(0,a.jsxs)(s.KG,{children:[(0,a.jsx)(d.g,{links:[{name:"Home",href:n.f.dashboard.root},{name:"Lead",href:h},{name:"Lead Profile"}],sx:{mb:{xs:1,md:1}}}),(0,a.jsx)(q,{children:(0,a.jsx)(B,{leadId:u})}),(0,a.jsx)(r.N9,{containerId:"success",position:"top-right",autoClose:2e3}),(0,a.jsx)(r.N9,{containerId:"error",position:"top-right",autoClose:!1,closeOnClick:!0})]})}},81052:(e,t,l)=>{"use strict";l.r(t),l.d(t,{NewLeadForm:()=>M});var a=l(95155),r=l(49742),i=l(35046),n=l(83469),o=l(55594),s=l(12115),d=l(38543),c=l(62177),u=l(36339),h=l(90221),x=l(68074),m=l(21030),p=l(84256),f=l(9670),g=l(96801),b=l(66292),v=l(695),y=l(88165),j=l(54961),w=l(32591),S=l(18088);let C={contactDetails:null,siteDetails:null,direction:"",view:"",floor:"",unitType:"",sizeSqFt:"",locality:"",buyingIntent:"",leadStatus:"New",leadSource:"",brokerId:null,description:""},I=o.z.object({contactDetails:j.yf.nullableInput(o.z.object({id:o.z.number(),name:o.z.string(),phoneNumber:o.z.union([o.z.string(),o.z.number()])}),{message:"Contact Details is required!"}),siteDetails:j.yf.nullableInput(o.z.object({id:o.z.number(),name:o.z.string(),fullAddress:o.z.string()}),{message:"Interested Site Details is required!"}),floor:o.z.string().nullable().optional(),view:o.z.string().nullable().optional(),direction:o.z.string().nullable().optional(),unitType:o.z.string().nullable().optional(),sizeSqFt:o.z.coerce.number().nullable().optional(),locality:o.z.string().nullable().optional(),buyingIntent:o.z.string().nullable().optional().refine(e=>!e||/^\d+$/.test(e),"Buying intent must be a valid number"),leadStatus:o.z.string().min(1,"Lead Status is required"),leadSource:o.z.string().nullable().optional(),brokerId:o.z.number().nullable().optional(),description:o.z.string().nullable().optional()});function A(){var e;let t=(0,v.rd)(),l=(0,u.Cg)(),i=(0,c.mN)({mode:"all",resolver:(0,h.u)(I),defaultValues:C}),{watch:n,reset:o,handleSubmit:A,formState:{isSubmitting:N,isDirty:k,isValid:D,dirtyFields:M}}=i,L=n(),W=null==L||null==(e=L.siteDetails)?void 0:e.id,z=null==L?void 0:L.brokerId,R=(0,s.useCallback)(e=>{if(!e.contactDetails||!e.siteDetails)throw d.oR.dismiss(),d.oR.error("Missing required details",{containerId:"error"}),Error("Missing required contact or site details");return{LeadName:"".concat(e.contactDetails.name," ").concat(e.siteDetails.name),ContactId:e.contactDetails.id,SiteId:e.siteDetails.id,LeadStatus:e.leadStatus||"New",...e.brokerId&&{BrokerId:e.brokerId},...e.unitType&&{Bedrooms:e.unitType},...e.view&&{ViewType:e.view},...e.floor&&!Number.isNaN(Number(e.floor))&&{FloorPreference:Number(e.floor)},...e.direction&&{Direction:e.direction},...e.sizeSqFt&&{SizeSqFt:e.sizeSqFt},...e.locality&&{Locality:e.locality},...e.buyingIntent&&!Number.isNaN(Number(e.buyingIntent))&&{BuyingIntent:Number(e.buyingIntent)},...e.leadSource&&{LeadSource:e.leadSource},...e.description&&{LeadNotes:e.description}}},[]),F=(0,s.useCallback)(async function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{let l=R(e),a=await (0,y.tR)(l);return d.oR.dismiss(),d.oR.success("New lead created successfully!",{containerId:"success"}),o(),t.push(r.f.dashboard.lead.profile(a.LeadId)),a}catch(t){var a;if(l<2&&(null==(a=t.response)?void 0:a.status)>=500)return d.oR.info("Retrying... (".concat(l+1,"/").concat(2,")"),{containerId:"info"}),await new Promise(e=>setTimeout(e,1e3*(l+1))),F(e,l+1);throw d.oR.dismiss(),d.oR.error("Error in creating new lead!",{containerId:"error"}),t}},[R,o,t]),U=A(async e=>{l.onTrue();try{await F(e)}finally{l.onFalse()}}),P=l.value||N,T=L.contactDetails&&L.siteDetails&&L.leadStatus&&!P;return(0,a.jsx)(j.lV,{methods:i,onSubmit:U,children:(0,a.jsxs)(m.A,{spacing:1,children:[(0,a.jsx)(p.A,{children:(0,a.jsx)(S.Q,{})}),(0,a.jsx)(w.V1,{siteId:W}),(0,a.jsx)(w.e$,{brokerId:z}),(0,a.jsxs)(p.A,{children:[(0,a.jsx)(f.default,{variant:"h6",sx:{px:2.5,py:1},children:"Lead Notes"}),(0,a.jsx)(j.D0.Editor,{name:"description"})]}),(0,a.jsxs)(g.A,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[(0,a.jsx)(b.default,{size:"small",variant:"outlined",disabled:!k&&!L.contactDetails&&!L.siteDetails,onClick:()=>o(C),children:"Reset"}),(0,a.jsx)(x.default,{type:"submit",size:"small",variant:"contained",loading:P,disabled:!T,children:"Create"})]})]})})}var N=l(38637),k=l.n(N);class D extends s.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Lead form error:",e,t)}render(){return this.state.hasError?(0,a.jsxs)(g.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:400,gap:2,p:3},children:[(0,a.jsx)(f.default,{variant:"h6",color:"error",children:"Something went wrong"}),(0,a.jsx)(f.default,{variant:"body2",color:"text.secondary",align:"center",children:"An error occurred while processing the lead form. Please try again."}),(0,a.jsx)(b.default,{variant:"contained",onClick:this.handleReset,children:"Try Again"})]}):this.props.children}constructor(e){super(e),this.handleReset=()=>{this.setState({hasError:!1,error:null}),this.props.onReset&&this.props.onReset()},this.state={hasError:!1,error:null}}}function M(){return(0,a.jsxs)(i.KG,{children:[(0,a.jsx)(n.g,{links:[{name:"Home",href:r.f.dashboard.root},{name:"Lead",href:r.f.dashboard.lead.root},{name:"New Lead"}],sx:{mb:{xs:3,md:2}}}),(0,a.jsx)(D,{children:(0,a.jsx)(A,{})})]})}D.propTypes={children:k().node.isRequired,onReset:k().func}}}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5789],{1407:(e,t,l)=>{"use strict";l.d(t,{u:()=>V});var i=l(95155),n=l(55594),r=l(30832),a=l.n(r),s=l(38637),o=l.n(s),d=l(62177),u=l(90221),c=l(12115),m=l(96801),p=l(68074),f=l(9670),h=l(91580),v=l(78822),x=l(53494),b=l(15930),g=l(80158),y=l(95946),j=l(2360),C=l(66292),S=l(5551),w=l(32104),I=l(7841),A=l(77308),k=l(31847),D=l(38867),N=l(54961);let z=n.z.object({leadId:n.z.string().optional(),type:n.z.string().min(1,"Follow-up type is required"),followUpDate:n.z.any().refine(e=>e,{message:"Follow-up date & time is required"}),nextFollowUpDate:n.z.any().nullable(),status:n.z.string().min(1,"Status is required"),userId:n.z.union([n.z.string().min(1,"Assigned user is required"),n.z.number().min(1,"Assigned user is required")]),notes:n.z.string().optional()});function V(e){let{open:t,onClose:l,followUp:n,onSave:r,leadId:s,currentLead:o,context:V="lead",visitId:T=null,currentVisit:F=null}=e,{usersData:P}=(0,I.jR)(),{userData:O}=(0,A._)(),L=(0,c.useMemo)(()=>({leadId:(null==o?void 0:o.LeadName)||"",type:(null==n?void 0:n.type)||"Call",followUpDate:(null==n?void 0:n.followUpDate)?a()(n.followUpDate):a()(),nextFollowUpDate:(null==n?void 0:n.nextFollowUpDate)?a()(n.nextFollowUpDate):(null==n?void 0:n.followUpDate)?a()(n.followUpDate).add(7,"day"):a()().add(7,"day"),status:(null==n?void 0:n.status)||"Pending",userId:(null==n?void 0:n.userId)||(null==O?void 0:O.id)||"",notes:(null==n?void 0:n.notes)||""}),[n,o,O]),R=(0,d.mN)({mode:"all",resolver:(0,u.u)(z),defaultValues:L}),{reset:W,watch:U,handleSubmit:E,formState:{isSubmitting:q,isDirty:M}}=R,B=U("status"),_=(0,c.useCallback)(()=>{W(L)},[W,L]);(0,c.useEffect)(()=>{t&&(n?W(L):W({leadId:(null==o?void 0:o.LeadName)||"",type:"Call",followUpDate:a()(),nextFollowUpDate:a()().add(7,"day"),status:"Pending",userId:(null==O?void 0:O.id)||"",notes:""}))},[L,W,t,n,s,null==o?void 0:o.LeadName,O]);let G=E(async e=>{try{let t={LeadId:"lead"===V?"string"==typeof s?parseInt(s,10):s:null,VisitId:"visit"===V?"string"==typeof T?parseInt(T,10):T:null,UserId:"string"==typeof e.userId?parseInt(e.userId,10):e.userId,FollowUpType:e.type,Status:e.status,FollowUpDate:a()(e.followUpDate).toISOString(),NextFollowUpDate:e.nextFollowUpDate?a()(e.nextFollowUpDate).toISOString():null,Notes:e.notes||null};((null==n?void 0:n.id)||(null==n?void 0:n.FollowUpId))&&(t.FollowUpId=n.id||n.FollowUpId),await (null==r?void 0:r(t)),l()}catch(e){console.error("Error saving follow-up:",e)}});return(0,i.jsxs)(S.Ay,{anchor:"right",open:t,onClose:l,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:500,maxWidth:"100vw",display:"flex",flexDirection:"column",height:"100%"}},children:[(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(m.A,{sx:{py:2,pr:1,pl:2.5,display:"flex",alignItems:"center"},children:[(0,i.jsxs)(f.default,{variant:"h6",sx:{flexGrow:1},children:[n?"Edit":"Create New"," Follow-up"]}),n&&(0,i.jsx)(h.default,{label:B,color:"Completed"===B?"success":"Cancelled"===B?"error":"warning",sx:{mr:1,textTransform:"capitalize"}}),(0,i.jsx)(v.default,{title:"Reset Form",arrow:!0,children:(0,i.jsx)(x.default,{onClick:_,children:(0,i.jsx)(b.default,{color:"error",variant:"dot",invisible:!M,children:(0,i.jsx)(D.W,{icon:"solar:restart-bold"})})})}),(0,i.jsx)(x.default,{onClick:l,children:(0,i.jsx)(D.W,{icon:"mingcute:close-line"})})]}),(0,i.jsx)(g.default,{sx:{borderStyle:"dashed"}})]}),(0,i.jsx)(m.A,{sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:(0,i.jsxs)(N.lV,{methods:R,onSubmit:G,children:[(0,i.jsxs)(m.A,{sx:{p:2.5,display:"flex",flexDirection:"column",gap:3,flexGrow:1},children:["lead"===V&&(0,i.jsx)(y.default,{label:"Lead",value:(null==o?void 0:o.LeadName)||"",disabled:!0,fullWidth:!0,InputProps:{readOnly:!0}}),"visit"===V&&(0,i.jsx)(y.default,{label:"Visit",value:F?"".concat(F.siteName||"Visit"," - ").concat(F.visitDate?(0,w.ts)(F.visitDate):"N/A"):"",disabled:!0,fullWidth:!0,InputProps:{readOnly:!0}}),(0,i.jsx)(N.D0.Select,{name:"type",label:"Follow-up Type",required:!0,children:k.Nz.map(e=>(0,i.jsx)(j.default,{value:e.value,children:e.label},e.value))}),(0,i.jsxs)(m.A,{sx:{display:"flex",gap:2},children:[(0,i.jsx)(N.D0.DatePicker2,{name:"followUpDate",label:"Follow-up Date"}),(0,i.jsx)(N.D0.DatePicker2,{name:"nextFollowUpDate",label:"Next Follow-up Date"})]}),(0,i.jsx)(N.D0.Select,{name:"status",label:"Status",required:!0,children:k.dk.map(e=>(0,i.jsx)(j.default,{value:e.value,children:e.label},e.value))}),(0,i.jsx)(N.D0.Select,{name:"userId",label:"Assigned To",required:!0,children:null==P?void 0:P.map(e=>(0,i.jsxs)(j.default,{value:e.id,children:[e.FirstName," ",e.LastName]},e.id))}),(0,i.jsx)(N.D0.Text,{name:"notes",label:"Additional Notes",placeholder:"Enter notes...",multiline:!0,rows:4})]}),(0,i.jsxs)(m.A,{sx:{p:2.5,display:"flex",justifyContent:"flex-end",gap:2},children:[(0,i.jsx)(C.default,{onClick:l,color:"inherit",variant:"outlined",children:"Cancel"}),(0,i.jsx)(p.default,{type:"submit",variant:"contained",loading:q,children:n?"Update":"Create"})]})]})})]})}V.propTypes={open:o().bool.isRequired,onClose:o().func.isRequired,followUp:o().object,onSave:o().func.isRequired,leadId:o().oneOfType([o().string,o().number]),currentLead:o().object,context:o().oneOf(["lead","visit"]),visitId:o().oneOfType([o().string,o().number]),currentVisit:o().object}},7841:(e,t,l)=>{"use strict";l.d(t,{be:()=>o,jR:()=>s});var i=l(19169),n=l(12115),r=l(18835);let a={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function s(){let e=r.vZ.users.readAll,{data:t,isLoading:l,error:s,isValidating:o,mutate:d}=(0,i.Ay)(e,r.GO,a),u=(0,n.useCallback)(()=>d(),[d]);return(0,n.useMemo)(()=>({usersData:null!=t?t:[],usersLoading:l||o,usersError:s?(null==s?void 0:s.message)||"Error fetching users":null,usersValidating:o,usersEmpty:!l&&!o&&(!Array.isArray(t)||0===t.length),getAllUsersMutations:u}),[t,s,l,o,u])}function o(e){let t=e?r.vZ.users.readSingle(e):null,{data:l,isLoading:s,error:o,isValidating:d,mutate:u}=(0,i.Ay)(t,r.GO,a),c=(0,n.useCallback)(()=>u(),[u]);return(0,n.useMemo)(()=>({userData:null!=l?l:{},userLoading:s,userError:o?(null==o?void 0:o.message)||"Error fetching user":null,userValidating:d,userEmpty:!s&&!d&&(!Array.isArray(l)||0===l.length),getUserMutation:c}),[l,o,s,d,c])}},7971:(e,t,l)=>{"use strict";l.d(t,{_z:()=>o,nT:()=>d,oh:()=>s});var i=l(19169),n=l(12115),r=l(18835);let a={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function s(e){let t=e?r.vZ.visitor.readVisitVisitors(e):null,{data:l,isLoading:s,error:o,isValidating:d,mutate:u}=(0,i.Ay)(t,r.ev,a);return(0,n.useMemo)(()=>{let e=null;if(o){var t,i;let l=null==(t=o.response)?void 0:t.status,n=null==(i=o.response)?void 0:i.data;e={message:(null==n?void 0:n.detail)||(null==n?void 0:n.message)||o.message||"Failed to load visitor data",statusCode:l,isRetryable:!l||l>=500||0===l||408===l,isAuthError:401===l||403===l,isNotFound:404===l,isForbidden:403===l,isClientError:l>=400&&l<500,isServerError:l>=500,isNetworkError:!l||0===l,originalError:o}}let n=!s&&!d&&!o&&(!l||!l.visitors||0===l.visitors.length);return{visitVisitorData:null!=l?l:[],visitVisitorLoading:s,visitVisitorError:e,visitVisitorIsValidating:d,visitVisitorEmpty:n,refetchVisitVisitor:()=>u()}},[l,s,o,d,u])}async function o(e,t){let l=r.vZ.visitor.update(e);return await (0,r.mu)([l,t])}let d=async e=>{let t=r.vZ.visitor.create;return(await (0,r.$P)([t,e])).data}},16531:(e,t,l)=>{"use strict";l.d(t,{XL:()=>n,Y3:()=>r,qP:()=>a});var i=l(18835);let n=async e=>{try{return(await i.Ay.post(i.vZ.followups.createFollowup,e)).data}catch(e){var t,l,n;if(console.error("Error (createFollowUp) : ",(null==(t=e.response)?void 0:t.data)||e),e.response)throw(null==(l=e.response.data)?void 0:l.detail)||(null==(n=e.response.data)?void 0:n.message)||"Server error: ".concat(e.response.status);if(e.request)throw"Network error: Unable to reach the server (CORS or server may be down)";throw e.message||"Error creating follow-up"}},r=async(e,t)=>{try{console.log("=== API UPDATE FOLLOW-UP REQUEST ==="),console.log("Endpoint:",i.vZ.followups.updateFollowup(t)),console.log("Follow-up ID:",t),console.log("Request Body:",JSON.stringify(e,null,2));let l=await i.Ay.put(i.vZ.followups.updateFollowup(t),e);return console.log("=== API UPDATE FOLLOW-UP RESPONSE ==="),console.log("Response:",l.data),l.data}catch(e){var l,n,r;if(console.error("Error (updateFollowUp) : ",(null==(l=e.response)?void 0:l.data)||e),e.response)throw(null==(n=e.response.data)?void 0:n.detail)||(null==(r=e.response.data)?void 0:r.message)||"Server error: ".concat(e.response.status);if(e.request)throw"Network error: Unable to reach the server (CORS or server may be down)";throw e.message||"Error updating follow-up"}},a=async e=>{try{return(await i.Ay.delete(i.vZ.followups.deleteFollowup(e))).data}catch(e){var t,l,n;if(console.error("Error (deleteFollowUp) : ",(null==(t=e.response)?void 0:t.data)||e),e.response)throw(null==(l=e.response.data)?void 0:l.detail)||(null==(n=e.response.data)?void 0:n.message)||"Server error: ".concat(e.response.status);if(e.request)throw"Network error: Unable to reach the server (CORS or server may be down)";throw e.message||"Error deleting follow-up"}}},20991:(e,t,l)=>{"use strict";function i(e,t){return t.split(".").reduce((e,t)=>e&&e[t],e)}function n(e,t,l){let n=i(e,l),r=i(t,l);return r<n?-1:+(r>n)}function r(e,t){return"desc"===e?(e,l)=>n(e,l,t):(e,l)=>-n(e,l,t)}l.d(t,{nz:()=>j,cY:()=>b,V2:()=>C,F2:()=>x,gR:()=>y,Sb:()=>g,hz:()=>r,K2:()=>s});var a=l(12115);function s(e){var t,l,i,n,r;let[s,o]=(0,a.useState)(!!(null==e?void 0:e.defaultDense)),[d,u]=(0,a.useState)(null!=(t=null==e?void 0:e.defaultCurrentPage)?t:0),[c,m]=(0,a.useState)(null!=(l=null==e?void 0:e.defaultOrderBy)?l:"customerName"),[p,f]=(0,a.useState)(null!=(i=null==e?void 0:e.defaultRowsPerPage)?i:5),[h,v]=(0,a.useState)(null!=(n=null==e?void 0:e.defaultOrder)?n:"asc"),[x,b]=(0,a.useState)(null!=(r=null==e?void 0:e.defaultSelected)?r:[]),g=(0,a.useCallback)(e=>{let t=c===e&&"asc"===h;""!==e&&(v(t?"desc":"asc"),m(e))},[h,c]),y=(0,a.useCallback)(e=>{b(x.includes(e)?x.filter(t=>t!==e):[...x,e])},[x]),j=(0,a.useCallback)(e=>{u(0),f(parseInt(e.target.value,10))},[]),C=(0,a.useCallback)(e=>{o(e.target.checked)},[]),S=(0,a.useCallback)((e,t)=>{if(e)return void b(t);b([])},[]),w=(0,a.useCallback)((e,t)=>{u(t)},[]),I=(0,a.useCallback)(()=>{u(0)},[]),A=(0,a.useCallback)(e=>{b([]),d&&e<2&&u(d-1)},[d]),k=(0,a.useCallback)((e,t)=>{let l=x.length;b([]),d&&(l===e?u(d-1):l===t?u(0):l>e&&u(Math.ceil((t-l)/p)-1))},[d,p,x.length]);return{dense:s,order:h,page:d,orderBy:c,rowsPerPage:p,selected:x,onSelectRow:y,onSelectAllRows:S,onSort:g,onChangePage:w,onChangeDense:C,onResetPage:I,onChangeRowsPerPage:j,onUpdatePageDeleteRow:A,onUpdatePageDeleteRows:k,setPage:u,setDense:o,setOrder:v,setOrderBy:m,setSelected:b,setRowsPerPage:f}}var o=l(95155);l(69004);var d=l(96801),u=l(21030),c=l(55398),m=l(17764),p=l(9670),f=l(72635),h=l(31224),v=l(32104);let x=(0,a.memo)(function(e){var t;let{params:l,href:i,emptyValue:n="—"}=e,r=null==l||null==(t=l.row)?void 0:t[l.field];return null==r||""===r?(0,o.jsx)("span",{children:n}):(0,o.jsx)(m.A,{component:f.W,href:i,color:"inherit",variant:"subtitle2",sx:{"&:hover":{color:"primary.main"},overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",textTransform:"capitalize"},children:r})}),b=(0,a.memo)(function(e){var t,l;let{params:i,href:n,emptyValue:r="—"}=e;if((null==i||null==(t=i.rowNode)?void 0:t.type)==="group")return(0,o.jsx)(p.default,{variant:"subtitle2",sx:{fontWeight:600},children:i.value||r});let a=null==i||null==(l=i.row)?void 0:l.customerName;if(!a)return(0,o.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",minWidth:1,py:1},children:[(0,o.jsx)(c.A,{sx:{width:30,height:30,mr:2,fontSize:"0.875rem"}}),(0,o.jsx)("span",{children:r})]});let s=a.charAt(0).toUpperCase();return(0,o.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",minWidth:1,py:1},children:[(0,o.jsx)(c.A,{alt:a,sx:{width:30,height:30,mr:2,fontSize:"0.875rem"},children:s}),(0,o.jsx)(m.A,{component:f.W,href:n,variant:"body2",color:"inherit",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical","&:hover":{color:"primary.main"},textTransform:"capitalize"},children:a})]})}),g=(0,a.memo)(function(e){var t,l;let{params:i,emptyValue:n="—"}=e;if((null==i||null==(t=i.rowNode)?void 0:t.type)==="group")return(0,o.jsx)(p.default,{variant:"subtitle2",sx:{fontWeight:600,textTransform:"capitalize"},children:i.value||n});let r=null==i||null==(l=i.row)?void 0:l[i.field];if(null==r||""===r)return(0,o.jsx)("span",{children:n});let a="string"==typeof r?r:String(r);return(0,o.jsx)(p.default,{variant:"body2",color:"inherit",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",wordBreak:"break-word"},children:a})}),y=(0,a.memo)(function(e){var t,l;let{params:i,emptyValue:n="—"}=e;if((null==i||null==(t=i.rowNode)?void 0:t.type)==="group")return(0,o.jsx)(p.default,{variant:"subtitle2",sx:{fontWeight:600},children:i.value||n});let r=null==i||null==(l=i.row)?void 0:l[i.field];return null==r||""===r?(0,o.jsx)("span",{children:n}):(0,o.jsx)(p.default,{variant:"body2",color:"inherit",sx:{fontVariantNumeric:"tabular-nums",textAlign:"right",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})}),j=(0,a.memo)(function(e){var t;let{params:l,emptyValue:i="—"}=e,n=null==l||null==(t=l.row)?void 0:t[l.field];return null==n||""===n?(0,o.jsx)("span",{children:i}):(0,o.jsx)(p.default,{variant:"body2",color:"inherit",sx:{fontVariantNumeric:"tabular-nums",textAlign:"right",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(0,h.KZ)(n)})}),C=(0,a.memo)(function(e){var t;let{params:l,emptyValue:i="—",showTime:n=!0}=e,r=null==l||null==(t=l.row)?void 0:t[l.field];return!r||isNaN(new Date(r).getTime())?(0,o.jsx)("span",{children:i}):(0,o.jsxs)(u.A,{spacing:.5,alignItems:"flex-start",children:[(0,o.jsx)(p.default,{variant:"body2",children:(0,v.ts)(r)}),n&&(0,o.jsx)(p.default,{variant:"caption",color:"text.secondary",children:(0,v.qi)(r)})]})})},25404:(e,t,l)=>{"use strict";l.d(t,{Z:()=>k});var i=l(95155),n=l(55594),r=l(62177),a=l(12115),s=l(90221),o=l(96801),d=l(84256),u=l(9670),c=l(80158),m=l(92634),p=l(95946),f=l(15876),h=l(84762),v=l(25949),x=l(72137),b=l(60032),g=l(72330),y=l(57236),j=l(62516),C=l(56117),S=l(74234),w=l(56626),I=l(54961);let A=n.z.object({floorPreference:n.z.string().nullable().optional(),viewType:n.z.string().nullable().optional(),direction:n.z.string().nullable().optional(),bedrooms:n.z.string().nullable().optional(),sizeSqFt:n.z.coerce.number().nullable().optional(),infraUnitId:n.z.coerce.number().nullable().optional(),buyingIntent:n.z.string().nullable().optional().refine(e=>!e||/^\d+$/.test(e),"Buying intent must be a valid number"),notes:n.z.string().nullable().optional()});function k(e){var t,l,n,k,D,N,z;let{visitor:V,siteId:T,detailsForm:F,setDetailsForm:P,isEditing:O}=e,L={floorPreference:(null==V?void 0:V.floorPreference)?String(V.floorPreference):null,viewType:null!=(t=null==V?void 0:V.viewType)?t:null,direction:null!=(l=null==V?void 0:V.direction)?l:null,bedrooms:null!=(n=null==V?void 0:V.bedrooms)?n:null,sizeSqFt:null!=(k=null==V?void 0:V.sizeSqFt)?k:"",infraUnitId:null!=(D=null==V?void 0:V.infraUnitId)?D:"",buyingIntent:null!=(N=null==V?void 0:V.buyingIntent)?N:"",notes:null!=(z=null==V?void 0:V.notes)?z:""},R=(0,r.mN)({mode:"all",resolver:(0,s.u)(A),defaultValues:L}),{watch:W,setValue:U,reset:E,handleSubmit:q,formState:{isSubmitting:M}}=R,B=W(),[_,G]=(0,a.useState)([]),H=(0,a.useMemo)(()=>{let{floorPreference:e,direction:t,viewType:l,bedrooms:i}=B;return null===e&&null===t&&null===l&&null===i?null:T},[B.floorPreference,B.direction,B.viewType,B.bedrooms,T]),{infraUnitSearchData:Y,infraUnitSearchLoading:Z,infraUnitSearchError:J,infraUnitSearchEmpty:K,hasValidParams:$,refetchInfraUnit:X}=(0,C.AK)(H,B.floorPreference&&Number(B.floorPreference),B.direction,B.bedrooms,B.viewType);(0,a.useEffect)(()=>{!Z&&Y.length&&G(Y.map(e=>{var t,l,i,n,r,a,s;return{id:e.InfraUnitId,floor_number:null!=(t=e.FloorNumber)?t:"-",unit_number:null!=(l=e.UnitNumber)?l:"-",unit_size:null!=(i=e.UnitSize)?i:"-",availability_status:null!=(n=e.AvailabilityStatus)?n:"-",direction:null!=(r=e.Direction)?r:"-",unit_type:null!=(a=e.UnitType)?a:"-",view:null!=(s=e.View)?s:"-"}}))},[Y,Z]);let Q=(0,a.useMemo)(()=>{var e,t,l;return[{label:"Floor Preference",name:"floorPreference",options:(null==(e=S.NS[0])?void 0:e.classify)||[]},{label:"Direction Preference",name:"direction",options:(null==(t=S.Ac[0])?void 0:t.classify)||[]},{label:"Bedrooms",name:"bedrooms",options:S.Tm.flatMap(e=>e.classify)||[]},{label:"View Preference",name:"viewType",options:(null==(l=S.GZ[0])?void 0:l.classify)||[]},{label:"Size Square Feet",name:"sizeSqFt"},{label:"Buying Intent",name:"buyingIntent"}]},[]),ee=e=>{B.infraUnitId===e&&B.infraUnitId?(U("infraUnitId",null),P({...F,infraUnitId:null})):(U("infraUnitId",e),P({...F,infraUnitId:e}))},et=e=>t=>{let l=t.target.value;U(e,l),P({...F,[e]:l})};return(0,i.jsx)(I.lV,{methods:R,children:(0,i.jsxs)(o.A,{sx:{columnGap:1,rowGap:1,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:[(0,i.jsxs)(d.A,{children:[(0,i.jsx)(u.default,{variant:"h6",sx:{pl:2.5,pr:2.5,pt:1,pb:1},children:"Requirement"}),(0,i.jsx)(c.default,{}),(0,i.jsx)(o.A,{sx:{p:1.5,columnGap:1,rowGap:1,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:Q.map(e=>{var t;let{label:l,name:n,options:r}=e;return"buyingIntent"===n?(0,i.jsx)(I.D0.Text2,{name:"buyingIntent",label:"Buying Intent",disabled:!O,onChange:et("buyingIntent")},"buyingIntent"):"sizeSqFt"===n?(0,i.jsx)(I.D0.Text2,{name:"sizeSqFt",label:"Size Square Feet",disabled:!O,onChange:et("sizeSqFt")},"sizeSqFt"):(0,i.jsx)(m.default,{value:B[n]||null,options:r,autoHighlight:!0,disabled:null!=(t=!O||Z)&&t,renderInput:e=>(0,i.jsx)(p.default,{...e,label:l}),onChange:(e,t)=>{U(n,t),P({...F,[n]:t})}},n)})})]}),(0,i.jsxs)(d.A,{children:[(0,i.jsx)(u.default,{variant:"h6",sx:{pl:2.5,pr:2.5,pt:1,pb:1},children:"Options & Suggestion"}),(0,i.jsx)(o.A,{sx:{position:"relative"},children:(0,i.jsx)(w.Z,{children:(0,i.jsx)(f.A,{component:h.default,sx:{maxHeight:250},children:(0,i.jsxs)(v.A,{size:"small",children:[(0,i.jsx)(x.A,{children:(0,i.jsx)(b.default,{children:["Action","Floor No.","Unit No.","Unit Size","Availability","Direction","Unit Type","View"].map(e=>(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:e},e))})}),(0,i.jsx)(y.A,{children:$?Z?(0,i.jsx)(b.default,{children:(0,i.jsx)(g.default,{colSpan:6,align:"center",children:(0,i.jsx)(j.default,{size:50})})}):J?(0,i.jsx)(b.default,{children:(0,i.jsxs)(g.default,{colSpan:6,align:"center",children:["Error : ",J]})}):_.length>0&&!K?_.map(e=>{let{id:t,floor_number:l,unit_number:n,unit_size:r,availability_status:a,direction:s,unit_type:o,view:d}=e;return(0,i.jsxs)(b.default,{children:[(0,i.jsx)(g.default,{onClick:O?()=>ee(t):void 0,sx:{cursor:O?"pointer":"not-allowed",color:t===B.infraUnitId?"success.main":"#1976D2",opacity:O?1:.5,pointerEvents:O?"auto":"none","&:hover":{textDecoration:O?"underline":"none"}},children:t===B.infraUnitId?"Suggested":"Suggest"}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:l}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:n}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:r}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:a}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:s}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:o}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:d})]},t)}):(0,i.jsx)(b.default,{children:(0,i.jsx)(g.default,{colSpan:6,align:"center",children:"No infra units found"})}):(0,i.jsx)(b.default,{children:(0,i.jsx)(g.default,{colSpan:6,align:"center",children:"Select any requirement"})})})]})})})})]})]})})}},30942:(e,t,l)=>{"use strict";l.r(t),l.d(t,{VisitListView:()=>Y});var i=l(95155),n=l(38543),r=l(96801),a=l(78822),s=l(66292),o=l(49742),d=l(72635),u=l(35046),c=l(38867),m=l(83469),p=l(45567),f=l(10478),h=l(36339),v=l(12115),x=l(26096),b=l(93972),g=l(7433),y=l(17764),j=l(53494),C=l(62516),S=l(84256),w=l(89458),I=l(11743);let A=e=>(0,f.Cp)({parse:t=>t?(Array.isArray(t)?t:[t]).map(t=>e.parse(t)).filter(e=>null!=e):[],serialize:t=>Array.isArray(t)&&0!==t.length?t.map(t=>e.serialize(t)):null}),k=A(f.tU),D=A(f.GJ),N=A((0,f.Cp)({parse(e){if(!e||""===e)return null;let t=e.split("|");if(4===t.length){let[e,l,i,n]=t,r=parseInt(e,10);if(!isNaN(r))return{value:r,ContactFName:decodeURIComponent(l||""),ContactLName:decodeURIComponent(i||""),ContactNo:decodeURIComponent(n||""),label:"".concat(decodeURIComponent(l||"")," ").concat(decodeURIComponent(i||"")," (").concat(decodeURIComponent(n||""),")").trim()}}return null},serialize:e=>(null==e?void 0:e.value)?e.ContactFName||e.ContactLName||e.ContactNo?"".concat(e.value,"|").concat(encodeURIComponent(e.ContactFName||""),"|").concat(encodeURIComponent(e.ContactLName||""),"|").concat(encodeURIComponent(e.ContactNo||"")):e.value.toString():""})),z=(0,f.Cp)({parse:e=>e&&""!==e?e:null,serialize:e=>e||""}),V={site:D.withDefault([]),visitStatus:k.withDefault([]),purpose:k.withDefault([]),visitOutlook:k.withDefault([]),broker:N.withDefault([]),customer:N.withDefault([]),startDate:z.withDefault(null),endDate:z.withDefault(null),page:f.GJ.withDefault(0),pageSize:f.GJ.withDefault(10)};var T=l(18835),F=l(71984),P=l(16531),O=l(85098),L=l(7971),R=l(31847),W=l(69004),U=l(20991),E=l(1407),q=l(83392);let M=[10,20,50,100],B={minHeight:600,flexGrow:{md:1},display:{md:"flex"},height:{xs:800,md:"1px"},flexDirection:{md:"column"},overflow:"hidden"},_={["& .".concat(x.x.cell)]:{display:"flex",alignItems:"center",justifyContent:"center",borderRight:"1px solid",borderColor:"divider"},"& .MuiDataGrid-virtualScroller":{overflow:"auto"},"& .MuiDataGrid-pinnedColumnHeaders, & .MuiDataGrid-pinnedColumns":{backgroundColor:"background.paper",zIndex:1},"& .MuiDataGrid-pinnedColumnHeaders":{zIndex:2},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",zIndex:1,borderTop:"2px solid",borderColor:"divider"},"& .MuiDataGrid-columnHeader":{borderColor:"divider","& .MuiDataGrid-columnHeaderTitle":{width:"100%",display:"flex",justifyContent:"center",textAlign:"center"},"& .MuiDataGrid-columnHeaderTitleContainer":{justifyContent:"center"}},"& .MuiDataGrid-row":{borderColor:"divider"},"& .MuiDataGrid-footerContainer":{borderTop:"2px solid",borderColor:"divider"},"& .MuiTablePagination-root":{overflow:"initial"}},G=()=>(0,i.jsx)(g.A,{});function H(){var e,t,l,r,s,u,m,x,g;let[A,k]=(0,f.ab)(V,{shallow:!0,history:"push"}),D=(0,h.xI)(()=>({site:A.site||[],visitStatus:A.visitStatus||[],purpose:A.purpose||[],visitOutlook:A.visitOutlook||[],startDate:A.startDate,endDate:A.endDate,broker:A.broker||[],customer:A.customer||[]})),{state:N}=D,[z,H]=(0,v.useState)(A.page||0),[Y,Z]=(0,v.useState)(A.pageSize||10),[J,K]=(0,v.useState)({}),[$,X]=(0,v.useState)(!1),[Q,ee]=(0,v.useState)(null),[et,el]=(0,v.useState)(null),ei=(0,v.useRef)(!1),en=(0,v.useRef)(0),er=(0,v.useRef)(!1),{sitesData:ea,sitesLoading:es,sitesError:eo}=(0,F.MZ)(),{visitVisitorData:ed,visitVisitorLoading:eu}=(0,L.oh)(Q),ec=(0,v.useMemo)(()=>es||eo||!Array.isArray(ea)?[]:ea.map(e=>({label:e.SiteName,value:e.SiteId})).filter(e=>e.label&&""!==e.label.trim()).sort((e,t)=>e.label.localeCompare(t.label)),[ea,es,eo]),em=(0,v.useMemo)(()=>{var e,t,l,i,n,r;let a={};if((null==(e=N.site)?void 0:e.length)>0&&ec.length>0){let e=N.site.map(e=>{var t;return null==(t=ec.find(t=>t.value===e))?void 0:t.label}).filter(Boolean);e.length>0&&(a.SiteName=e)}return(null==(t=N.broker)?void 0:t.length)>0&&(a.BrokerName=N.broker.map(e=>"".concat(e.ContactFName," ").concat(e.ContactLName).trim()).filter(Boolean),a.BrokerNumber=N.broker.map(e=>e.ContactNo).filter(Boolean)),(null==(l=N.customer)?void 0:l.length)>0&&(a.CustomerName=N.customer.map(e=>"".concat(e.ContactFName," ").concat(e.ContactLName).trim()).filter(Boolean),a.CustomerNo=N.customer.map(e=>e.ContactNo).filter(Boolean)),N.startDate&&(a.StartDate=N.startDate),N.endDate&&(a.EndDate=N.endDate),(null==(i=N.visitStatus)?void 0:i.length)>0&&(a.VisitStatus=N.visitStatus),(null==(n=N.purpose)?void 0:n.length)>0&&(a.Purpose=N.purpose),(null==(r=N.visitOutlook)?void 0:r.length)>0&&(a.VisitOutlook=N.visitOutlook),a},[N,ec]),ep=z+1,{visitsData:ef,visitsError:eh,visitsLoading:ev,visitsTotalRecords:ex}=(0,O.xx)(ep,Y,em),eb=(0,v.useMemo)(()=>(null==ef?void 0:ef.length)?ef.map((e,t)=>{var l,i;return{id:"".concat(e.VisitId,"_").concat(ep,"_").concat(t),visitId:e.VisitId,visitorName:e.VisitorName||null,visitorContactId:e.VisitorContactId||null,visitorContactType:e.VisitorContactType||null,visitorContactNo:e.VisitorContactNo||null,visitStatus:e.VisitStatus,visitDate:e.VisitDate,siteId:e.SiteId,siteName:(null==(l=e.site)?void 0:l.SiteName)||"-",infraId:e.InfraId,infraName:(null==(i=e.infra)?void 0:i.InfraName)||"-",purpose:e.Purpose,visitOutlook:e.VisitOutlook,createdDate:e.CreatedDate,updatedDate:e.UpdatedDate,salesPersonId:e.SalesPersonId,createdById:e.CreatedById,createdByName:e.created_by?"".concat(e.created_by.FirstName," ").concat(e.created_by.LastName):"-"}}):[],[ef,ep]);(0,v.useEffect)(()=>{er.current=!0,H(0),en.current=0,setTimeout(()=>{er.current=!1},100)},[N]),(0,v.useEffect)(()=>{let e=setTimeout(()=>{k({...N,page:z,pageSize:Y})},300);return()=>clearTimeout(e)},[N,z,Y,k]);let eg=(0,v.useCallback)(e=>{if(0===e.page&&er.current){ei.current=!0,H(0),Z(e.pageSize),en.current=0,setTimeout(()=>{ei.current=!1},100);return}(0!==e.page||0===z||ei.current)&&(e.page!==en.current||e.pageSize!==Y)&&(ei.current=!0,en.current=e.page,e.pageSize!==Y?(H(0),Z(e.pageSize),en.current=0):e.page!==z&&H(e.page),setTimeout(()=>{ei.current=!1},100))},[z,Y]),ey=(0,v.useCallback)(e=>{K(e)},[]),ej=(null==(e=N.site)?void 0:e.length)>0||(null==(t=N.visitStatus)?void 0:t.length)>0||(null==(l=N.purpose)?void 0:l.length)>0||(null==(r=N.visitOutlook)?void 0:r.length)>0||N.startDate||N.endDate||(null==(s=N.broker)?void 0:s.length)>0||(null==(u=N.customer)?void 0:u.length)>0,eC=(0,v.useCallback)(()=>{H(0),en.current=0},[]),eS=(0,v.useCallback)(e=>{let{row:t}=e;return(0,i.jsx)(q.O1,{visitId:t.visitId})},[]),ew=(0,v.useCallback)(()=>"auto",[]),eI=(0,v.useCallback)(e=>{el(e),ee(e)},[]);(0,v.useEffect)(()=>{Q&&ed&&!eu&&(X(!0),el(null))},[Q,ed,eu]);let eA=(0,v.useCallback)(()=>{X(!1),ee(null),el(null)},[]),ek=(0,v.useCallback)(async e=>{try{let t=await (0,P.XL)(e);n.oR.success("Follow-up ".concat((null==t?void 0:t.FollowUpsId)||""," created successfully!"),{containerId:"success"}),await (0,p.j)(T.vZ.home.todos.readAll,void 0,{revalidate:!0}),eA()}catch(e){throw console.error("Error creating follow-up:",e),n.oR.error((null==e?void 0:e.message)||"Error creating follow-up!",{containerId:"error"}),e}},[eA]),eD=(0,v.useMemo)(()=>[{field:"visitId",headerName:"Visit",minWidth:100,flex:.5,hideable:!1,groupable:!1,color:"primary",renderCell:e=>(0,i.jsx)(y.A,{component:d.W,href:"".concat(o.f.dashboard.visit.profile(e.row.visitId)),underline:"hover",children:"view more"})},{field:"visitorName",headerName:"Visitors",minWidth:200,flex:1,groupable:!1,renderCell:e=>{let{visitorName:t,visitorContactId:l,visitorContactType:n,visitorContactNo:r}=e.row;if(!t||!l)return(0,i.jsx)(U.Sb,{params:{value:"-"}});let a="".concat(t," (").concat(n,") - ").concat(r);return(0,i.jsx)(y.A,{component:d.W,href:o.f.dashboard.contact.profile(l),target:"_blank",rel:"noopener noreferrer",underline:"hover",sx:{fontSize:"0.875rem",display:"inline-flex",alignItems:"center",gap:.5},children:a})}},{field:"visitStatus",headerName:"Visit Status",minWidth:120,flex:.8,renderCell:e=>(0,i.jsx)(U.Sb,{params:e})},{field:"visitDate",headerName:"Visit Date",minWidth:140,flex:.8,groupable:!1,renderCell:e=>(0,i.jsx)(U.V2,{params:e})},{field:"siteName",headerName:"Site Name",minWidth:150,flex:1.2,renderCell:e=>(0,i.jsx)(U.Sb,{params:e})},{field:"infraName",headerName:"Infra Name",minWidth:150,flex:1.2,renderCell:e=>(0,i.jsx)(U.Sb,{params:e})},{field:"purpose",headerName:"Visit Purpose",minWidth:140,flex:1,groupable:!1,renderCell:e=>(0,i.jsx)(U.Sb,{params:e})},{field:"visitOutlook",headerName:"Visit Outlook",minWidth:130,flex:.8,groupable:!1,renderCell:e=>(0,i.jsx)(U.Sb,{params:e})},{field:"createdDate",headerName:"Created Date",minWidth:140,flex:.9,groupable:!1,renderCell:e=>(0,i.jsx)(U.V2,{params:e})},{field:"updatedDate",headerName:"Updated Date",minWidth:140,flex:.9,groupable:!1,renderCell:e=>(0,i.jsx)(U.V2,{params:e})},{field:"createdByName",headerName:"Created By",minWidth:140,flex:1,groupable:!1,renderCell:e=>(0,i.jsx)(U.Sb,{params:e})},{field:"actions",headerName:"Actions",width:120,sortable:!1,filterable:!1,disableColumnMenu:!0,groupable:!1,hideable:!1,renderCell:e=>{let t=et===e.row.visitId&&eu;return(0,i.jsx)(a.default,{title:t?"Loading...":"Create Follow-up",arrow:!0,children:(0,i.jsx)("span",{children:(0,i.jsx)(j.default,{disabled:t,onMouseDown:e=>e.stopPropagation(),onClick:t=>{t.stopPropagation(),eI(e.row.visitId)},sx:{"&:hover":{transform:t?"none":"scale(1.1)"},transition:"all 0.2s"},children:t?(0,i.jsx)(C.default,{size:26,sx:{color:"#FFA500"}}):(0,i.jsx)(c.W,{icon:"mdi:calendar-clock",color:"#FFA500",width:26,height:26})})})})}}],[eI,et,eu]),eN=(0,v.useMemo)(()=>({pinnedColumns:{left:[b.f.field,w.Ux,"visitId","visitorName"],right:["actions"]}}),[]),ez=(0,v.useMemo)(()=>({loadingOverlay:G,noRowsOverlay:()=>(0,i.jsx)(W.H,{title:ej?"No visits found":"No visits available",description:ej?"No visits match the current filters. Try adjusting your filter criteria.":"There are no visits in the system yet."}),noResultsOverlay:()=>(0,i.jsx)(W.H,{title:"No results found",description:"No visits match your search criteria. Try different filters."})}),[ej]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(S.A,{sx:B,children:[(0,i.jsx)(q.S1,{filters:D,canReset:ej,totalRecords:ex||0,visitStatusOptions:R.c5,visitPurposeOptions:R.JT,visitOutlookOptions:R.KI,siteOptions:ec,siteLoading:es,onResetPage:eC}),(0,i.jsx)(I._,{rows:eb,columns:eD,loading:ev,label:"Available Visits",pagination:!0,paginationMode:"server",pageSizeOptions:M,paginationModel:{page:z,pageSize:Y},onPaginationModelChange:eg,rowCount:ex||0,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,columnVisibilityModel:J,onColumnVisibilityModelChange:ey,initialState:eN,getDetailPanelContent:eS,getDetailPanelHeight:ew,slots:ez,disableAggregation:!0,disablePivoting:!0,columnHeaderHeight:40,getRowHeight:()=>"auto",rowHeight:52,showToolbar:!0,scrollbarSize:30,sx:_})]}),(0,i.jsx)(E.u,{open:$,onClose:eA,onSave:ek,followUp:null,context:"visit",visitId:Q,currentVisit:{siteName:(null==ed||null==(x=ed.visit)||null==(m=x.site)?void 0:m.SiteName)||"Visit #".concat(Q),visitDate:null==ed||null==(g=ed.visit)?void 0:g.VisitDate}})]})}function Y(){return(0,i.jsxs)(u.KG,{maxWidth:"none",sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[(0,i.jsx)(m.g,{links:[{name:"Home",href:o.f.dashboard.root},{name:"Site Visits"}],sx:{mb:{xs:1,xl:2}}}),(0,i.jsx)(r.A,{mb:{xs:1,xl:2},children:(0,i.jsx)(a.default,{title:"Create new visit",arrow:!0,children:(0,i.jsx)(s.default,{component:d.W,href:o.f.dashboard.visit.new,variant:"contained",color:"inherit",size:"small",startIcon:(0,i.jsx)(c.W,{icon:"mingcute:add-line"}),children:"New"})})}),(0,i.jsx)(H,{}),(0,i.jsx)(n.N9,{containerId:"success",position:"top-right",autoClose:2e3}),(0,i.jsx)(n.N9,{containerId:"error",position:"top-right",autoClose:!1,closeOnClick:!0})]})}},41315:(e,t,l)=>{"use strict";l.r(t),l.d(t,{VisitDetailsView:()=>eb});var i=l(95155),n=l(38543),r=l(35695),a=l(49742),s=l(695),o=l(35046),d=l(83469),u=l(40054),c=l.n(u),m=l(30832),p=l.n(m),f=l(55594),h=l(62177),v=l(90221),x=l(12115),b=l(68074),g=l(21030),y=l(96801),j=l(68086),C=l(84256),S=l(66292),w=l(78822),I=l(53494),A=l(72635),k=l(85098),D=l(7971),N=l(38867),z=l(54961);let V=async function(e){let t,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{retries:i=3,delay:n=1e3,maxDelay:r=1e4,factor:a=2,onRetry:s=()=>{},shouldRetry:o=e=>{var t;if(!e.response)return!0;let l=null==(t=e.response)?void 0:t.status;return l>=500&&l<=599}}=l,d=n;for(let l=0;l<=i;l++)try{return await e()}catch(e){if(t=e,l===i||!o(e))throw e;s(l+1,e),await new Promise(e=>setTimeout(e,d)),d=Math.min(d*a,r)}throw t},T=(e,t)=>{var l,i,n;let r=null==e||null==(l=e.response)?void 0:l.status,a=null==e||null==(n=e.response)||null==(i=n.data)?void 0:i.message;if(a)return a;switch(r){case 400:return"Invalid data provided. Please check your inputs and try again.";case 401:return"Your session has expired. Please login again.";case 403:return"You do not have permission to perform this action.";case 404:return"The requested resource was not found. It may have been deleted.";case 409:return"This record has been modified by another user. Please refresh and try again.";case 422:return"The data provided is invalid. Please check all required fields.";case 429:return"Too many requests. Please wait a moment and try again.";case 500:return"Server error occurred. Please try again or contact support if the issue persists.";case 502:case 503:return"Service temporarily unavailable. Please try again in a few moments.";case 504:return"Request timeout. Please check your connection and try again.";default:return t||"An unexpected error occurred. Please try again."}},F=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"perform this action";return T(e,{update:"Failed to update visit data",create:"Failed to create visit",delete:"Failed to delete visit",fetch:"Failed to load visit data",visitor_update:"Failed to update visitor data",visitor_add:"Failed to add new visitors",visitor_remove:"Failed to remove visitor"}[t]||"Failed to ".concat(t))};var P=l(10822);let O=e=>e?P.A.sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]}):"",L=(e,t)=>{let l={...e};return t.forEach(e=>{l[e]&&"string"==typeof l[e]&&(l[e]=O(l[e]))}),l};var R=l(36339),W=l(52701),U=l(15843),E=l(85396),q=l(71023),M=l(84762),B=l(9670),_=l(83339),G=l(91580),H=l(20837),Y=l(40001),Z=l(80158),J=l(3951),K=l(92634),$=l(95946),X=l(29716),Q=l(62966),ee=l(12422),et=l(96358),el=l(88165),ei=l(28292),en=l(44482);let er={contactId:null,name:"",phoneNumber:null,selectedLead:null,bedrooms:null,sizeSqFt:"",viewType:null,direction:null,floorPreference:null,buyingIntent:"",infraUnitId:null,notes:""},ea=e=>e.map(e=>{var t;return{label:(null==(t=e.data)?void 0:t.LeadName)||"(Unnamed Lead)",value:e.data.LeadId}}),es=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==e||""===e)return null;let l=t?parseFloat(e):Number(e);return isNaN(l)?null:l},eo=e=>{var t,l,i,n,r,a;return{contactId:e.ContactId,name:(null==(t=e.contacts)?void 0:t.FullName)?null==(l=e.contacts)?void 0:l.FullName:"".concat((null==(i=e.contacts)?void 0:i.ContactFName)||""," ").concat((null==(n=e.contacts)?void 0:n.ContactLName)||"").trim()||"Unknown",phoneNumber:(null==(r=e.contacts)?void 0:r.ContactNo)||"No phone",selectedLead:e.LeadId?{value:e.LeadId,label:(null==(a=e.lead)?void 0:a.LeadName)||e.leadName||""}:null,bedrooms:e.Bedrooms||null,sizeSqFt:e.SizeSqFt||"",viewType:e.ViewType||null,direction:e.Direction||null,floorPreference:e.FloorPreference?String(e.FloorPreference):null,buyingIntent:e.BuyingIntent||"",infraUnitId:e.InfraUnitId||null,notes:e.Notes||""}},ed=(e,t)=>{var l;return{...e,Bedrooms:t.bedrooms,SizeSqFt:es(t.sizeSqFt,!0),ViewType:t.viewType,FloorPreference:es(t.floorPreference),BuyingIntent:es(t.buyingIntent),InfraUnitId:es(t.infraUnitId),Notes:t.notes||null,Direction:t.direction,LeadId:(null==(l=t.selectedLead)?void 0:l.value)||null}};function eu(e){var t,l,r,a;let{visitData:s,siteId:o,updateVisitor:d,setUpdateVisitor:u,originalVisitors:c,setOriginalVisitors:m,onSaveAll:p,isDirty:f=!1,editVisitor:h}=e,v=(0,R.Cg)(),[j,A]=(0,x.useState)(!1),[k,D]=(0,x.useState)(null),[z,V]=(0,x.useState)(er),[T,F]=(0,x.useState)(!1),[P,O]=(0,x.useState)(!1),[L,es]=(0,x.useState)(!1),[eu,ec]=(0,x.useState)(!1),[em,ep]=(0,x.useState)(""),[ef,eh]=(0,x.useState)(!1),[ev,ex]=(0,x.useState)(!1),[eb,eg]=(0,x.useState)(null),[ey,ej]=(0,x.useState)(!1),eC=(0,x.useRef)(d),eS=(0,x.useRef)(u);(0,x.useEffect)(()=>{eC.current=d,eS.current=u},[d,u]);let{searchedLeadsData:ew,searchedLeadsLoading:eI}=(0,el.Me)(null,(null==k?void 0:k.contactId)===void 0?null:null==k?void 0:k.contactId,null),eA=(0,x.useMemo)(()=>d&&0!==d.length?d.filter(e=>{var t,l;let i=null==(l=e.contacts)||null==(t=l.ContactType)?void 0:t.toLowerCase(),n="Yes"!==e.isDeleted;return"customer"===i&&"broker"!==i&&n}).map(eo):[],[d]),ek=(0,x.useMemo)(()=>(null==ew?void 0:ew.length)>0?ea(ew):[],[ew]);(0,x.useEffect)(()=>{var e,t;if(k&&(null==(e=z.selectedLead)?void 0:e.value)&&!(null==(t=z.selectedLead)?void 0:t.label)&&ek.length>0){let e=ek.find(e=>e.value===z.selectedLead.value);e&&V(t=>({...t,selectedLead:e}))}},[ek,k,null==(t=z.selectedLead)?void 0:t.value,null==(l=z.selectedLead)?void 0:l.label]);let eD=(0,x.useCallback)(e=>!!e&&d.some(t=>t.ContactId===e),[d]),eN=(0,x.useCallback)(e=>{var t,l;let i=null==e?void 0:e.id;if(i&&eD(i)){let e=eA.find(e=>e.contactId===i),t=(null==e?void 0:e.name)||"this contact";n.oR.dismiss(),n.oR.error('This contact is already added as "'.concat(t,'"'),{containerId:"error",autoClose:5e3});return}F(!0),u([...d,{VisitId:null!=(l=null==s||null==(t=s.visit)?void 0:t.VisitId)?l:null,ContactId:i,LeadId:null,InfraUnitId:null,Bedrooms:null,SizeSqFt:null,ViewType:null,FloorPreference:null,Direction:null,BuyingIntent:null,Notes:null,VisitorsId:null,FollowUpStatus:null,VisitType:null,PropertyType:null,VisitorFeedback:null,FollowUpDate:null,contacts:{ContactFName:null,ContactId:i,ContactLName:null,FullName:e.name,ContactType:"Customer",ContactNo:e.phoneNumber}}]),F(!1)},[eD,d,u,s,eA]),ez=async(e,t)=>{if(!h)throw Error("editVisitor function not provided");return h(e,{ContactId:t,IsDeleted:"Yes"})},eV=(0,x.useCallback)(()=>{k&&(eg(k),ex(!0))},[k]),eT=(0,x.useCallback)(async()=>{if(eb)try{ej(!0),ex(!1);let e=d.find(e=>e.ContactId===eb.contactId);if(null==e?void 0:e.VisitorsId){await ez(e.VisitorsId,e.ContactId);let t=d.map(e=>e.ContactId===eb.contactId?{...e,isDeleted:"Yes"}:e);if(u(t),m&&c){let e=c.map(e=>e.ContactId===eb.contactId?{...e,isDeleted:"Yes"}:e);m(e)}}else{let e=d.filter(e=>e.ContactId!==eb.contactId);u(e)}(null==k?void 0:k.contactId)===eb.contactId&&(D(null),V(er),eh(!1)),ep("".concat(eb.name," has been removed successfully")),ec(!0),setTimeout(()=>ec(!1),3e3)}catch(e){ep("Failed to remove ".concat(eb.name,". Please try again.")),ec(!0),setTimeout(()=>ec(!1),3e3)}finally{ej(!1),eg(null)}},[eb,k,d,u,h,c,m]),eF=(0,x.useCallback)(()=>{ex(!1),eg(null)},[]);(0,x.useCallback)(()=>{eh(!1)},[]);let eP=(0,x.useCallback)(e=>{if(ef&&k&&j&&(es(!0),setTimeout(()=>{es(!1)},500)),(null==k?void 0:k.contactId)===(null==e?void 0:e.contactId))D(null),V(er);else{var t;D(e);let l={...e};if((null==(t=e.selectedLead)?void 0:t.value)&&ek.length>0){let t=ek.find(t=>t.value===e.selectedLead.value);t&&(l.selectedLead=t)}V({...l})}eh(!1)},[k,ef,j,ek]),eO=(0,x.useCallback)(()=>{A(e=>!e)},[]);(0,x.useCallback)(()=>{k&&(eh(!1),ep("Visitor details updated successfully"),ec(!0),setTimeout(()=>ec(!1),3e3),D({...z,contactId:k.contactId}))},[k,z]),(0,x.useEffect)(()=>{if(k){let e=Object.keys(z).some(e=>z[e]!==k[e]);if(eh(e),e&&j){let e=setTimeout(()=>{let e=eC.current;(0,eS.current)(e.map(e=>e.ContactId===k.contactId?ed(e,z):e))},500);return()=>clearTimeout(e)}}},[z,k,j]);let eL=e=>{let{visitor:t,isSelected:l,onClick:n}=e;return(0,i.jsx)(C.A,{sx:{cursor:P?"not-allowed":"pointer",transition:"all 0.3s ease",minWidth:240,flexShrink:0,border:2,borderColor:l?"primary.main":"divider",bgcolor:l?"primary.50":"background.paper",opacity:P?.7:1,"&:hover":{boxShadow:4*!P,transform:P?"none":"translateY(-4px)",borderColor:P?l?"primary.main":"divider":l?"primary.main":"primary.light"}},onClick:()=>!P&&n(t),children:(0,i.jsx)(_.A,{sx:{p:2.5},children:(0,i.jsxs)(g.A,{spacing:1.5,children:[(0,i.jsxs)(y.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(W.A,{color:"primary",sx:{fontSize:20}}),(0,i.jsx)(B.default,{variant:"subtitle1",fontWeight:600,noWrap:!0,children:t.name})]}),(0,i.jsxs)(y.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(E.A,{color:"action",sx:{fontSize:18}}),(0,i.jsx)(B.default,{variant:"body2",color:"text.secondary",noWrap:!0,children:t.phoneNumber})]}),l&&(0,i.jsxs)(g.A,{direction:"row",spacing:.5,children:[(0,i.jsx)(G.default,{label:"Selected",size:"small",color:"primary"}),ef&&j&&(0,i.jsx)(G.default,{label:"Modified",size:"small",color:"warning",variant:"outlined"})]})]})})})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(H.A,{in:eu,children:(0,i.jsx)(Y.default,{severity:em.includes("Failed")?"error":"success",onClose:()=>ec(!1),sx:{mb:2},children:em})}),(0,i.jsxs)(y.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:2,py:1,borderBottom:"1px solid",borderColor:"divider"},children:[(0,i.jsxs)(g.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,i.jsx)(B.default,{variant:"h6",children:"Visitors Details"}),(0,i.jsx)(I.default,{onClick:eO,size:"small",disabled:P,children:(0,i.jsx)(w.default,{title:j?"Done Editing":"Edit",arrow:!0,children:(0,i.jsx)(N.W,{icon:j?"fa-solid:check":"solar:pen-bold"})})}),eA.length>0&&(0,i.jsx)(G.default,{label:"".concat(eA.length," visitor").concat(eA.length>1?"s":""),size:"small",variant:"outlined"})]}),(0,i.jsxs)(g.A,{direction:"row",spacing:1,children:[k&&(0,i.jsx)(b.default,{size:"medium",color:"error",variant:"outlined",onClick:eV,startIcon:(0,i.jsx)(q.A,{}),sx:{minWidth:120},disabled:!j||P||ey,loading:ey,children:ey?"Removing...":"Remove"}),(0,i.jsx)(b.default,{size:"medium",color:"primary",variant:"contained",onClick:v.onTrue,startIcon:(0,i.jsx)(U.A,{}),sx:{minWidth:120},disabled:!j||P,loading:T,children:"Add Visitor"})]})]}),(0,i.jsx)(y.A,{children:0===eA.length?(0,i.jsx)(()=>(0,i.jsxs)(M.default,{sx:{px:6,py:3,textAlign:"center",bgcolor:"grey.50",border:"2px dashed",borderColor:"grey.300",borderRadius:2},children:[(0,i.jsx)(W.A,{sx:{fontSize:64,color:"grey.400"}}),(0,i.jsx)(B.default,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No visitors added yet"}),(0,i.jsx)(B.default,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Start tracking your property visitors and potential clients"}),(0,i.jsx)(S.default,{color:"primary",variant:"contained",startIcon:(0,i.jsx)(U.A,{}),onClick:v.onTrue,disabled:!j,children:"Add First Visitor"})]}),{}):(0,i.jsx)(y.A,{sx:{display:"flex",gap:2,overflowX:"auto",p:1,"&::-webkit-scrollbar":{height:8},"&::-webkit-scrollbar-track":{backgroundColor:"grey.100",borderRadius:4},"&::-webkit-scrollbar-thumb":{backgroundColor:"grey.400",borderRadius:4,"&:hover":{backgroundColor:"grey.600"}}},children:eA.map(e=>(0,i.jsx)(eL,{visitor:e,isSelected:(null==k?void 0:k.contactId)===e.contactId,onClick:eP},e.contactId))})}),k&&(0,i.jsxs)(M.default,{sx:{p:3,elevation:2,mx:2},children:[(0,i.jsx)(y.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:(0,i.jsxs)(B.default,{variant:"h6",children:[(0,i.jsx)(W.A,{sx:{mr:1,verticalAlign:"middle"}}),k.name&&k.phoneNumber?"".concat(k.name," (").concat(k.phoneNumber,")"):"Visitor Details"]})}),(0,i.jsx)(Z.default,{sx:{mb:3}}),(0,i.jsxs)(J.Ay,{container:!0,spacing:3,children:[(0,i.jsx)(J.Ay,{item:!0,xs:12,sm:6,children:(0,i.jsx)(K.default,{size:"small",disabled:!j||P,options:ek,loading:eI,getOptionLabel:e=>{var t;return null!=(t=null==e?void 0:e.label)?t:""},getOptionKey:e=>{var t;return null!=(t=null==e?void 0:e.value)?t:""},isOptionEqualToValue:(e,t)=>(null==e?void 0:e.value)===(null==t?void 0:t.value),value:null!=(r=null==z?void 0:z.selectedLead)?r:null,onChange:(e,t)=>{V(e=>({...e,selectedLead:null!=t?t:null}))},renderInput:e=>{var t;return(0,i.jsx)($.default,{...e,label:"Select Lead",placeholder:"Choose a lead to associate...",helperText:"Leads for ".concat(null!=(t=null==k?void 0:k.name)?t:"selected customer"),variant:"outlined"})},noOptionsText:"No leads found for this customer",loadingText:"Loading leads..."})}),(0,i.jsx)(J.Ay,{item:!0,xs:12,children:(0,i.jsx)(en.h,{isEditing:j&&!P,visitor:k,siteId:o,detailsForm:z,setDetailsForm:V,showSuccessMessage:!1,onUnitSuggested:e=>{}})}),(0,i.jsx)(J.Ay,{item:!0,xs:12,children:(0,i.jsx)($.default,{disabled:!j||P,fullWidth:!0,multiline:!0,rows:3,label:"Additional Notes",value:null!=(a=z.notes)?a:"",onChange:e=>{V({...z,notes:e.target.value})},placeholder:"Add any additional notes about the visitor or their requirements...",helperText:P?"Saving changes...":j?"Add any relevant information about this visitor":""})}),(0,i.jsx)(J.Ay,{item:!0,xs:12,children:(0,i.jsx)(g.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:p&&(0,i.jsx)(w.default,{title:f?"Save all changes to database":"No changes to save",arrow:!0,children:(0,i.jsx)("span",{children:(0,i.jsx)(b.default,{variant:"contained",color:"success",size:"medium",loading:P,disabled:P||!f,onClick:async()=>{try{O(!0),await p(),ep("All changes have been saved successfully!"),ec(!0),setTimeout(()=>ec(!1),4e3)}catch(e){ep("Failed to save changes. Please try again."),ec(!0),setTimeout(()=>ec(!1),4e3)}finally{O(!1)}},sx:{minWidth:150},children:P?"Saving...":"Save All Changes"})})})})})]})]}),(0,i.jsx)(ei.Tt,{title:"Select Contact",type:"Customer",open:v.value,onClose:v.onFalse,selected:e=>{},onSelect:e=>{eN(e),v.onFalse()}}),(0,i.jsxs)(X.A,{open:ev,onClose:eF,"aria-labelledby":"remove-dialog-title","aria-describedby":"remove-dialog-description",maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(Q.A,{id:"remove-dialog-title",children:(0,i.jsxs)(y.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(q.A,{color:"error"}),(0,i.jsx)(B.default,{variant:"h6",children:"Remove Visitor"})]})}),(0,i.jsx)(ee.A,{children:(0,i.jsxs)(y.A,{id:"remove-dialog-description",children:[(0,i.jsxs)(B.default,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",(0,i.jsx)("strong",{children:null==eb?void 0:eb.name})," from this visit?"]}),(0,i.jsx)(Y.default,{severity:"warning",sx:{mt:2},children:"This action cannot be undone. The visitor and all their associated data will be permanently removed from this visit."})]})}),(0,i.jsxs)(et.default,{sx:{p:2.5},children:[(0,i.jsx)(S.default,{onClick:eF,color:"inherit",variant:"outlined",disabled:ey,children:"Cancel"}),(0,i.jsx)(b.default,{onClick:eT,color:"error",variant:"contained",loading:ey,loadingPosition:"start",startIcon:(0,i.jsx)(q.A,{}),children:ey?"Removing...":"Remove Visitor"})]})]})]})}var ec=l(32030),em=l(74368),ep=l(86288);let ef=f.z.object({visitType:f.z.string().min(1,{message:"Visit Type is required"}),visitStatus:f.z.string().min(1,{message:"Visit Status is required"}),visitDate:f.z.string().min(1,{message:"Visit Date is required"}),followUpDate:f.z.string().nullable().optional(),followUpStatus:f.z.string().nullable().optional(),purpose:f.z.string().nullable().optional(),visitorFeedback:f.z.string().nullable().optional(),notes:f.z.string().nullable().optional(),visitOutlook:f.z.string().nullable().optional(),buyingIntent:f.z.number().nullable().optional(),propertyType:f.z.string().nullable().optional(),bedrooms:f.z.union([f.z.string(),f.z.number()]).nullable().optional(),sizeSqFt:f.z.union([f.z.string(),f.z.number()]).nullable().optional(),viewType:f.z.string().nullable().optional(),floorPreference:f.z.number().nullable().optional(),contactDetails:z.yf.nullableInput(f.z.object({id:f.z.number(),name:f.z.string(),phoneNumber:f.z.number()}),{message:"Contact Details is required!"}),brokerDetails:f.z.object({id:f.z.number(),name:f.z.string(),phoneNumber:f.z.number()}).nullable().optional(),siteDetails:f.z.object({id:f.z.number(),name:f.z.string(),fullAddress:f.z.string()}).nullable().optional()});function eh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l={ContactId:e.ContactId,LeadId:e.LeadId||null,InfraUnitId:e.InfraUnitId||null,Bedrooms:e.Bedrooms||null,SizeSqFt:e.SizeSqFt||null,ViewType:e.ViewType||null,FloorPreference:e.FloorPreference||null,Direction:e.Direction||null,BuyingIntent:e.BuyingIntent||null,Notes:e.Notes||null};return t&&(l.VisitId=t),l}function ev(e){var t,l;let{visitId:r}=e,{visitVisitorData:a,visitVisitorLoading:s,visitVisitorError:o,refetchVisitVisitor:d}=(0,D.oh)(r),[u,m]=(0,x.useState)(!1),[f,b]=(0,x.useState)({}),[w,I]=(0,x.useState)({}),[A,z]=(0,x.useState)([]),[T,P]=(0,x.useState)([]),[O,R]=(0,x.useState)(!1),[W,U]=(0,x.useState)(!1),E=(0,x.useRef)(!1);(0,x.useEffect)(()=>{if(!s&&!o&&a){var e,t;let l=null!=(e=a.visit)?e:{},i=null!=(t=a.visitors)?t:[];b(l),I(l),z(i),P(i)}},[a,s,o]);let q=(0,x.useCallback)(async(e,t)=>{try{return await V(()=>(0,k.xL)(e,t),{retries:2,onRetry:e=>{n.oR.info("Retrying save... (Attempt ".concat(e,"/2)"),{containerId:"success"})}}),!0}catch(e){throw n.oR.error(F(e,"update"),{containerId:"error"}),e}},[]),M=(0,x.useCallback)(async(e,t)=>{try{return await (0,D._z)(e,t),!0}catch(t){var l,i;let e=(null==(i=t.response)||null==(l=i.data)?void 0:l.message)||"Failed to update visitor data!";throw n.oR.error(e,{containerId:"error"}),t}},[]),B=(0,x.useCallback)(async()=>{var e,t,l;let i=(function(e,t){let l=new Set(t.map(e=>e.ContactId));return e.filter(e=>{let t=!l.has(e.ContactId),i=null===e.VisitorsId;return t&&i})})(A,T).filter(e=>"Yes"!==e.isDeleted);if(0===i.length)return!0;let a=i.map(eh),s={visit_request:{SiteId:null==f?void 0:f.SiteId,InfraId:null!=(e=null==f?void 0:f.InfraId)?e:null,SalesPersonId:null!=(t=null==f?void 0:f.SalesPersonId)?t:0,VisitStatus:(null==f?void 0:f.VisitStatus)||"Scheduled",Purpose:(null==f?void 0:f.Purpose)||null,VisitDate:null!=(l=f.VisitDate)?l:p()().format()},visitors_request:{VisitId:r,Visitors:a}};try{return await (0,D.nT)(s),!0}catch(t){let e=F(t,"visitor_add");throw n.oR.error(e,{containerId:"error"}),t}},[f,A,T,r]),_=(0,x.useMemo)(()=>{var e,t,l,i,n,r,a,s;return{visitType:f.VisitType,visitStatus:f.VisitStatus,visitDate:f.VisitDate,followUpDate:f.FollowUpDate,followUpStatus:f.FollowUpStatus,purpose:f.Purpose,visitorFeedback:f.VisitorFeedback,notes:f.Notes,visitOutlook:f.VisitOutlook,buyingIntent:f.BuyingIntent,propertyType:f.PropertyType,bedrooms:f.Bedrooms,sizeSqFt:f.SizeSqFt,viewType:f.ViewType,floorPreference:f.FloorPreference,contactDetails:f.ContactId&&f.contact?{id:f.ContactId,name:"".concat(null==(e=f.contact)?void 0:e.ContactFName," ").concat(null==(t=f.contact)?void 0:t.ContactLName),phoneNumber:null==(l=f.contact)?void 0:l.ContactNo}:{},brokerDetails:f.BrokerId&&f.broker?{id:f.BrokerId,name:"".concat(null==(i=f.broker)?void 0:i.ContactFName," ").concat(null==(n=f.broker)?void 0:n.ContactLName),phoneNumber:null==(r=f.broker)?void 0:r.ContactNo}:{},siteDetails:f.SiteId&&f.site?{id:f.SiteId,name:null==(a=f.site)?void 0:a.SiteName,fullAddress:null==(s=f.site)?void 0:s.SiteAddress}:{}}},[f]),{reset:G}=(0,h.mN)({mode:"all",resolver:(0,v.u)(ef),defaultValues:_});(0,x.useEffect)(()=>{G(_)},[_,G]);let H=(0,x.useCallback)(async()=>{if(E.current)return void n.oR.warning("Save operation already in progress",{containerId:"error"});E.current=!0;try{m(!0);let e=L(f,["Purpose","VisitOutlook"]),t={VisitStatus:e.VisitStatus,Purpose:e.Purpose,VisitDate:e.VisitDate,VisitOutlook:e.VisitOutlook,SiteId:e.SiteId,InfraId:e.InfraId||null,SalesPersonId:e.SalesPersonId||0};await q(r,t);let l=A.map(async e=>{if("Yes"===e.isDeleted)return null;let t=T.find(t=>t.ContactId===e.ContactId);if(null==t?void 0:t.VisitorsId){let l=eh(e,r);return M(t.VisitorsId,l)}return null}).filter(Boolean);await Promise.all(l),await B(),n.oR.success("All changes saved successfully!",{containerId:"success"}),U(!1),await d()}catch(e){n.oR.error("Failed to save some changes. Please try again.",{containerId:"error"})}finally{m(!1),E.current=!1}},[f,A,T,q,M,B,d,r]),Y=(0,x.useMemo)(()=>!c().isEqual(f,w)||!c().isEqual(A,T),[f,w,A,T]);(0,x.useEffect)(()=>{U(Y)},[Y]),(0,x.useEffect)(()=>{let e=e=>{if(W)return e.preventDefault(),e.returnValue="You have unsaved changes, are you sure you want to leave?","You have unsaved changes, are you sure you want to leave?"};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[W]);let Z=(0,x.useCallback)(()=>{R(!0),b(w),z(T),U(!1),n.oR.info("Changes have been reset",{containerId:"success"})},[w,T]);return s?(0,i.jsxs)(g.A,{spacing:2,children:[(0,i.jsxs)(y.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,i.jsx)(j.A,{variant:"rounded",width:100,height:36}),(0,i.jsxs)(y.A,{sx:{display:"flex",gap:1},children:[(0,i.jsx)(j.A,{variant:"rounded",width:80,height:36}),(0,i.jsx)(j.A,{variant:"rounded",width:80,height:36})]})]}),(0,i.jsxs)(C.A,{sx:{p:3},children:[(0,i.jsx)(j.A,{variant:"text",width:"30%",height:32,sx:{mb:2}}),(0,i.jsxs)(g.A,{spacing:2,children:[(0,i.jsx)(j.A,{variant:"rounded",width:"100%",height:56}),(0,i.jsxs)(y.A,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:2},children:[(0,i.jsx)(j.A,{variant:"rounded",height:56}),(0,i.jsx)(j.A,{variant:"rounded",height:56})]})]})]}),(0,i.jsx)(C.A,{sx:{p:3},children:(0,i.jsxs)(y.A,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2},children:[(0,i.jsx)(j.A,{variant:"rounded",height:56}),(0,i.jsx)(j.A,{variant:"rounded",height:56}),(0,i.jsx)(j.A,{variant:"rounded",height:56})]})}),(0,i.jsxs)(C.A,{sx:{p:3},children:[(0,i.jsx)(j.A,{variant:"text",width:"20%",height:32,sx:{mb:2}}),(0,i.jsx)(g.A,{spacing:2,children:[1,2].map(e=>(0,i.jsx)(j.A,{variant:"rounded",width:"100%",height:80},e))})]})]}):o?(0,i.jsx)(y.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:(0,i.jsx)(C.A,{sx:{p:3},children:(0,i.jsxs)(y.A,{sx:{textAlign:"center"},children:[(0,i.jsx)(N.W,{icon:"solar:danger-triangle-bold",sx:{width:48,height:48,color:"error.main",mb:2}}),(0,i.jsx)(y.A,{sx:{typography:"h6",mb:1},children:"Failed to load visit details"}),(0,i.jsx)(y.A,{sx:{typography:"body2",color:"text.secondary",mb:2},children:o.message||"An error occurred while loading the visit data"}),(0,i.jsx)(S.default,{variant:"contained",onClick:d,children:"Retry"})]})})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(g.A,{spacing:1,sx:{mb:1},children:[(0,i.jsx)(ex,{loading:u,saveAll:H,resetAll:Z,isDirty:W}),(0,i.jsx)(em.g,{currentVisit:f,setCurrentVisit:b}),(0,i.jsx)(C.A,{children:(0,i.jsx)(ep.P,{currentVisit:f,broker:null!=(l=null==(t=A.find(e=>{var t,l;return(null==e||null==(l=e.contacts)||null==(t=l.ContactType)?void 0:t.toLowerCase())==="broker"}))?void 0:t.contacts)?l:{},setCurrentVisit:b,isReset:O,setIsReset:R,currentVisitors:A,setCurrentVisitors:z})}),(0,i.jsx)(eu,{visitData:a,siteId:null==f?void 0:f.SiteId,updateVisitor:A,setUpdateVisitor:z,originalVisitors:T,setOriginalVisitors:P,onSaveAll:H,isDirty:W,editVisitor:M})]}),(0,i.jsx)(ec.A,{isDirty:W})]})}function ex(e){let{saveAll:t,resetAll:l,isDirty:n,loading:r}=e;return(0,i.jsxs)(y.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",md:"repeat(2, 1fr)"}},children:[(0,i.jsxs)(y.A,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[(0,i.jsx)(w.default,{title:"Create new visit",arrow:!0,children:(0,i.jsx)(b.default,{size:"small",color:"inherit",variant:"contained",component:A.W,href:a.f.dashboard.visit.new,startIcon:(0,i.jsx)(N.W,{icon:"mingcute:add-line"}),sx:{pr:1.5,mr:1.5},"aria-label":"Create new visit",children:"New"})}),(0,i.jsx)(w.default,{title:"View Visit List",arrow:!0,children:(0,i.jsx)(I.default,{component:A.W,href:a.f.dashboard.visit.root,"aria-label":"View visit list",children:(0,i.jsx)(N.W,{icon:"material-symbols:view-list",sx:{width:30,height:30}})})})]}),n&&(0,i.jsxs)(y.A,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:[(0,i.jsx)(w.default,{title:"Reset changes",arrow:!0,children:(0,i.jsx)(S.default,{onClick:l,color:"inherit",variant:"outlined",size:"small",sx:{mr:1.5},disabled:r,"aria-label":"Reset all changes",children:"Reset"})}),(0,i.jsx)(w.default,{title:"Save changes",arrow:!0,children:(0,i.jsx)(b.default,{onClick:t,type:"submit",size:"small",variant:"contained",loading:r,"aria-label":"Save all changes",children:"Save"})})]})]})}function eb(){let e=(0,s.g)(),t=(0,s.rd)(),l=(0,r.useSearchParams)(),u=(null==e?void 0:e.visitId)||l.get("id"),c=Number(u);return!u||isNaN(c)||!Number.isSafeInteger(c)||c<=0?(t.replace("/404"),null):(0,i.jsxs)(o.KG,{children:[(0,i.jsx)(d.g,{links:[{name:"Home",href:a.f.dashboard.root},{name:"Visit",href:a.f.dashboard.visit.root},{name:"Visit Details"}],sx:{mb:{xs:1,md:1}}}),(0,i.jsx)(ev,{visitId:u}),(0,i.jsx)(n.N9,{containerId:"success",position:"top-right",autoClose:2e3}),(0,i.jsx)(n.N9,{containerId:"error",position:"top-right",autoClose:!1,closeOnClick:!0})]})}},44482:(e,t,l)=>{"use strict";l.d(t,{h:()=>I});var i=l(95155),n=l(12115),r=l(96801),a=l(20837),s=l(40001),o=l(84256),d=l(9670),u=l(80158),c=l(92634),m=l(95946),p=l(66292),f=l(15876),h=l(84762),v=l(25949),x=l(72137),b=l(60032),g=l(72330),y=l(57236),j=l(62516),C=l(56117),S=l(74234),w=l(56626);function I(e){let{visitor:t,siteId:l,detailsForm:I,setDetailsForm:A,isEditing:k,showSuccessMessage:D=!1,onUnitSuggested:N}=e,[z,V]=(0,n.useState)([]),[T,F]=(0,n.useState)({}),[P,O]=(0,n.useState)(!1),[L,R]=(0,n.useState)(""),[W,U]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(t&&!W){var e,l,i,n,r,a,s;let o={floorPreference:(null==t?void 0:t.floorPreference)?String(t.floorPreference):null,viewType:null!=(e=null==t?void 0:t.viewType)?e:null,direction:null!=(l=null==t?void 0:t.direction)?l:null,bedrooms:null!=(i=null==t?void 0:t.bedrooms)?i:null,sizeSqFt:null!=(n=null==t?void 0:t.sizeSqFt)?n:"",infraUnitId:null!=(r=null==t?void 0:t.infraUnitId)?r:null,buyingIntent:null!=(a=null==t?void 0:t.buyingIntent)?a:"",notes:null!=(s=null==t?void 0:t.notes)?s:"",initialized:!0};A(e=>({...e,...o})),U(!0)}},[t,W,A]),(0,n.useEffect)(()=>{U(!1)},[null==t?void 0:t.contactId]);let E=(0,n.useMemo)(()=>{let{floorPreference:e,direction:t,viewType:i,bedrooms:n}=I;return null!==e||null!==t||null!==i||null!==n?l:null},[I,l]),{infraUnitSearchData:q,infraUnitSearchLoading:M,infraUnitSearchError:B,hasValidParams:_,refetchInfraUnit:G}=(0,C.AK)(E,I.floorPreference?Number(I.floorPreference):null,I.direction,I.bedrooms,I.viewType);(0,n.useEffect)(()=>{!M&&(null==q?void 0:q.length)>0?V(q.map(e=>{var t,l,i,n,r,a,s;return{id:e.InfraUnitId,floor_number:null!=(t=e.FloorNumber)?t:"-",unit_number:null!=(l=e.UnitNumber)?l:"-",unit_size:null!=(i=e.UnitSize)?i:"-",availability_status:null!=(n=e.AvailabilityStatus)?n:"-",direction:null!=(r=e.Direction)?r:"-",unit_type:null!=(a=e.UnitType)?a:"-",view:null!=(s=e.View)?s:"-"}})):M||V([])},[q,M]);let H=(0,n.useMemo)(()=>{var e,t,l;return[{label:"Floor Preference",name:"floorPreference",options:(null==(e=S.NS[0])?void 0:e.classify)||[]},{label:"Direction Preference",name:"direction",options:(null==(t=S.Ac[0])?void 0:t.classify)||[]},{label:"Bedrooms",name:"bedrooms",options:S.Tm.flatMap(e=>e.classify)||[]},{label:"View Preference",name:"viewType",options:(null==(l=S.GZ[0])?void 0:l.classify)||[]}]},[]),Y=(0,n.useCallback)((e,t)=>{let l=I.infraUnitId===e,i=l?null:e;if(A(e=>({...e,infraUnitId:i})),!l){let l=t||"Unit ".concat(e);R("Unit ".concat(l," has been suggested successfully")),O(!0),setTimeout(()=>O(!1),3e3)}N&&N(i)},[I.infraUnitId,A,N]),Z=(0,n.useCallback)((e,t)=>{A(l=>({...l,[e]:t})),F(t=>({...t,[e]:null}))},[A]),J=(0,n.useCallback)(e=>t=>{let l=t.target.value,i=null;if("buyingIntent"===e){if(l&&!/^\d*$/.test(l)){i="Only numbers allowed";return}l&&(1>Number(l)||Number(l)>10)&&(i="Value must be between 1 and 10")}if("sizeSqFt"===e){if(l&&!/^\d*\.?\d*$/.test(l)){i="Only numbers and decimal allowed";return}l&&Number(l)>99999&&(i="Value seems too large")}F(t=>({...t,[e]:i})),i||Z(e,l)},[Z]),K=(0,n.useCallback)(()=>{G&&G()},[G]);return(0,i.jsxs)(r.A,{children:[(0,i.jsx)(a.A,{in:P,children:(0,i.jsx)(s.default,{severity:"success",onClose:()=>O(!1),sx:{mb:2},children:L})}),(0,i.jsxs)(r.A,{sx:{columnGap:1,rowGap:1,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:[(0,i.jsxs)(o.A,{children:[(0,i.jsx)(d.default,{variant:"h6",sx:{pl:2.5,pr:2.5,pt:1,pb:1},children:"Requirements"}),(0,i.jsx)(u.default,{}),(0,i.jsxs)(r.A,{sx:{p:1.5,columnGap:1,rowGap:1,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:[H.map(e=>{let{label:t,name:l,options:n}=e;return(0,i.jsx)(c.default,{value:I[l]||null,options:n,autoHighlight:!0,disabled:!k||M,renderInput:e=>(0,i.jsx)(m.default,{...e,label:t,"aria-label":t,error:!!T[l],helperText:T[l]}),onChange:(e,t)=>{Z(l,t)},renderOption:(e,t)=>{let{key:l,...n}=e;return(0,i.jsx)(r.A,{component:"li",...n,children:t},l)}},l)}),(0,i.jsx)(m.default,{label:"Size Square Feet",value:I.sizeSqFt||"",disabled:!k,onChange:J("sizeSqFt"),placeholder:"Enter size in sq ft","aria-label":"Size Square Feet",error:!!T.sizeSqFt,helperText:T.sizeSqFt||"Numbers only (e.g., 1500.5)",inputProps:{inputMode:"decimal",pattern:"[0-9]*\\.?[0-9]*"}}),(0,i.jsx)(m.default,{label:"Buying Intent",value:I.buyingIntent||"",disabled:!k,onChange:J("buyingIntent"),placeholder:"Enter buying intent (1-10)","aria-label":"Buying Intent",error:!!T.buyingIntent,helperText:T.buyingIntent||"Scale of 1-10 (10 being highest)",inputProps:{inputMode:"numeric",pattern:"[0-9]*",maxLength:2}})]})]}),(0,i.jsxs)(o.A,{children:[(0,i.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pl:2.5,pr:2.5,pt:1,pb:1},children:[(0,i.jsx)(d.default,{variant:"h6",children:"Options & Suggestions"}),B&&(0,i.jsx)(p.default,{size:"small",onClick:K,variant:"text",children:"Retry"})]}),(0,i.jsx)(r.A,{sx:{position:"relative"},children:(0,i.jsx)(w.Z,{children:(0,i.jsx)(f.A,{component:h.default,sx:{maxHeight:250},children:(0,i.jsxs)(v.A,{size:"small",stickyHeader:!0,"aria-label":"Options and suggestions table",children:[(0,i.jsx)(x.A,{children:(0,i.jsx)(b.default,{children:["Action","Floor No.","Unit No.","Unit Size","Availability","Direction","Unit Type","View"].map(e=>(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap",backgroundColor:"#f5f5f5",fontWeight:600},children:e},e))})}),(0,i.jsx)(y.A,{children:_?M?(0,i.jsx)(b.default,{children:(0,i.jsxs)(g.default,{colSpan:8,align:"center",children:[(0,i.jsx)(j.default,{size:40}),(0,i.jsx)(d.default,{variant:"caption",display:"block",sx:{mt:1},children:"Searching for matching units..."})]})}):B?(0,i.jsx)(b.default,{children:(0,i.jsx)(g.default,{colSpan:8,align:"center",children:(0,i.jsxs)(s.default,{severity:"error",sx:{m:1},children:["Error loading units: ",B]})})}):z.length>0?z.map(e=>{let{id:t,floor_number:l,unit_number:n,unit_size:r,availability_status:a,direction:s,unit_type:o,view:d}=e;return(0,i.jsxs)(b.default,{hover:!0,selected:t===I.infraUnitId,children:[(0,i.jsx)(g.default,{children:(0,i.jsx)(p.default,{variant:t===I.infraUnitId?"contained":"outlined",size:"small",disabled:!k,onClick:()=>Y(t,n),color:t===I.infraUnitId?"success":"primary",sx:{minWidth:"auto",padding:"4px 12px",fontSize:"0.75rem"},"aria-label":"".concat(t===I.infraUnitId?"Suggested":"Suggest"," unit ").concat(n),children:t===I.infraUnitId?"Selected":"Select"})}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:l}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:n}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:r}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:a}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:s}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:o}),(0,i.jsx)(g.default,{style:{whiteSpace:"nowrap"},children:d})]},t)}):(0,i.jsx)(b.default,{children:(0,i.jsx)(g.default,{colSpan:8,align:"center",children:(0,i.jsx)(d.default,{variant:"body2",color:"text.secondary",children:"No matching units found. Try adjusting your requirements."})})}):(0,i.jsx)(b.default,{children:(0,i.jsx)(g.default,{colSpan:8,align:"center",children:(0,i.jsx)(d.default,{variant:"body2",color:"text.secondary",children:"Select at least one requirement to see suggestions"})})})})]})})})})]})]})]})}},52701:(e,t,l)=>{"use strict";l.d(t,{A:()=>r});var i=l(76856),n=l(95155);let r=(0,i.A)((0,n.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person")},71023:(e,t,l)=>{"use strict";l.d(t,{A:()=>r});var i=l(76856),n=l(95155);let r=(0,i.A)((0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},74368:(e,t,l)=>{"use strict";l.d(t,{g:()=>z});var i=l(95155),n=l(30832),r=l.n(n),a=l(12115),s=l(95092),o=l(26403),d=l(2360),u=l(95946),c=l(20837),m=l(40001),p=l(62516),f=l(84256),h=l(80918),v=l(96801),x=l(9670),b=l(53494),g=l(78822),y=l(58417),j=l(38867);let C=e=>e?r()(e).format("DD/MM/YYYY HH:mm"):"NA",S=e=>({label:e,value:e}),w=["Scheduled","Rescheduled","Completed","Cancelled"].map(S),I=["Property Viewing","Property Valuation","Market Analysis","Listing Consultation","Buyer Consultation","Property Inspection","Comparative Market Analysis","Investment Analysis","Rental Assessment","Final Walkthrough","Key Handover","Document Signing","Site Measurement","Photography/Marketing","Open House Preparation","Neighborhood Tour","Follow-up Visit","Client Meeting","Other"].map(S),A=["Positive","Neutral","Negative"].map(S),k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NA";return null!=e?e:t},D=(e,t)=>{var l;return(null==(l=e.find(e=>e.value.toLowerCase()===(null==t?void 0:t.toLowerCase())))?void 0:l.label)||"NA"},N=["Created Date","Updated Date","Created By"];function z(e){let{currentVisit:t,setCurrentVisit:l}=e,[n,S]=(0,a.useState)(!1),[z,V]=(0,a.useState)(!1),[T,F]=(0,a.useState)(!1),[P,O]=(0,a.useState)(""),[L,R]=(0,a.useState)("success"),[W,U]=(0,a.useState)(!1),E=(0,a.useMemo)(()=>r()().startOf("day"),[]),q=(0,a.useRef)(null),M=(0,a.useRef)(t),B=(0,a.useMemo)(()=>{var e,l;return{"Visit Status":null==t?void 0:t.VisitStatus,"Visit Purpose":null==t?void 0:t.Purpose,"Visit Date":null==t?void 0:t.VisitDate,"Visit Outlook":null==t?void 0:t.VisitOutlook,"Created Date":C(null==t?void 0:t.CreatedDate),"Updated Date":C(null==t?void 0:t.UpdatedDate),"Created By":"".concat((null==t||null==(e=t.created_by)?void 0:e.FirstName)||""," ").concat((null==t||null==(l=t.created_by)?void 0:l.LastName)||"").trim()||"NA"}},[t]),[_,G]=(0,a.useState)({...B});(0,a.useEffect)(()=>{n||(G({...B}),M.current=t)},[B,n,t]),(0,a.useEffect)(()=>{U(Object.keys(_).some(e=>!N.includes(e)&&_[e]!==B[e]))},[_,B]);let H=(0,a.useCallback)((e,t)=>"Visit Status"!==e||t?"Visit Purpose"!==e||t?"Visit Date"!==e||t?null:"Visit Date is required":"Visit Purpose is required":"Visit Status is required",[]),Y=(0,a.useCallback)(()=>{let e=[];return Object.entries(_).forEach(t=>{let[l,i]=t;if(!N.includes(l)){let t=H(l,i);t&&e.push(t)}}),e},[_,H]),Z=(0,a.useCallback)(async()=>{let e=Y();if(e.length>0){O(e[0]),R("error"),F(!0),setTimeout(()=>F(!1),3e3);return}V(!0),q.current&&clearTimeout(q.current);try{await new Promise(e=>setTimeout(e,500)),O("Visit details updated successfully"),R("success"),F(!0),S(!1),U(!1),q.current=setTimeout(()=>{F(!1)},3e3)}catch(e){O("Failed to save changes. Please try again."),R("error"),F(!0),q.current=setTimeout(()=>{F(!1)},5e3)}finally{V(!1)}},[Y]),J=(0,a.useCallback)(()=>{n?W?Z():S(!1):(G({...B}),S(!0))},[n,W,Z,B]),K=(0,a.useCallback)((e,t)=>{if(G(l=>({...l,[e]:t})),n){let i={"Visit Status":"VisitStatus","Visit Purpose":"Purpose","Visit Date":"VisitDate","Visit Outlook":"VisitOutlook"};i[e]&&l(l=>({...l,[i[e]]:t}))}},[n,l]),$=(e,t)=>{let l=N.includes(e)||z;return"Visit Status"===e?(0,i.jsx)(o.A,{value:t||"",onChange:t=>K(e,t.target.value),size:"small",sx:{flex:1,minWidth:150},disabled:l,error:!t&&n,children:w.map(e=>(0,i.jsx)(d.default,{value:e.value,children:e.label},e.value))}):"Visit Purpose"===e?(0,i.jsx)(o.A,{value:t||"",onChange:t=>K(e,t.target.value),size:"small",sx:{flex:1,minWidth:150},disabled:l,error:!t&&n,children:I.map(e=>(0,i.jsx)(d.default,{value:e.value,children:e.label},e.value))}):"Visit Outlook"===e?(0,i.jsxs)(o.A,{value:t||"",onChange:t=>K(e,t.target.value),size:"small",sx:{flex:1,minWidth:150},disabled:l,children:[(0,i.jsx)(d.default,{value:"",children:(0,i.jsx)("em",{children:"None"})}),A.map(e=>(0,i.jsx)(d.default,{value:e.value,children:e.label},e.value))]}):"Visit Date"===e?(0,i.jsx)(y.$J,{children:(0,i.jsx)(s.K,{value:t?r()(t):null,minDate:E,maxDate:E.add(1,"year"),shouldDisableDate:e=>e.isBefore(E,"day"),onChange:t=>{t&&K(e,t.format())},disabled:l,slotProps:{textField:{size:"small",error:!t&&n,helperText:!t&&n?"Required":"",sx:{flex:1,minWidth:160}}}})}):(0,i.jsx)(u.default,{value:t||"",onChange:t=>K(e,t.target.value),size:"small",sx:{flex:1,minWidth:160},disabled:l})},X=(e,t)=>"Visit Status"===e?D(w,t):"Visit Purpose"===e?D(I,t):"Visit Outlook"===e?D(A,t):"Visit Date"===e?C(t)||"NA":k(t);return(0,a.useEffect)(()=>()=>{q.current&&clearTimeout(q.current)},[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.A,{in:T,children:(0,i.jsx)(m.default,{severity:L,onClose:()=>F(!1),sx:{mb:2},icon:z?(0,i.jsx)(p.default,{size:20}):void 0,children:P})}),(0,i.jsxs)(f.A,{sx:{p:2,position:"relative"},children:[(0,i.jsx)(h.A,{container:!0,spacing:1.5,sx:{display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(3, 1fr)"},rowGap:1.5,mr:5,opacity:z?.7:1,transition:"opacity 0.3s"},children:Object.entries(n?_:B).map(e=>{let[t,l]=e;return(0,i.jsx)(h.A,{children:(0,i.jsxs)(v.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(x.default,{variant:"subtitle1",sx:{minWidth:110,fontWeight:500},children:t}),(0,i.jsx)(x.default,{children:":"}),n?$(t,l):(0,i.jsx)(x.default,{variant:"body1",sx:{flex:1},children:X(t,l)})]})},t)})}),(0,i.jsx)(v.A,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:(0,i.jsx)(b.default,{onClick:J,disabled:z,size:"small",sx:{"&:hover":{transform:"scale(1.1)"}},children:(0,i.jsx)(g.default,{title:z?"Saving...":n?W?"Save changes":"Exit edit mode":"Edit",arrow:!0,children:z?(0,i.jsx)(p.default,{size:20}):(0,i.jsx)(j.W,{icon:n?"fa-solid:check":"solar:pen-bold"})})})}),n&&W&&!z&&(0,i.jsxs)(v.A,{sx:{position:"absolute",bottom:8,right:8,display:"flex",alignItems:"center",gap:.5},children:[(0,i.jsx)(j.W,{icon:"mdi:content-save-alert",sx:{color:"warning.main",fontSize:16}}),(0,i.jsx)(x.default,{variant:"caption",sx:{color:"warning.main",fontStyle:"italic"},children:"Unsaved changes"})]})]})]})}},74378:(e,t,l)=>{"use strict";l.d(t,{_:()=>o});var i=l(19169),n=l(12115),r=l(18835);let a=async e=>{let[t,l]=Array.isArray(e)?e:[e];try{return(await r.Ay.get(t,{...l})).data}catch(e){if("string"==typeof e&&(e.includes("No infrastructure found")||e.includes("not found")))return[];throw console.error("Failed to fetch (".concat(t,"):"),e),e}},s={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function o(e){let t=e?[r.vZ.siteInfra.searchBySiteId(e)]:"",{data:l,isLoading:o,error:d,isValidating:u,mutate:c}=(0,i.Ay)(t,a,s),m=d&&"string"==typeof d&&(d.includes("No infrastructure found")||d.includes("not found"));return(0,n.useMemo)(()=>({infrasData:m||!l?[]:l,infrasLoading:o,infrasError:m?null:d?(null==d?void 0:d.message)||"Error fetching (useGetDetailedLead)":null,infrasValidating:u,infrasEmpty:!o&&!u&&(!Array.isArray(l)||0===l.length||m),refetch:()=>c()}),[l,d,o,u,c,m])}},83392:(e,t,l)=>{"use strict";l.d(t,{Ty:()=>el,S1:()=>b,$t:()=>H,O1:()=>q}),l(25404),l(44482);var i=l(95155),n=l(96801),r=l(30832),a=l.n(r),s=l(12115),o=l(32987),d=l(92634),u=l(95946),c=l(91580),m=l(58417),p=l(83919);function f(e){let{filters:t,options:l,onResetPage:r}=e,{state:f,setState:h}=t,[v,x]=(0,s.useState)(f.site||[]),[b,g]=(0,s.useState)(f.visitStatus||[]),[y,j]=(0,s.useState)(f.purpose||[]),[C,S]=(0,s.useState)(f.visitOutlook||[]),[w,I]=(0,s.useState)(f.startDate),[A,k]=(0,s.useState)(f.endDate),[D,N]=(0,s.useState)(f.broker||null),[z,V]=(0,s.useState)(f.customer||null);(0,s.useEffect)(()=>{x(f.site||[])},[f.site]),(0,s.useEffect)(()=>{g(f.visitStatus||[])},[f.visitStatus]),(0,s.useEffect)(()=>{j(f.purpose||[])},[f.purpose]),(0,s.useEffect)(()=>{S(f.visitOutlook||[])},[f.visitOutlook]),(0,s.useEffect)(()=>{I(f.startDate)},[f.startDate]),(0,s.useEffect)(()=>{k(f.endDate)},[f.endDate]),(0,s.useEffect)(()=>{var e;N((null==(e=f.broker)?void 0:e[0])||null)},[f.broker]),(0,s.useEffect)(()=>{var e;V((null==(e=f.customer)?void 0:e[0])||null)},[f.customer]);let T=(0,s.useCallback)((e,t)=>{x(t),r(),h({site:t.map(e=>e.value)})},[r,h]),F=(0,s.useCallback)((e,t)=>{g(t),r(),h({visitStatus:t.map(e=>e.value)})},[r,h]),P=(0,s.useCallback)((e,t)=>{j(t),r(),h({purpose:t.map(e=>e.value)})},[r,h]),O=(0,s.useCallback)((e,t)=>{S(t),r(),h({visitOutlook:t.map(e=>e.value)})},[r,h]),L=(0,s.useCallback)(e=>{let t=e?e.format("YYYY-MM-DD"):null;I(t),r(),h({startDate:t})},[r,h]),R=(0,s.useCallback)(e=>{let t=e?e.format("YYYY-MM-DD"):null;k(t),r(),h({endDate:t})},[r,h]),W=(0,s.useCallback)(e=>{N(e),r(),h({broker:e?[e]:[]})},[r,h]),U=(0,s.useCallback)(e=>{V(e),r(),h({customer:e?[e]:[]})},[r,h]),E=v.map(e=>{var t;return null==(t=l.site)?void 0:t.find(t=>t.value===e)}).filter(Boolean),q=b.map(e=>{var t;return null==(t=l.visitStatus)?void 0:t.find(t=>t.value===e)}).filter(Boolean),M=y.map(e=>{var t;return null==(t=l.visitPurpose)?void 0:t.find(t=>t.value===e)}).filter(Boolean),B=C.map(e=>{var t;return null==(t=l.visitOutlook)?void 0:t.find(t=>t.value===e)}).filter(Boolean);return(0,i.jsxs)(n.A,{sx:{width:"100%",gap:{xs:2,sm:1},p:1,display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)",lg:"repeat(auto-fit, minmax(200px, 1fr))"}},children:[(0,i.jsx)(d.default,{multiple:!0,size:"small",value:E,options:l.site||[],onChange:T,getOptionLabel:e=>e.label,isOptionEqualToValue:(e,t)=>e.value===t.value,renderInput:e=>(0,i.jsx)(u.default,{...e,label:"Sites",placeholder:"Select sites..."}),renderOption:(e,t)=>{let{key:l,...r}=e;return(0,i.jsx)(n.A,{component:"li",...r,children:t.label},t.value)},renderTags:(e,t)=>e.map((e,l)=>{let{key:n,...r}=t({index:l});return(0,i.jsx)(c.default,{size:"small",label:e.label,...r},n)}),loading:l.siteLoading}),(0,i.jsx)(d.default,{multiple:!0,size:"small",value:q,options:l.visitStatus||[],onChange:F,getOptionLabel:e=>e.label,isOptionEqualToValue:(e,t)=>e.value===t.value,renderInput:e=>(0,i.jsx)(u.default,{...e,label:"Visit Status",placeholder:"Select statuses..."}),renderOption:(e,t)=>{let{key:l,...r}=e;return(0,i.jsx)(n.A,{component:"li",...r,children:t.label},t.value)},renderTags:(e,t)=>e.map((e,l)=>{let{key:n,...r}=t({index:l});return(0,i.jsx)(c.default,{size:"small",label:e.label,...r},n)})}),(0,i.jsx)(d.default,{multiple:!0,size:"small",value:M,options:l.visitPurpose||[],onChange:P,getOptionLabel:e=>e.label,isOptionEqualToValue:(e,t)=>e.value===t.value,renderInput:e=>(0,i.jsx)(u.default,{...e,label:"Purpose",placeholder:"Select purposes..."}),renderOption:(e,t)=>{let{key:l,...r}=e;return(0,i.jsx)(n.A,{component:"li",...r,children:t.label},t.value)},renderTags:(e,t)=>e.map((e,l)=>{let{key:n,...r}=t({index:l});return(0,i.jsx)(c.default,{size:"small",label:e.label,...r},n)})}),(0,i.jsx)(d.default,{multiple:!0,size:"small",value:B,options:l.visitOutlook||[],onChange:O,getOptionLabel:e=>e.label,isOptionEqualToValue:(e,t)=>e.value===t.value,renderInput:e=>(0,i.jsx)(u.default,{...e,label:"Visit Outlook",placeholder:"Select outlooks..."}),renderOption:(e,t)=>{let{key:l,...r}=e;return(0,i.jsx)(n.A,{component:"li",...r,children:t.label},t.value)},renderTags:(e,t)=>e.map((e,l)=>{let{key:n,...r}=t({index:l});return(0,i.jsx)(c.default,{size:"small",label:e.label,...r},n)})}),(0,i.jsx)(m.$J,{children:(0,i.jsx)(o.l,{label:"Visit Date From",value:w?a()(w):null,onChange:L,format:"DD-MM-YYYY",maxDate:A?a()(A):void 0,slotProps:{textField:{size:"small",fullWidth:!0,placeholder:"Filter by visit date",helperText:A&&w&&a()(w).isAfter(a()(A))?"From date must be before or equal to To date":"",error:A&&w&&a()(w).isAfter(a()(A))}}})}),(0,i.jsx)(m.$J,{children:(0,i.jsx)(o.l,{label:"Visit Date To",value:A?a()(A):null,onChange:R,format:"DD-MM-YYYY",minDate:w?a()(w):void 0,slotProps:{textField:{size:"small",fullWidth:!0,placeholder:"Filter by visit date",helperText:w&&A&&a()(A).isBefore(a()(w))?"To date must be after or equal to From date":"",error:w&&A&&a()(A).isBefore(a()(w))}}})}),(0,i.jsx)(p.u,{handleFilterContact:W,contactType:"Broker",defaultValue:D,size:"small"}),(0,i.jsx)(p.u,{handleFilterContact:U,contactType:"Customer",defaultValue:z,size:"small"})]})}var h=l(52717),v=l(98294);function x(e){var t,l,n,r,a,o,d,u,m,p;let{filters:f,onResetPage:x,totalResults:b,options:g,sx:y}=e,{state:j,setState:C}=f,S=(0,s.useCallback)(e=>{let t=j.site.filter(t=>t!==e);x(),C({site:t})},[j.site,x,C]),w=(0,s.useCallback)(()=>{x(),C({site:[]})},[x,C]),I=(0,s.useCallback)(e=>{let t=j.visitStatus.filter(t=>t!==e);x(),C({visitStatus:t})},[j.visitStatus,x,C]),A=(0,s.useCallback)(()=>{x(),C({visitStatus:[]})},[x,C]),k=(0,s.useCallback)(e=>{let t=j.purpose.filter(t=>t!==e);x(),C({purpose:t})},[j.purpose,x,C]),D=(0,s.useCallback)(()=>{x(),C({purpose:[]})},[x,C]),N=(0,s.useCallback)(e=>{let t=j.visitOutlook.filter(t=>t!==e);x(),C({visitOutlook:t})},[j.visitOutlook,x,C]),z=(0,s.useCallback)(()=>{x(),C({visitOutlook:[]})},[x,C]),V=(0,s.useCallback)(()=>{x(),C({startDate:null})},[x,C]),T=(0,s.useCallback)(()=>{x(),C({endDate:null})},[x,C]),F=(0,s.useCallback)(()=>{x(),C({broker:[]})},[x,C]),P=(0,s.useCallback)(()=>{x(),C({customer:[]})},[x,C]),O=(0,s.useCallback)(()=>{x(),C({site:[],visitStatus:[],purpose:[],visitOutlook:[],startDate:null,endDate:null,broker:[],customer:[]})},[x,C]),L=(e,t)=>{let l=(g[e]||[]).find(e=>e.value===t);return l?l.label:String(t)};return(0,i.jsxs)(v.T7,{totalResults:b,onReset:O,sx:y,children:[(0,i.jsxs)(v.Hv,{label:"Sites:",isShow:(null==(t=j.site)?void 0:t.length)>0,children:[j.site.map(e=>(0,s.createElement)(c.default,{...v.NJ,key:e,label:L("site",e),onDelete:()=>S(e)})),(null==(l=j.site)?void 0:l.length)>1&&(0,i.jsx)(c.default,{...v.NJ,label:"Clear All Sites",onDelete:w,color:"error",variant:"outlined"})]}),(0,i.jsxs)(v.Hv,{label:"Visit Status:",isShow:(null==(n=j.visitStatus)?void 0:n.length)>0,children:[j.visitStatus.map(e=>(0,s.createElement)(c.default,{...v.NJ,key:e,label:(0,h.Z)(e),onDelete:()=>I(e)})),(null==(r=j.visitStatus)?void 0:r.length)>1&&(0,i.jsx)(c.default,{...v.NJ,label:"Clear All Statuses",onDelete:A,color:"error",variant:"outlined"})]}),(0,i.jsxs)(v.Hv,{label:"Purpose:",isShow:(null==(a=j.purpose)?void 0:a.length)>0,children:[j.purpose.map(e=>(0,s.createElement)(c.default,{...v.NJ,key:e,label:e,onDelete:()=>k(e)})),(null==(o=j.purpose)?void 0:o.length)>1&&(0,i.jsx)(c.default,{...v.NJ,label:"Clear All Purposes",onDelete:D,color:"error",variant:"outlined"})]}),(0,i.jsxs)(v.Hv,{label:"Visit Outlook:",isShow:(null==(d=j.visitOutlook)?void 0:d.length)>0,children:[j.visitOutlook.map(e=>(0,s.createElement)(c.default,{...v.NJ,key:e,label:(0,h.Z)(e),onDelete:()=>N(e)})),(null==(u=j.visitOutlook)?void 0:u.length)>1&&(0,i.jsx)(c.default,{...v.NJ,label:"Clear All Outlooks",onDelete:z,color:"error",variant:"outlined"})]}),(0,i.jsx)(v.Hv,{label:"Visit Date From:",isShow:!!j.startDate,children:(0,i.jsx)(c.default,{...v.NJ,label:j.startDate,onDelete:V})}),(0,i.jsx)(v.Hv,{label:"Visit Date To:",isShow:!!j.endDate,children:(0,i.jsx)(c.default,{...v.NJ,label:j.endDate,onDelete:T})}),(0,i.jsx)(v.Hv,{label:"Broker:",isShow:(null==(m=j.broker)?void 0:m.length)>0,children:j.broker.map(e=>(0,s.createElement)(c.default,{...v.NJ,key:e.value,label:e.label,onDelete:F}))}),(0,i.jsx)(v.Hv,{label:"Customer:",isShow:(null==(p=j.customer)?void 0:p.length)>0,children:j.customer.map(e=>(0,s.createElement)(c.default,{...v.NJ,key:e.value,label:e.label,onDelete:P}))})]})}function b(e){let{filters:t,canReset:l,totalRecords:r,visitStatusOptions:a,visitPurposeOptions:s,visitOutlookOptions:o,siteOptions:d,siteLoading:u,onResetPage:c}=e;return(0,i.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",p:1},children:[(0,i.jsx)(f,{onResetPage:c,filters:t,options:{visitStatus:a,visitPurpose:s,visitOutlook:o,site:d,siteLoading:u}}),l&&(0,i.jsx)(x,{onResetPage:c,filters:t,totalResults:r,options:{visitStatus:a,visitPurpose:s,visitOutlook:o,site:d},sx:{p:2.5,pt:0}})]})}var g=l(26096),y=l(11743),j=l(7433),C=l(17764),S=l(9670),w=l(78822),I=l(53494),A=l(66292),k=l(40001),D=l(4007),N=l(49742),z=l(72635),V=l(7971),T=l(38867),F=l(20991),P=l(69004);let O={border:"none",["& .".concat(g.x.main)]:{border:"none"},["& .".concat(g.x.cell)]:{display:"flex",alignItems:"center",padding:"4px 8px",fontSize:"0.875rem",borderRight:"1px solid",borderColor:"divider"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"grey.50",minHeight:"36px !important",maxHeight:"36px !important",borderTop:"1px solid",borderColor:"divider"},"& .MuiDataGrid-columnHeader":{padding:"4px 8px",fontSize:"0.8rem",fontWeight:600,borderColor:"divider"},"& .MuiDataGrid-row":{minHeight:"36px !important",maxHeight:"36px !important",borderColor:"divider","&:hover":{backgroundColor:"action.hover"}},"& .MuiDataGrid-footerContainer":{display:"none"}},L=e=>{if(!e||"-"===e)return"-";let t=String(e);return 10===t.length?"+91 ".concat(t.substring(0,5)," ").concat(t.substring(5)):t},R=e=>e&&0!==e&&"-"!==e?"".concat(Number(e).toLocaleString()," sq ft"):"N/A",W=e=>{if("-"===e||null===e)return"text.secondary";let t=Number(e);return t>=8?"success.main":t>=4?"warning.main":"error.main"},U=()=>(0,i.jsx)(j.A,{}),E=()=>(0,i.jsx)(P.H,{title:"No visitors found",description:"Visitors added to this visit will appear here",sx:{py:3}});function q(e){let{visitId:t}=e,[l,r]=(0,s.useState)({}),{visitVisitorData:a,visitVisitorLoading:o,visitVisitorError:d,visitVisitorEmpty:u,refetchVisitVisitor:c}=(0,V.oh)(t),m=(0,s.useMemo)(()=>{let e=(null==a?void 0:a.visitors)||[];return e.length?e.map(e=>{var t,l;return{id:e.VisitorsId,visitorsId:e.VisitorsId,visitId:e.VisitId,contactId:e.ContactId,contactName:e.contacts?"".concat(e.contacts.ContactFName||""," ").concat(e.contacts.ContactLName||"").trim():"N/A",contactNumber:(null==(t=e.contacts)?void 0:t.ContactNo)||"N/A",contactType:(null==(l=e.contacts)?void 0:l.ContactType)||"N/A",leadId:e.LeadId,leadName:e.LeadId?"Lead #".concat(e.LeadId):"N/A",bedrooms:e.Bedrooms||"N/A",sizeSqFt:e.SizeSqFt,viewType:e.ViewType||"N/A",floorPreference:null!==e.FloorPreference?e.FloorPreference:"N/A",direction:e.Direction||"N/A",buyingIntent:null!==e.BuyingIntent?e.BuyingIntent:null,notes:e.Notes||"N/A"}}):[]},[a]),p=(0,s.useMemo)(()=>Math.min(Math.max(100+36*m.length,200),500),[m.length]),f=(0,s.useMemo)(()=>[{field:"contactName",headerName:"Contact Name",minWidth:150,flex:1,renderCell:e=>{let t="Broker"===e.row.contactType?(0,i.jsx)(T.W,{icon:"mdi:briefcase-account",width:14,sx:{mr:.5,color:"primary.main"}}):(0,i.jsx)(T.W,{icon:"mdi:account",width:14,sx:{mr:.5,color:"text.secondary"}});return(0,i.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[t,e.row.contactId?(0,i.jsx)(C.A,{component:z.W,href:N.f.dashboard.contact.profile(e.row.contactId),underline:"hover",sx:{fontSize:"0.875rem"},children:e.value}):(0,i.jsx)(S.default,{variant:"body2",color:"text.secondary",children:e.value})]})}},{field:"contactNumber",headerName:"Contact No.",minWidth:140,flex:.9,renderCell:e=>(0,i.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,i.jsx)(S.default,{variant:"body2",children:L(e.value)}),"N/A"!==e.value&&(0,i.jsx)(w.default,{title:"Copy number",children:(0,i.jsx)(I.default,{size:"small",onClick:()=>navigator.clipboard.writeText(e.value),sx:{p:.25},children:(0,i.jsx)(T.W,{icon:"eva:copy-outline",width:14})})})]})},{field:"contactType",headerName:"Type",minWidth:100,flex:.6,renderCell:e=>(0,i.jsx)(F.Sb,{params:e})},{field:"leadName",headerName:"Lead",minWidth:130,flex:.9,renderCell:e=>e.row.leadId?(0,i.jsx)(C.A,{component:z.W,href:N.f.dashboard.lead.profile(e.row.leadId),underline:"hover",sx:{fontSize:"0.875rem"},children:e.value}):(0,i.jsx)(S.default,{variant:"body2",color:"text.secondary",children:e.value})},{field:"bedrooms",headerName:"Bedrooms",minWidth:100,flex:.6,renderCell:e=>(0,i.jsx)(F.Sb,{params:e})},{field:"sizeSqFt",headerName:"Size",minWidth:120,flex:.8,renderCell:e=>(0,i.jsx)(S.default,{variant:"body2",color:"text.primary",children:R(e.value)})},{field:"viewType",headerName:"View",minWidth:100,flex:.6,renderCell:e=>(0,i.jsx)(F.Sb,{params:e})},{field:"floorPreference",headerName:"Floor",minWidth:80,flex:.5,renderCell:e=>(0,i.jsx)(F.Sb,{params:e})},{field:"direction",headerName:"Direction",minWidth:100,flex:.6,renderCell:e=>(0,i.jsx)(F.Sb,{params:e})},{field:"buyingIntent",headerName:"Intent",minWidth:80,flex:.6,renderCell:e=>(0,i.jsx)(n.A,{sx:{fontWeight:null!==e.value?600:400,color:W(e.value)},children:null!==e.value?"".concat(e.value,"/10"):"N/A"})},{field:"notes",headerName:"Notes",minWidth:150,flex:1.2,renderCell:e=>(0,i.jsx)(w.default,{title:"N/A"!==e.value?e.value:"",arrow:!0,children:(0,i.jsx)(n.A,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"100%"},children:(0,i.jsx)(F.Sb,{params:e})})})}],[]),h=(0,s.useCallback)(e=>{r(e)},[]),v=(0,s.useMemo)(()=>({loadingOverlay:U,noRowsOverlay:E}),[]);if(d){let{message:e,statusCode:t,isRetryable:l,isAuthError:r,isNotFound:a,isForbidden:s,isClientError:o,isServerError:u,isNetworkError:m}=d,p="Error Loading Visitors",f=e,h="error",v="solar:danger-triangle-bold",x=null;return r?s?(p="Access Denied",f="You don't have permission to view visitors for this visit.",h="warning",v="solar:shield-warning-bold"):(p="Session Expired",f="Your session has expired. Please login again to continue.",h="warning",v="solar:shield-keyhole-bold",x=(0,i.jsx)(A.default,{variant:"contained",color:"warning",size:"small",startIcon:(0,i.jsx)(T.W,{icon:"solar:login-3-bold"}),onClick:()=>window.location.href="/auth/jwt/sign-in",children:"Login Again"})):a?(p="Visit Not Found",f="This visit no longer exists or has been deleted.",h="info",v="solar:file-remove-bold"):m?(p="Connection Error",f="Unable to connect to the server. Please check your internet connection.",h="error",v="solar:wi-fi-router-bold",x=(0,i.jsx)(A.default,{variant:"contained",color:"primary",size:"small",startIcon:(0,i.jsx)(T.W,{icon:"solar:refresh-bold"}),onClick:()=>c(),children:"Retry"})):u?(p="Server Error",f="The server encountered an error. Please try again or contact support if the issue persists.",h="error",v="solar:server-bold",x=(0,i.jsx)(A.default,{variant:"outlined",color:"error",size:"small",startIcon:(0,i.jsx)(T.W,{icon:"solar:refresh-bold"}),onClick:()=>c(),children:"Try Again"})):o?(p="Invalid Request",f=e||"The request could not be processed. Please try again.",h="warning",v="solar:document-text-bold"):l?(p="Temporary Error",f="Unable to load visitor data. Please try again.",h="warning",v="solar:refresh-circle-bold",x=(0,i.jsx)(A.default,{variant:"contained",color:"warning",size:"small",startIcon:(0,i.jsx)(T.W,{icon:"solar:refresh-bold"}),onClick:()=>c(),children:"Retry"})):(p="Unexpected Error",f=e||"An unexpected error occurred. Please try again later.",h="error",v="solar:danger-bold",x=(0,i.jsx)(A.default,{variant:"outlined",color:"primary",size:"small",startIcon:(0,i.jsx)(T.W,{icon:"solar:refresh-bold"}),onClick:()=>c(),children:"Try Again"})),(0,i.jsx)(n.A,{sx:{width:"95%",mx:"auto",my:2},children:(0,i.jsxs)(k.default,{severity:h,action:x,icon:(0,i.jsx)(T.W,{icon:v,width:24}),sx:{"& .MuiAlert-message":{width:"100%"}},children:[(0,i.jsx)(D.A,{sx:{fontWeight:600},children:p}),(0,i.jsx)(S.default,{variant:"body2",sx:{mb:.5*!!t},children:f}),t&&(0,i.jsxs)(S.default,{variant:"caption",display:"block",sx:{mt:.5,opacity:.7,fontFamily:"monospace",fontSize:"0.7rem"},children:["Error Code: ",t]})]})})}let x=m.length;return(0,i.jsxs)(n.A,{sx:{width:"95%",mx:"auto",my:1.5,height:p,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider",overflow:"hidden",transition:"height 0.3s ease-in-out"},children:[(0,i.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1,borderBottom:"1px solid",borderColor:"divider",bgcolor:"grey.50"},children:[(0,i.jsxs)(S.default,{variant:"subtitle2",sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(T.W,{icon:"mdi:account-group",width:18}),"Visitors",(0,i.jsx)(n.A,{component:"span",sx:{ml:.5,px:1,py:.25,bgcolor:"primary.lighter",color:"primary.dark",borderRadius:.75,fontSize:"0.75rem",fontWeight:600},children:x})]}),(0,i.jsx)(w.default,{title:"Refresh visitor data",children:(0,i.jsx)(I.default,{size:"small",onClick:()=>c(),disabled:o,children:(0,i.jsx)(T.W,{icon:"mdi:refresh",width:18})})})]}),(0,i.jsx)(y._,{rows:m,columns:f,loading:o,density:"compact",hideFooter:!0,disableRowSelectionOnClick:!0,disableColumnMenu:!1,columnVisibilityModel:l,onColumnVisibilityModelChange:h,slots:v,sx:O})]})}l(74368),l(86288);var M=l(62177),B=l(95092);let _=[{label:"Scheduled",value:"Scheduled"},{label:"Rescheduled",value:"Rescheduled"},{label:"Completed",value:"Completed"},{label:"Cancelled",value:"Cancelled"}],G=["Property Viewing","Property Valuation","Market Analysis","Listing Consultation","Buyer Consultation","Property Inspection","Comparative Market Analysis","Investment Analysis","Rental Assessment","Final Walkthrough","Key Handover","Document Signing","Site Measurement","Photography/Marketing","Open House Preparation","Neighborhood Tour","Follow-up Visit","Client Meeting","Other"].map(e=>({label:e,value:e}));function H(){let[e,t]=(0,s.useState)({label:"Scheduled",value:"Scheduled"}),[l,r]=(0,s.useState)(null),[o,c]=(0,s.useState)(a()()),{watch:p,setValue:f,formState:{errors:h}}=(0,M.xW)();p();let v=(0,s.useMemo)(()=>a()().startOf("day"),[]);return(0,i.jsxs)(n.A,{sx:{m:2,columnGap:1,rowGap:2,display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr 1fr"}},children:[(0,i.jsx)(d.default,{options:_,getOptionLabel:e=>e.label,isOptionEqualToValue:(e,t)=>e.value===(null==t?void 0:t.value),value:e,onChange:(e,l)=>{f("visitStatus",(null==l?void 0:l.value)||null),t(l)},renderInput:e=>{var t;return(0,i.jsx)(u.default,{...e,label:"Select Status *",variant:"outlined",error:!!h.visitStatus,helperText:null==(t=h.visitStatus)?void 0:t.message})}}),(0,i.jsx)(d.default,{options:G,getOptionLabel:e=>e.label,isOptionEqualToValue:(e,t)=>e.value===(null==t?void 0:t.value),value:l,onChange:(e,t)=>{f("purpose",(null==t?void 0:t.value)||null),r(t)},renderInput:e=>{var t;return(0,i.jsx)(u.default,{...e,label:"Select Visit Purpose *",variant:"outlined",error:!!h.purpose,helperText:null==(t=h.purpose)?void 0:t.message})}}),(0,i.jsx)(m.$J,{children:(0,i.jsx)(B.K,{label:"Select Date & Time *",value:o,minDate:v,maxDate:v.add(1,"year"),shouldDisableDate:e=>e.isBefore(v,"day"),onChange:e=>{c(e),f("visitDate",e.format())},renderInput:e=>{var t;return(0,i.jsx)(u.default,{...e,error:!!h.visitDate,helperText:null==(t=h.visitDate)?void 0:t.message})}})})]})}var Y=l(36339),Z=l(21030),J=l(80158),K=l(73746),$=l(42861),X=l(71984),Q=l(74378),ee=l(28292),et=l(95383);function el(){var e,t,l;let[r,a]=(0,s.useState)([]),[o,d]=(0,s.useState)([]),{sitesData:u,sitesLoading:c,sitesError:m}=(0,X.MZ)();(0,s.useEffect)(()=>{!c&&u.length?a(u.map(e=>({id:e.SiteId,name:e.SiteName||"N/A",fullAddress:e.SiteAddress||"N/A"}))):a([])},[u,c]);let{watch:p,setValue:f,formState:{errors:h}}=(0,M.xW)(),v=p(),x=(0,K.default)(),b=(0,$.A)(x.breakpoints.up("md")),{siteDetails:g,infraDetails:y,brokerDetails:j}=v,{infrasData:C,infrasLoading:k,infrasError:D}=(0,Q._)(null==g?void 0:g.id);(0,s.useEffect)(()=>{!k&&C.length?d(C.map(e=>({id:e.InfraId,name:e.InfraName||"N/A",fullAddress:e.InfraCategory||"N/A"}))):d([])},[C,k]);let N=(0,Y.Cg)(),z=(0,Y.Cg)(),V=(0,Y.Cg)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(Z.A,{divider:(0,i.jsx)(J.default,{flexItem:!0,orientation:b?"vertical":"horizontal",sx:{borderStyle:"dashed",borderWidth:"2px"}}),sx:{px:3,py:2,gap:{xs:3,md:5},flexDirection:{xs:"column",md:"row"}},children:[(0,i.jsxs)(Z.A,{sx:{width:1},children:[(0,i.jsxs)(n.A,{sx:{mb:1,display:"flex",alignItems:"center"},children:[(0,i.jsxs)(S.default,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:["Site Details: ",(0,i.jsx)("span",{style:{color:"red"},children:"*"})]}),(0,i.jsx)(w.default,{title:"Change Site",arrow:!0,children:(0,i.jsx)(I.default,{onClick:N.onTrue,children:(0,i.jsx)(T.W,{icon:"mingcute:add-line"})})})]}),!g&&(0,i.jsx)(S.default,{typography:"caption",sx:{color:"error.main"},children:null==(e=h.siteDetails)?void 0:e.message}),(null==g?void 0:g.id)?(0,i.jsxs)(Z.A,{spacing:1,children:[(0,i.jsxs)(S.default,{variant:"subtitle2",children:["Name: ",g.name]}),(0,i.jsxs)(S.default,{variant:"body2",children:["Address: ",g.fullAddress||"N/A"]})]}):(0,i.jsx)(S.default,{variant:"subtitle1",children:"No Site Selected"})]}),(0,i.jsxs)(Z.A,{sx:{width:1},children:[(0,i.jsxs)(n.A,{sx:{mb:1,display:"flex",alignItems:"center"},children:[(0,i.jsx)(S.default,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:"Infra Details:"}),(0,i.jsx)(w.default,{title:"Change Infrastructure",arrow:!0,children:(0,i.jsx)(I.default,{onClick:z.onTrue,children:(0,i.jsx)(T.W,{icon:"mingcute:add-line"})})})]}),!y&&(0,i.jsx)(S.default,{typography:"caption",sx:{color:"error.main"},children:null==(t=h.infraDetails)?void 0:t.message}),(null==y?void 0:y.id)?(0,i.jsxs)(Z.A,{spacing:1,children:[(0,i.jsxs)(S.default,{variant:"subtitle2",children:["Name: ",y.name]}),(0,i.jsxs)(S.default,{variant:"body2",children:["Address: ",y.fullAddress||"N/A"]})]}):(0,i.jsx)(S.default,{variant:"subtitle1",children:"No Infra Selected"})]}),(0,i.jsxs)(Z.A,{sx:{width:1},children:[(0,i.jsxs)(n.A,{sx:{mb:1,display:"flex",alignItems:"center"},children:[(0,i.jsx)(S.default,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:"Broker Details:"}),(0,i.jsx)(w.default,{title:"Change Broker",arrow:!0,children:(0,i.jsx)(I.default,{onClick:V.onTrue,children:(0,i.jsx)(T.W,{icon:"mingcute:add-line"})})})]}),!j&&(0,i.jsx)(S.default,{typography:"caption",sx:{color:"error.main"},children:null==(l=h.brokerDetails)?void 0:l.message}),(null==j?void 0:j.id)?(0,i.jsxs)(Z.A,{spacing:1,children:[(0,i.jsxs)(S.default,{variant:"subtitle2",children:["Name: ",j.name]}),(0,i.jsxs)(S.default,{variant:"body2",children:["Phone No.: ",j.phoneNumber||"N/A"]})]}):(0,i.jsx)(S.default,{variant:"subtitle1",children:"No Broker Assigned"})]})]}),(0,i.jsx)(et.ND,{title:"Sites List",open:N.value,onClose:N.onFalse,selected:e=>{var t;return(null==(t=v.siteDetails)?void 0:t.id)===e},onSelect:e=>f("siteDetails",e),list:r}),(0,i.jsx)(et.ND,{title:"Infrastructure List",open:z.value,onClose:z.onFalse,selected:e=>{var t;return(null==(t=v.infraDetails)?void 0:t.id)===e},onSelect:e=>f("infraDetails",e),list:o}),(0,i.jsx)(ee.Tt,{title:"Brokers List",type:"Broker",open:V.value,onClose:V.onFalse,selected:e=>{var t;return(null==(t=v.brokerDetails)?void 0:t.id)===e},onSelect:e=>f("brokerDetails",e),action:(0,i.jsx)(A.default,{size:"small",startIcon:(0,i.jsx)(T.W,{icon:"mingcute:add-line"}),sx:{alignSelf:"flex-end"},children:"New"})})]})}},85396:(e,t,l)=>{"use strict";l.d(t,{A:()=>r});var i=l(76856),n=l(95155);let r=(0,i.A)((0,n.jsx)("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02z"}),"Phone")},85822:(e,t,l)=>{"use strict";l.r(t),l.d(t,{NewVisitView:()=>K});var i=l(95155),n=l(38543),r=l(96801),a=l(78822),s=l(53494),o=l(49742),d=l(72635),u=l(35046),c=l(38867),m=l(83469),p=l(30832),f=l.n(p),h=l(55594),v=l(62177),x=l(36339),b=l(35695),g=l(12115),y=l(90221),j=l(68074),C=l(21030),S=l(68086),w=l(84256),I=l(695),A=l(7971),k=l(77308),D=l(88165),N=l(54961),z=l(52701),V=l(15843),T=l(85396),F=l(71023),P=l(84762),O=l(9670),L=l(66292),R=l(83339),W=l(91580),U=l(80158),E=l(3951),q=l(92634),M=l(95946),B=l(28292),_=l(25404);let G=e=>e.map(e=>{var t;return{label:(null==(t=e.data)?void 0:t.LeadName)||"(Unnamed Lead)",value:e.data.LeadId}});function H(e){var t;let{siteId:l,onVisitorsChange:a,initialVisitor:s=null,leadId:o=null}=e,d=(0,x.Cg)(),[u,c]=(0,g.useState)(()=>s?[s]:[]),[m,p]=(0,g.useState)(null),[f,h]=(0,g.useState)(!1),[v,b]=(0,g.useState)(""),{searchedLeadsData:y,searchedLeadsLoading:S,refetchSearchedLeads:I}=(0,D.Me)(null,(null==m?void 0:m.contactId)===void 0?null:null==m?void 0:m.contactId,null),[A,k]=(0,g.useState)([]),[N,H]=(0,g.useState)({contactId:null,name:"",phoneNumber:null,selectedLead:null,bedrooms:"",sizeSqFt:"",viewType:"",floorPreference:"",direction:"",buyingIntent:"",infraUnitId:"",notes:""});(0,g.useEffect)(()=>{s&&1===u.length&&u[0]===s&&(p(s),H(s),a([s]))},[s]),(0,g.useEffect)(()=>{(null==y?void 0:y.length)>0?k(G(y)):k([])},[y]),(0,g.useEffect)(()=>{if(!m||!N.contactId)return;let e=setTimeout(()=>{let e=u.map(e=>e.contactId===m.contactId?{...N,contactId:m.contactId}:e);c(e),null==a||a(e),p({...N,contactId:m.contactId})},500);return()=>clearTimeout(e)},[N,m,a,u]);let Y=e=>!!e&&u.some(t=>t.contactId===e),Z=e=>{let t=null==e?void 0:e.id;if(b(""),t&&Y(t)){let e=u.find(e=>e.contactId===t),l="".concat(e.name).toLowerCase();b('This contact is already added as "'.concat(l)),n.oR.dismiss(),n.oR.error('This contact is already added as "'.concat(l),{containerId:"error",autoClose:5e3});return}h(!0);let l=[...u,{contactId:t,name:e.name,phoneNumber:e.phoneNumber,selectedLead:null,floorPreference:null,bedrooms:null,sizeSqFt:null,viewType:null,direction:null,infraUnitId:null,buyingIntent:null,notes:""}];c(l),null==a||a(l),b(""),h(!1)},J=e=>{p(e),H({...e})},K=(0,g.memo)(e=>{let{visitor:t,isSelected:l,onClick:n}=e;return(0,i.jsx)(w.A,{sx:{cursor:"pointer",transition:"all 0.3s ease",minWidth:240,flexShrink:0,border:2,borderColor:l?"primary.main":"divider",bgcolor:l?"primary.50":"background.paper","&:hover":{boxShadow:4,transform:"translateY(-4px)",borderColor:l?"primary.main":"primary.light"}},onClick:()=>n(t),children:(0,i.jsx)(R.A,{sx:{p:2.5},children:(0,i.jsxs)(C.A,{spacing:1.5,children:[(0,i.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(z.A,{color:"primary",sx:{fontSize:20}}),(0,i.jsx)(O.default,{variant:"subtitle1",fontWeight:600,noWrap:!0,children:t.name})]}),(0,i.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(T.A,{color:"action",sx:{fontSize:18}}),(0,i.jsx)(O.default,{variant:"body2",color:"text.secondary",noWrap:!0,children:t.phoneNumber})]}),l&&(0,i.jsx)(W.default,{label:"Selected",size:"small",color:"primary",sx:{alignSelf:"flex-start"}})]})})})});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:2,py:1,mb:2,borderBottom:"1px solid",borderColor:"divider"},children:[(0,i.jsxs)(r.A,{children:[(0,i.jsxs)(C.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,i.jsx)(O.default,{variant:"h6",children:"Manage Visitors"}),u.length>0&&(0,i.jsx)(W.default,{label:"".concat(u.length," visitor").concat(u.length>1?"s":""),size:"small",variant:"outlined"})]}),(0,i.jsx)(O.default,{variant:"caption",color:"text.secondary",children:"Add at least one visitor or select a broker to create a visit"})]}),(0,i.jsxs)(C.A,{direction:"row",spacing:1,children:[m&&(0,i.jsx)(j.default,{size:"medium",color:"error",variant:"outlined",onClick:()=>{if(m){let e=u.filter(e=>e.contactId!==m.contactId);c(e),null==a||a(e),p(null),H({contactId:null,name:"",phoneNumber:null,selectedLead:null,bedrooms:"",sizeSqFt:"",viewType:"",floorPreference:"",direction:"",buyingIntent:"",infraUnitId:null,notes:""})}},startIcon:(0,i.jsx)(F.A,{}),sx:{minWidth:120},children:"Remove"}),(0,i.jsx)(j.default,{size:"medium",color:"primary",variant:"contained",onClick:d.onTrue,startIcon:(0,i.jsx)(V.A,{}),sx:{minWidth:120},children:"Add Visitor"})]})]}),(0,i.jsx)(r.A,{sx:{m:2},children:0===u.length?(0,i.jsx)(()=>(0,i.jsxs)(P.default,{sx:{px:6,py:3,textAlign:"center",bgcolor:"grey.50",border:"2px dashed",borderColor:"grey.300",borderRadius:2},children:[(0,i.jsx)(z.A,{sx:{fontSize:64,color:"grey.400"}}),(0,i.jsx)(O.default,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No visitors added yet"}),(0,i.jsx)(O.default,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Add visitors here or select a broker above to track visit participants"}),(0,i.jsx)(L.default,{color:"primary",variant:"contained",startIcon:(0,i.jsx)(V.A,{}),onClick:d.onTrue,children:"Add First Visitor"})]}),{}):(0,i.jsx)(r.A,{sx:{display:"flex",gap:2,overflowX:"auto",p:1,"&::-webkit-scrollbar":{height:8},"&::-webkit-scrollbar-track":{backgroundColor:"grey.100",borderRadius:4},"&::-webkit-scrollbar-thumb":{backgroundColor:"grey.400",borderRadius:4,"&:hover":{backgroundColor:"grey.600"}}},children:u.map(e=>(0,i.jsx)(K,{visitor:e,isSelected:(null==m?void 0:m.contactId)===e.contactId,onClick:J},e.contactId))})}),m&&(0,i.jsxs)(P.default,{sx:{p:3,elevation:2},children:[(0,i.jsxs)(O.default,{variant:"h6",gutterBottom:!0,sx:{mb:3},children:[(0,i.jsx)(z.A,{sx:{mr:1,verticalAlign:"middle"}}),m.name&&m.phoneNumber?"".concat(m.name," (").concat(m.phoneNumber,")"):"Visitor Details"]}),(0,i.jsx)(U.default,{sx:{mb:3}}),(0,i.jsxs)(E.Ay,{container:!0,spacing:3,children:[(0,i.jsx)(E.Ay,{item:!0,xs:12,sm:6,children:(0,i.jsx)(q.default,{size:"small",options:null!=A?A:[],loading:S,getOptionLabel:e=>{var t;return null!=(t=null==e?void 0:e.label)?t:""},getOptionKey:e=>{var t;return null!=(t=null==e?void 0:e.value)?t:""},isOptionEqualToValue:(e,t)=>(null==e?void 0:e.value)===(null==t?void 0:t.value),value:null!=(t=null==N?void 0:N.selectedLead)?t:null,onChange:(e,t)=>H(e=>({...e,selectedLead:null!=t?t:null})),renderInput:e=>{var t;return(0,i.jsx)(M.default,{...e,label:"Select Lead",placeholder:"Choose a lead to associate with visit...",helperText:"Above leads are of customer ".concat(null!=(t=null==m?void 0:m.name)?t:"selected customer"),variant:"outlined"})},noOptionsText:"No Lead found for selected customer",loadingText:"Loading leads..."})}),(0,i.jsx)(E.Ay,{item:!0,xs:12,children:(0,i.jsx)(_.Z,{visitor:m,siteId:l,detailsForm:N,setDetailsForm:H,isEditing:!0})}),(0,i.jsx)(E.Ay,{item:!0,xs:12,children:(0,i.jsx)(M.default,{fullWidth:!0,multiline:!0,rows:3,label:"Notes",value:N.notes,onChange:e=>H({...N,notes:e.target.value}),placeholder:"Additional notes about the visitor or their requirements..."})})]})]}),(0,i.jsx)(B.Tt,{title:"Contacts List",type:"Customer",open:d.value,onClose:d.onFalse,selected:e=>{},onSelect:e=>{Z(e)}})]})}var Y=l(83392);let Z=h.z.object({siteDetails:N.yf.nullableInput(h.z.object({id:h.z.number(),name:h.z.string(),fullAddress:h.z.string()}),{message:"Site Details is required!"}),infraDetails:h.z.object({id:h.z.number(),name:h.z.string(),fullAddress:h.z.string()}).nullable().optional(),brokerDetails:h.z.object({id:h.z.number(),name:h.z.string(),phoneNumber:h.z.number()}).nullable().optional(),visitStatus:h.z.string({required_error:"Required",invalid_type_error:"Required"}),purpose:h.z.string({required_error:"Required",invalid_type_error:"Required"}),visitDate:h.z.string({required_error:"Required",invalid_type_error:"Required"}),visitors:h.z.array().nullable().optional()});function J(){var e,t,l;let a=(0,I.rd)(),s=(0,x.Cg)(),[d,u]=(0,g.useState)([]),{userData:c,userError:m}=(0,k._)(),p=(0,b.useSearchParams)().get("leadId"),{detailedLeadData:h,detailedLeadLoading:z}=(0,D.OB)(p),V=(0,g.useMemo)(()=>{var e,t,l,i,n,r,a,s;return p&&h?{siteDetails:h.SiteId?{id:h.SiteId,name:null==(e=h.site)?void 0:e.SiteName,fullAddress:null==(t=h.site)?void 0:t.SiteAddress}:null,infraDetails:null,brokerDetails:h.BrokerId?{id:h.BrokerId,name:"".concat((null==(l=h.broker)?void 0:l.ContactFName)||""," ").concat((null==(i=h.broker)?void 0:i.ContactLName)||"").trim(),phoneNumber:null==(n=h.broker)?void 0:n.ContactNo}:null,visitorData:{contactId:h.ContactId,name:"".concat((null==(r=h.contacts)?void 0:r.ContactFName)||""," ").concat((null==(a=h.contacts)?void 0:a.ContactLName)||"").trim(),phoneNumber:null==(s=h.contacts)?void 0:s.ContactNo,selectedLead:{value:h.LeadId,label:h.LeadName||"Lead #".concat(h.LeadId)},bedrooms:h.Bedrooms,sizeSqFt:h.SizeSqFt,viewType:h.ViewType,floorPreference:h.FloorPreference,direction:h.Direction,buyingIntent:h.BuyingIntent}}:null},[p,h]),T=(0,g.useMemo)(()=>({siteDetails:(null==V?void 0:V.siteDetails)||null,infraDetails:null,brokerDetails:(null==V?void 0:V.brokerDetails)||null,visitStatus:"Scheduled",purpose:null,visitDate:f()().format(),visitors:[]}),[V]),F=(0,v.mN)({mode:"all",resolver:(0,y.u)(Z),defaultValues:T}),{watch:P,reset:O,handleSubmit:L,formState:{isSubmitting:R,errors:W}}=F,U=P();(0,g.useEffect)(()=>{(null==V?void 0:V.visitorData)&&u([V.visitorData])},[V]),(0,g.useEffect)(()=>{V&&O(T)},[V,T,O]);let E=async e=>{var t,l,i,r,p,h,v,x,b,g;if(m){n.oR.error("Failed to load user data. Please refresh the page.",{containerId:"error"}),s.onFalse();return}let y=null==e||null==(t=e.brokerDetails)?void 0:t.id,j=d&&d.length>0;if(!y&&!j){n.oR.error("Please add at least one visitor or select a broker for the visit",{containerId:"error"}),s.onFalse();return}let C=d.map(e=>{var t;return{ContactId:e.contactId,LeadId:(null==(t=e.selectedLead)?void 0:t.value)||null,InfraUnitId:e.infraUnitId||null,Bedrooms:e.bedrooms||null,SizeSqFt:e.sizeSqFt||null,ViewType:e.viewType||null,FloorPreference:e.floorPreference||null,Direction:e.direction||null,BuyingIntent:e.buyingIntent||null,Notes:e.notes||null}});(null==e||null==(l=e.brokerDetails)?void 0:l.id)&&C.push({ContactId:e.brokerDetails.id,LeadId:null,InfraUnitId:null,Bedrooms:null,SizeSqFt:null,ViewType:null,FloorPreference:null,Direction:null,BuyingIntent:null,Notes:null});let S={visit_request:{SiteId:null==e||null==(i=e.siteDetails)?void 0:i.id,InfraId:null!=(p=null==e||null==(r=e.infraDetails)?void 0:r.id)?p:null,SalesPersonId:null!=(h=null==c?void 0:c.id)?h:0,VisitStatus:(null==e?void 0:e.visitStatus)||"Scheduled",Purpose:(null==e?void 0:e.purpose)||null,VisitDate:null!=(v=e.visitDate)?v:f()().format()},visitors_request:{Visitors:C}};try{let e=await (0,A.nT)(S);n.oR.success("New visit created successfully!",{containerId:"success"});let t=null==e||null==(x=e.Visitors[0])?void 0:x.VisitId;a.push(o.f.dashboard.visit.profile(t)),O(),u([]),s.onFalse()}catch(e){n.oR.dismiss(),n.oR.error("Error: ".concat((null==(g=e.response)||null==(b=g.data)?void 0:b.message)||"Could not create visit"),{containerId:"error"})}},q=L(async e=>{s.onTrue();try{await E(e)}catch(e){}finally{s.onFalse()}},e=>{var t;let l=[];e.siteDetails&&l.push("Site Details"),e.purpose&&l.push("Select Visit Purpose"),e.visitStatus&&l.push("Select Status"),e.visitDate&&l.push("Select Date & Time"),l.length>0&&(n.oR.error("Please fill required fields: ".concat(l.join(", ")),{containerId:"error",autoClose:5e3}),window.scrollTo({top:0,behavior:"smooth"}));let i=null==U||null==(t=U.brokerDetails)?void 0:t.id,r=d&&d.length>0;i||r||n.oR.error("Please add at least one visitor or select a broker",{containerId:"error",autoClose:5e3})});return p&&z?(0,i.jsxs)(C.A,{spacing:2,children:[(0,i.jsx)(S.A,{variant:"rectangular",height:200}),(0,i.jsx)(S.A,{variant:"rectangular",height:150}),(0,i.jsx)(S.A,{variant:"rectangular",height:100})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.lV,{methods:F,onSubmit:q,children:(0,i.jsxs)(C.A,{spacing:1,children:[(0,i.jsx)(w.A,{children:(0,i.jsx)(Y.Ty,{})}),(0,i.jsx)(w.A,{children:(0,i.jsx)(Y.$t,{})})]})}),(0,i.jsx)(w.A,{sx:{mt:2,border:0!==d.length||(null==U||null==(e=U.brokerDetails)?void 0:e.id)||!W.visitors?"none":"1px solid",borderColor:"error.main"},children:(0,i.jsx)(H,{siteId:null!=(l=null==U||null==(t=U.siteDetails)?void 0:t.id)?l:null,onVisitorsChange:e=>{u(e)},initialVisitor:null==V?void 0:V.visitorData,leadId:p})}),(0,i.jsx)(r.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:(0,i.jsx)(j.default,{size:"small",variant:"contained",color:"primary",loading:s.value||R,onClick:q,children:"Save Visit"})})]})}function K(){return(0,i.jsxs)(u.KG,{children:[(0,i.jsx)(m.g,{links:[{name:"Home",href:o.f.dashboard.root},{name:"Visit",href:o.f.dashboard.visit.root},{name:"New Visit"}],sx:{mb:{xs:2,md:1}}}),(0,i.jsx)(r.A,{sx:{display:"flex",alignItems:"center",mb:1,gap:2},children:(0,i.jsx)(a.default,{title:"Visit List",arrow:!0,children:(0,i.jsx)(s.default,{component:d.W,href:o.f.dashboard.visit.root,children:(0,i.jsx)(c.W,{icon:"material-symbols:view-list",sx:{width:30,height:30}})})})}),(0,i.jsx)(J,{}),(0,i.jsx)(n.N9,{containerId:"success",position:"top-right",autoClose:2e3}),(0,i.jsx)(n.N9,{containerId:"error",position:"top-right",autoClose:!1,closeOnClick:!0,newestOnTop:!0})]})}},86288:(e,t,l)=>{"use strict";l.d(t,{P:()=>V});var i=l(95155),n=l(55594),r=l(62177),a=l(12115),s=l(36339),o=l(90221),d=l(73746),u=l(42861),c=l(21030),m=l(80158),p=l(96801),f=l(9670),h=l(78822),v=l(53494),x=l(66292),b=l(71984),g=l(78129),y=l(74378),j=l(38867),C=l(54961),S=l(28292),w=l(95383);let I=n.z.object({id:n.z.number(),name:n.z.string(),fullAddress:n.z.string()}),A=n.z.object({id:n.z.number(),name:n.z.string(),phoneNumber:n.z.number()}),k=n.z.object({siteDetails:C.yf.nullableInput(I,{message:"Site Details is required!"}),infraDetails:I.nullable().optional(),brokerDetails:A.nullable().optional()}),D=e=>({id:e.SiteId,name:e.SiteName||"N/A",fullAddress:e.SiteAddress||"N/A"}),N=e=>({id:e.InfraId,name:e.InfraName||"N/A",fullAddress:e.InfraCategory||"N/A"}),z=(e,t,l)=>(0,a.useMemo)(()=>!t&&(null==e?void 0:e.length)?e.map(l):[],[e,t,l]);function V(e){var t;let{currentVisit:l,broker:n,setCurrentVisit:I,isReset:A,setIsReset:V,currentVisitors:T,setCurrentVisitors:F}=e,P=(0,d.default)(),O=(0,u.A)(P.breakpoints.up("md")),L=(0,a.useMemo)(()=>({brokerDetails:n&&Object.keys(n).length?{id:null==n?void 0:n.ContactId,name:"".concat(null==n?void 0:n.ContactFName," ").concat(null==n?void 0:n.ContactLName),phoneNumber:null==n?void 0:n.ContactNo}:null,siteDetails:l.SiteId&&l.site?{id:l.site.SiteId,name:l.site.SiteName,fullAddress:l.site.SiteAddress}:null,infraDetails:l.InfraId&&l.infra?{id:l.infra.InfraId,name:l.infra.InfraName,fullAddress:l.infra.InfraCategory}:null}),[l,n]),R=(0,r.mN)({mode:"all",resolver:(0,o.u)(k),defaultValues:L}),{reset:W,watch:U,setValue:E}=R,{brokerDetails:q,siteDetails:M,infraDetails:B}=U(),{contactData:_,contactLoading:G}=(0,g.ot)(null!=(t=null==n?void 0:n.ContactId)?t:null),{sitesData:H,sitesLoading:Y,sitesError:Z}=(0,b.MZ)(),{infrasData:J,infrasLoading:K,infrasError:$}=(0,y._)(null==M?void 0:M.id),X=z(H,Y,D),Q=z(J,K,N),ee=(0,s.Cg)(),et=(0,s.Cg)(),el=(0,s.Cg)(),ei=(0,s.Cg)();(0,a.useEffect)(()=>{A&&(W(L),V(!1))},[A,W,L]),(0,a.useEffect)(()=>{W(L)},[L,W]);let en=e=>{let t,i=T.findIndex(e=>{var t,l;return(null==e||null==(l=e.contacts)||null==(t=l.ContactType)?void 0:t.toLowerCase())==="broker"});if(-1!==i)t=T.map((t,l)=>{if(l===i){var n,r;return{...t,ContactId:e.id,contacts:{...t.contacts,ContactId:e.id,ContactFName:(null==(n=e.name)?void 0:n.split(" ")[0])||"",ContactLName:(null==(r=e.name)?void 0:r.split(" ").slice(1).join(" "))||"",FullName:e.name,ContactType:"Broker",ContactNo:e.phoneNumber}}}return t});else{var n,r;t=[...T,{ContactId:e.id,VisitId:(null==l?void 0:l.VisitId)||null,LeadId:null,InfraUnitId:null,Bedrooms:null,SizeSqFt:null,ViewType:null,FloorPreference:null,Direction:null,BuyingIntent:null,Notes:null,VisitorsId:null,contacts:{ContactId:e.id,ContactFName:(null==(n=e.name)?void 0:n.split(" ")[0])||"",ContactLName:(null==(r=e.name)?void 0:r.split(" ").slice(1).join(" "))||"",FullName:e.name,ContactType:"Broker",ContactNo:e.phoneNumber}}]}F(t)},er=(e,t)=>{E(e,t),"brokerDetails"===e&&en(t),"siteDetails"===e&&I(e=>{var l,i;return{...e,SiteId:t.id,site:{SiteId:t.id,SiteName:null!=(l=t.name)?l:null,SiteAddress:null!=(i=t.fullAddress)?i:null}}}),"infraDetails"===e&&I(e=>{var l,i;return{...e,InfraId:t.id,infra:{InfraId:t.id,InfraName:null!=(l=t.name)?l:null,InfraCategory:null!=(i=t.fullAddress)?i:null}}})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(C.lV,{methods:R,children:[(0,i.jsxs)(c.A,{divider:(0,i.jsx)(m.default,{flexItem:!0,orientation:O?"vertical":"horizontal",sx:{borderStyle:"dashed",borderWidth:"2px"}}),sx:{px:3,py:2,gap:{xs:3,md:5},flexDirection:{xs:"column",md:"row"}},children:[(0,i.jsxs)(c.A,{sx:{width:1},children:[(0,i.jsxs)(p.A,{sx:{mb:1,display:"flex",alignItems:"center"},children:[(0,i.jsx)(f.default,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:"Site Details:"}),(0,i.jsx)(h.default,{title:"Change Site",arrow:!0,children:(0,i.jsx)(v.default,{onClick:et.onTrue,children:(0,i.jsx)(j.W,{icon:"mingcute:add-line"})})})]}),(null==M?void 0:M.id)?(0,i.jsxs)(c.A,{spacing:1,children:[(0,i.jsxs)(f.default,{variant:"subtitle2",children:["Name: ",M.name]}),(0,i.jsxs)(f.default,{variant:"body2",children:["Address: ",M.fullAddress||"N/A"]})]}):(0,i.jsx)(f.default,{variant:"subtitle1",children:"No Site Selected"})]}),(0,i.jsxs)(c.A,{sx:{width:1},children:[(0,i.jsxs)(p.A,{sx:{mb:1,display:"flex",alignItems:"center"},children:[(0,i.jsx)(f.default,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:"Infra Details:"}),(0,i.jsx)(h.default,{title:"Change Infrastructure",arrow:!0,children:(0,i.jsx)(v.default,{onClick:el.onTrue,children:(0,i.jsx)(j.W,{icon:"mingcute:add-line"})})})]}),(null==B?void 0:B.id)?(0,i.jsxs)(c.A,{spacing:1,children:[(0,i.jsxs)(f.default,{variant:"subtitle2",children:["Name: ",B.name]}),(0,i.jsxs)(f.default,{variant:"body2",children:["Category: ",B.fullAddress||"N/A"]})]}):(0,i.jsx)(f.default,{variant:"subtitle1",children:"No Infra Selected"})]}),(0,i.jsxs)(c.A,{sx:{width:1},children:[(0,i.jsxs)(p.A,{sx:{mb:1,display:"flex",alignItems:"center"},children:[(0,i.jsx)(f.default,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:"Broker Details:"}),(0,i.jsx)(h.default,{title:"Change Broker",arrow:!0,children:(0,i.jsx)(v.default,{onClick:ee.onTrue,children:(0,i.jsx)(j.W,{icon:"mingcute:add-line"})})}),(null==q?void 0:q.id)&&(0,i.jsx)(h.default,{title:"Edit Broker",arrow:!0,children:(0,i.jsx)(v.default,{onClick:ei.onTrue,children:(0,i.jsx)(j.W,{icon:"solar:pen-bold"})})})]}),(null==q?void 0:q.id)?(0,i.jsxs)(c.A,{spacing:1,children:[(0,i.jsxs)(f.default,{variant:"subtitle2",children:["Name: ",q.name]}),(0,i.jsxs)(f.default,{variant:"body2",children:["Phone No.: ",q.phoneNumber||"N/A"]})]}):(0,i.jsx)(f.default,{variant:"subtitle1",children:"No Broker Assigned"})]})]}),(0,i.jsx)(S.Tt,{title:"Brokers List",type:"Broker",open:ee.value,onClose:ee.onFalse,selected:e=>(null==q?void 0:q.id)===e,onSelect:e=>er("brokerDetails",e),action:(0,i.jsx)(x.default,{size:"small",startIcon:(0,i.jsx)(j.W,{icon:"mingcute:add-line"}),sx:{alignSelf:"flex-end"},children:"New"})}),(0,i.jsx)(w.ND,{title:"Sites List",open:et.value,onClose:et.onFalse,selected:e=>(null==M?void 0:M.id)===e,onSelect:e=>er("siteDetails",e),list:X}),(0,i.jsx)(w.ND,{title:"Infrastructure List",open:el.value,onClose:el.onFalse,selected:e=>(null==B?void 0:B.id)===e,onSelect:e=>er("infraDetails",e),list:Q})]}),_.ContactId&&(0,i.jsx)(S.Rz,{title:"Edit Broker",type:"Broker",open:ei.value,onClose:ei.onFalse,currentContact:_,onCreate:()=>{}})]})}},95092:(e,t,l)=>{"use strict";l.d(t,{K:()=>G});var i=l(79630),n=l(93495),r=l(12115),a=l(42861),s=l(37892),o=l(38637),d=l.n(o),u=l(96260),c=l(76540),m=l(80158),p=l(7911),f=l(51654),h=l(41755),v=l(35932),x=l(26704),b=l(92901),g=l(55317),y=l(20335),j=l(74916),C=l(22919),S=l(33244),w=l(62542),I=l(45616),A=l(7361),k=l(2108),D=l(52596),N=l(17261),z=l(51246),V=l(39230),T=l(38594),F=l(95155);let P=r.forwardRef(function(e,t){let l=(0,N.useRtl)(),{toolbar:n,tabs:r,content:a,actionBar:s,shortcuts:o}=(0,z.A)(e),{sx:d,className:u,isLandscape:c,classes:p}=e,f=s&&(s.props.actions?.length??0)>0,h=(0,i.A)({},e,{isRtl:l});return(0,F.jsxs)(V.Kr,{ref:t,className:(0,D.A)(T.k.root,p?.root,u),sx:[{[`& .${T.k.tabs}`]:{gridRow:4,gridColumn:"1 / 4"},[`& .${T.k.actionBar}`]:{gridRow:5}},...Array.isArray(d)?d:[d]],ownerState:h,children:[c?o:n,c?n:o,(0,F.jsxs)(V.IU,{className:(0,D.A)(T.k.contentWrapper,p?.contentWrapper),sx:{display:"grid"},children:[a,r,f&&(0,F.jsx)(m.default,{sx:{gridRow:3,gridColumn:"1 / 4"}})]}),s]})});var O=l(44823),L=l(20999),R=l(98574),W=l(83103);let U=["openTo","focusedView","timeViewsCount"],E=function(e,t,l){var a,s;let{openTo:o,focusedView:d,timeViewsCount:u}=l,c=(0,n.A)(l,U),p=(0,i.A)({},c,{autoFocus:!1,focusedView:null,sx:[{["&.".concat(I.L.root)]:{borderBottom:0},["&.".concat(I.L.root,", .").concat(A.w.root,", &.").concat(k.X.root)]:{maxHeight:O.Y2}}]}),f=(0,L.Sq)(t);return(0,F.jsxs)(r.Fragment,{children:[null==(a=e[!f?t:"day"])?void 0:a.call(e,(0,i.A)({},l,{view:f?"day":t,focusedView:d&&(0,R.sC)(d)?d:null,views:l.views.filter(R.sC),sx:[{gridColumn:1},...p.sx]})),u>0&&(0,F.jsxs)(r.Fragment,{children:[(0,F.jsx)(m.default,{orientation:"vertical",sx:{gridColumn:2}}),null==(s=e[f?t:"hours"])?void 0:s.call(e,(0,i.A)({},p,{view:f?t:"hours",focusedView:d&&(0,L.Sq)(d)?d:null,openTo:(0,L.Sq)(o)?o:"hours",views:l.views.filter(L.Sq),sx:[{gridColumn:3},...p.sx]}))]})]})},q=r.forwardRef(function(e,t){var l,n,r,a,s,o;let d=(0,x.b)(),c=(0,b.hc)(),m=(0,h.u)(e,"MuiDesktopDateTimePicker"),{shouldRenderTimeInASingleColumn:I,thresholdToRenderTimeInASingleColumn:A,views:k,timeSteps:D}=(0,S.H)(m),N=I?w.$W:w.$8,z=(0,i.A)({day:v.W,month:v.W,year:v.W,hours:N,minutes:N,seconds:N,meridiem:N},m.viewRenderers),V=null==(s=m.ampmInClock)||s,T=(null==(l=z.hours)?void 0:l.name)===w.$8.name?k:k.filter(e=>"meridiem"!==e),F=I?[]:["accept"],O=(0,i.A)({},m,{viewRenderers:z,format:(0,S.J)(c,m),views:T,yearsPerRow:null!=(o=m.yearsPerRow)?o:4,ampmInClock:V,timeSteps:D,thresholdToRenderTimeInASingleColumn:A,shouldRenderTimeInASingleColumn:I,slots:(0,i.A)({field:f.I,layout:P,openPickerIcon:j.CT},m.slots),slotProps:(0,i.A)({},m.slotProps,{field:e=>{var l;return(0,i.A)({},(0,u.A)(null==(l=m.slotProps)?void 0:l.field,e),(0,g.zd)(m),{ref:t})},toolbar:(0,i.A)({hidden:!0,ampmInClock:V,toolbarVariant:"desktop"},null==(n=m.slotProps)?void 0:n.toolbar),tabs:(0,i.A)({hidden:!0},null==(r=m.slotProps)?void 0:r.tabs),actionBar:e=>{var t;return(0,i.A)({actions:F},(0,u.A)(null==(t=m.slotProps)?void 0:t.actionBar,e))}})}),{renderPicker:L}=(0,C.U)({props:O,valueManager:p.W,valueType:"date-time",getOpenDialogAriaText:(0,W.z)({utils:c,formatKey:"fullDate",contextTranslation:d.openDatePickerDialogue,propsTranslation:null==(a=O.localeText)?void 0:a.openDatePickerDialogue}),validator:y.q,rendererInterceptor:E});return L()});q.propTypes={ampm:d().bool,ampmInClock:d().bool,autoFocus:d().bool,className:d().string,closeOnSelect:d().bool,dayOfWeekFormatter:d().func,defaultValue:d().object,disabled:d().bool,disableFuture:d().bool,disableHighlightToday:d().bool,disableIgnoringDatePartForTimeValidation:d().bool,disableOpenPicker:d().bool,disablePast:d().bool,displayWeekNumber:d().bool,enableAccessibleFieldDOMStructure:d().any,fixedWeekNumber:d().number,format:d().string,formatDensity:d().oneOf(["dense","spacious"]),inputRef:c.A,label:d().node,loading:d().bool,localeText:d().object,maxDate:d().object,maxDateTime:d().object,maxTime:d().object,minDate:d().object,minDateTime:d().object,minTime:d().object,minutesStep:d().number,monthsPerRow:d().oneOf([3,4]),name:d().string,onAccept:d().func,onChange:d().func,onClose:d().func,onError:d().func,onMonthChange:d().func,onOpen:d().func,onSelectedSectionsChange:d().func,onViewChange:d().func,onYearChange:d().func,open:d().bool,openTo:d().oneOf(["day","hours","meridiem","minutes","month","seconds","year"]),orientation:d().oneOf(["landscape","portrait"]),readOnly:d().bool,reduceAnimations:d().bool,referenceDate:d().object,renderLoading:d().func,selectedSections:d().oneOfType([d().oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),d().number]),shouldDisableDate:d().func,shouldDisableMonth:d().func,shouldDisableTime:d().func,shouldDisableYear:d().func,showDaysOutsideCurrentMonth:d().bool,skipDisabled:d().bool,slotProps:d().object,slots:d().object,sx:d().oneOfType([d().arrayOf(d().oneOfType([d().func,d().object,d().bool])),d().func,d().object]),thresholdToRenderTimeInASingleColumn:d().number,timeSteps:d().shape({hours:d().number,minutes:d().number,seconds:d().number}),timezone:d().string,value:d().object,view:d().oneOf(["day","hours","meridiem","minutes","month","seconds","year"]),viewRenderers:d().shape({day:d().func,hours:d().func,meridiem:d().func,minutes:d().func,month:d().func,seconds:d().func,year:d().func}),views:d().arrayOf(d().oneOf(["day","hours","minutes","month","seconds","year"]).isRequired),yearsOrder:d().oneOf(["asc","desc"]),yearsPerRow:d().oneOf([3,4])};var M=l(28786),B=l(54843);let _=["desktopModeMediaQuery"],G=r.forwardRef(function(e,t){let l=(0,s.default)({props:e,name:"MuiDateTimePicker"}),{desktopModeMediaQuery:r=B.jX}=l,o=(0,n.A)(l,_);return(0,a.A)(r,{defaultMatches:!0})?(0,F.jsx)(q,(0,i.A)({ref:t},o)):(0,F.jsx)(M.E,(0,i.A)({ref:t},o))})},95789:(e,t,l)=>{Promise.resolve().then(l.bind(l,85822)),Promise.resolve().then(l.bind(l,41315)),Promise.resolve().then(l.bind(l,30942))}}]);